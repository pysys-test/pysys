

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Change Log &mdash; PySys v2.0  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="License" href="license.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> PySys v2.0
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="pysys/BaseTest.html">The BaseTest Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="pysys/UserGuide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="pysys/ProjectConfiguration.html">Project Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="pysys/TestDescriptors.html">Test Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="autodocgen/pysys.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Change Log</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-s-new-in-2-0">What’s new in 2.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#version-and-documentation-changes">Version and documentation changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#new-test-structure-and-descriptors">New test structure and descriptors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-project-and-test-configuration-improvements">Other project and test configuration improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#new-template-based-test-maker">New template-based test maker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#more-powerful-test-modes">More powerful test modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#project-configuration-features">Project configuration features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#process-management-improvements">Process management improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#line-mapper-text-manipulation-improvements">Line mapper/text manipulation improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basetest-api-improvements">BaseTest API improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fixes">Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#migration-notes">Migration notes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#breaking-changes">Breaking changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deprecations">Deprecations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-steps">Optional steps</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-new-in-1-6-1">What’s new in 1.6.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-new-in-1-6-0">What’s new in 1.6.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#new-plugin-api">New Plugin API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#new-and-improved-result-writers">New and improved result writers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#more-powerful-copy-and-line-mapping">More powerful copy and line mapping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assertion-improvements">Assertion improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simpler-process-handling">Simpler process handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pysys-py-and-project-configuration-improvements">pysys.py and project configuration improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#miscellaneous-test-api-improvements">Miscellaneous test API improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bug-fixes">Bug fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#upgrade-guide-and-compatibility">Upgrade guide and compatibility</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#release-history">Release History</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#to-1-5-0">1.4.0 to 1.5.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-1-4-0">1.3.0 to 1.4.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-1-3-0">1.2.0 to 1.3.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-1-2-0">1.1.1 to 1.2.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-1-1-1">1.1.0 to 1.1.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-1-1-0">0.9.3 to 1.1.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-9-3">0.9.2 to 0.9.3</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-9-2">0.9.1 to 0.9.2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-9-1">0.9.0 to 0.9.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-9-0">0.8.1 to 0.9.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-8-1">0.7.6 to 0.8.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-7-6">0.7.5 to 0.7.6</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-7-5">0.6.1 to 0.7.5</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-6-1">0.6.0 to 0.6.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-6-0">0.5.2 to 0.6.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-5-2">0.5.1 to 0.5.2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-5-1">0.5.0 to 0.5.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-5-0">0.4.0 to 0.5.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-4-0">0.3.5 to 0.4.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-3-5">0.3.4 to 0.3.5</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-3-4">0.3.3 to 0.3.4</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-3-3">0.3.2 to 0.3.3</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-3-2">0.3.1 to 0.3.2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-3-1">0.3.0 to 0.3.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-3-0">0.2.2 to 0.3.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-2-2">0.2.1 to 0.2.2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-2-1">0.2.0 to 0.2.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-2-0">0.1.7 to 0.2.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-1-7">0.1.6 to 0.1.7</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-1-6">0.1.5 to 0.1.6</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-1-5">0.1.4 to 0.1.5</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-0-1-4">0.1.3 to 0.1.4</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PySys v2.0</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Change Log</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/ChangeLog.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="change-log">
<h1>Change Log<a class="headerlink" href="#change-log" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use the <a class="reference external" href="https://github.com/pysys-test/pysys-test/issues">issue tracker</a> if you want to report a bug or feature
request in the PySys test framework. For how-tos and advice,
<a class="reference external" href="https://stackoverflow.com/questions/ask?tags=pysys">ask a question</a>.</p>
</div>
<div class="section" id="what-s-new-in-2-0">
<h2>What’s new in 2.0<a class="headerlink" href="#what-s-new-in-2-0" title="Permalink to this headline">¶</a></h2>
<p>PySys 2.0 was released in August 2021. Highlights from this release are:</p>
<ul class="simple">
<li><p>Addition of Python 3.9 support, and removal of Python 2 and 3.5 support.</p></li>
<li><p>A new standard test structure that avoids the use of XML by allowing descriptor values such as the test title to be
specified alongside your Python test class in a single <code class="docutils literal notranslate"><span class="pre">pysystest.py</span></code> file, instead of separate <code class="docutils literal notranslate"><span class="pre">run.py</span></code> and
<code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> files. You can mix and match the old and new styles within the same project. For new PySys projects
a simpler directory layout is now recommended in which the <code class="docutils literal notranslate"><span class="pre">self.input</span></code> directory is configured to be the main
<code class="docutils literal notranslate"><span class="pre">testDir/</span></code> (which also contains the <code class="docutils literal notranslate"><span class="pre">pysystest.py</span></code> file) instead of having a separate <code class="docutils literal notranslate"><span class="pre">testDir/Input/</span></code>
subdirectory for input files. This can make test contents easier to navigate.</p></li>
<li><p>Some big extensions to the concept of “modes” that allow for more powerful configuration and use, including
mode parameters for easier handling of multi-dimensional modes, and dynamic mode lists configured with a Python
lambda expression.</p></li>
<li><p>A new template-based implementation of <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">make</span></code>, allowing easy configuration of how new tests are created -
on a per-directory basis - and also automatic generation of test identifiers for new tests (when using numeric
identifiers).</p></li>
<li><p>Several improvements to the <a class="reference internal" href="autodocgen/pysys.mappers.html#module-pysys.mappers" title="pysys.mappers"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.mappers</span></code></a> API for more easily transforming text files during copy and grep
operations, including support for multi-line exception stack traces.</p></li>
<li><p>A large set of smaller additions, many based on end-user requests. PySys “power users” are encouraged to read through
the full Change Log below to ensure they’re aware of all the new functionality they might be able to benefit from.</p></li>
<li><p>There are a few breaking changes (see Migration Notes below) but in practice these are likely to affect few
users.</p></li>
</ul>
<div class="section" id="version-and-documentation-changes">
<h3>Version and documentation changes<a class="headerlink" href="#version-and-documentation-changes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Added support for Python 3.9.</p></li>
<li><p>Removed support for Python 2 and 3.5, which are now end-of-life.</p></li>
<li><p>PySys releases now use a simpler 2-digit semantic version, so this release is v2.0 compared to the previous
v1.6.1. The first digit changes when there are potentially breaking changes that are likely to require users to
update their existing tests.</p></li>
<li><p>Added a new “cookbook” sample which is a great repository of copyable snippets for configurating and extending
PySys.</p></li>
<li><p>Documentation for <a class="reference internal" href="pysys/ProjectConfiguration.html"><span class="doc">Project Configuration</span></a> and <a class="reference internal" href="pysys/TestDescriptors.html"><span class="doc">Test Descriptors</span></a> is much improved.</p></li>
</ul>
</div>
<div class="section" id="new-test-structure-and-descriptors">
<h3>New test structure and descriptors<a class="headerlink" href="#new-test-structure-and-descriptors" title="Permalink to this headline">¶</a></h3>
<p>Previously, every PySys test was defined by a <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> file. In practice having the test descriptor values
separated from the <code class="docutils literal notranslate"><span class="pre">run.py</span></code> in a different file made tests harder to navigate. You can continue to use
<code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> files if you wish, but the recommended structure for new tests is a single file called
<code class="docutils literal notranslate"><span class="pre">pysystest.py</span></code>. There is a new Python-style syntax for specifying descriptor values within this file, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">__pysys_title__</span>   <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot; My foobar tool - Argument parsing success and error cases &quot;&quot;&quot;</span>
<span class="c1">#                        ========================================================================================================================</span>

<span class="n">__pysys_purpose__</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot; The purpose of this test is to check that</span>
<span class="s2">        argument parsing addresses these criteria:</span>
<span class="s2">                - Correctness</span>
<span class="s2">                - Clear error messages</span>
<span class="s2">        &quot;&quot;&quot;</span>

<span class="n">__pysys_groups__</span>           <span class="o">=</span> <span class="s2">&quot;performance, disableCoverage; inherit=true&quot;</span>
<span class="c1">#__pysys_skipped_reason__  = &quot;Skipped until Bug-1234 is fixed&quot;</span>
</pre></div>
</div>
<p>For a full example of all the possible options (including more details on the subset of Python syntax PySys will
parse correctly) see <a class="reference internal" href="pysys/TestDescriptors.html"><span class="doc">Test Descriptors</span></a>.</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">=====</span></code> characters act not only as an underline but also provide a guide to help test authors know
when their title string has exceeded 80 characters which should be avoided if possible to make <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">print</span></code> output
easy to read. The character and length of this guide can be customized with project property
<code class="docutils literal notranslate"><span class="pre">pysystestTemplateLineLengthGuide</span></code> if desired.</p>
<p>New descriptor values were added to record the <code class="docutils literal notranslate"><span class="pre">authors</span></code> who have worked on the test, and the original test
<code class="docutils literal notranslate"><span class="pre">created</span></code> date, both of which are useful to have available when looking into test failures. These are automatically
populated when using <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">make</span></code>, but would need to be manually updated if you create tests through other means
such as copying from an existing test.</p>
<p>Actually PySys will recognize <em>any</em> file named <code class="docutils literal notranslate"><span class="pre">pysystest.*</span></code> (case insensitive) as a test not just <code class="docutils literal notranslate"><span class="pre">pysystest.py</span></code>,
so the same mechanism can be used for non-Python languages, for example a file named <code class="docutils literal notranslate"><span class="pre">PySysTest.cs</span></code> would also be
identified as a PySys test. It just needs to contain at least a <code class="docutils literal notranslate"><span class="pre">__pysys_title__</span> <span class="pre">=</span> <span class="pre">...</span></code>, and there would need to be
an associated Python class for executing it (could be configured in the same file or in a parent
<code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code>).</p>
<p>It is also possible to embed an entire XML descriptor inside a <code class="docutils literal notranslate"><span class="pre">pysystest.py</span></code> using <code class="docutils literal notranslate"><span class="pre">__pysys_xml_descriptor__</span> <span class="pre">=</span></code>
which may be useful for some users. However note that parsing XML is really quite slow, so avoiding use of XML is an
advantage, particularly if your project may grow large.</p>
<p>See migration notes for more information about optionally switching to the new <code class="docutils literal notranslate"><span class="pre">pysystest.py</span></code> structure, including a
sample utility to assist in migrating existing tests.</p>
<p>Newly created PySys projects now store <code class="docutils literal notranslate"><span class="pre">self.input</span></code> files in the top-level <code class="docutils literal notranslate"><span class="pre">&lt;testDir&gt;/</span></code> of each test instead of the
<code class="docutils literal notranslate"><span class="pre">&lt;testDir&gt;/Input/</span></code> subdirectory, to make tests easier to navigate. Existing projects could be updated to follow the
same structure if desired, or could make use of a new <code class="docutils literal notranslate"><span class="pre">&lt;input-dir&gt;</span></code> value to use <code class="docutils literal notranslate"><span class="pre">Input/</span></code> for existing tests in the
project but not tests created from now on; see the migration notes below for more information.</p>
</div>
<div class="section" id="other-project-and-test-configuration-improvements">
<h3>Other project and test configuration improvements<a class="headerlink" href="#other-project-and-test-configuration-improvements" title="Permalink to this headline">¶</a></h3>
<p>For those still using XML is now a leaner recommended structure for test descriptors which makes several
elements optional, to allow descriptors to be shorter:</p>
<ul class="simple">
<li><p>Instead of specifying groups in separate <code class="docutils literal notranslate"><span class="pre">&lt;group&gt;</span></code> elements you can now specify them in a single string using
<code class="docutils literal notranslate"><span class="pre">&lt;groups</span> <span class="pre">groups=&quot;my-group1,</span> <span class="pre">my-group2&quot;/&gt;</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">&lt;description&gt;</span></code> element is no longer required - <code class="docutils literal notranslate"><span class="pre">&lt;title&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;purpose&gt;</span></code> can be placed directly under
the root element.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">&lt;classification&gt;</span></code> element is no longer required - <code class="docutils literal notranslate"><span class="pre">&lt;modes&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;groups&gt;</span></code> can be placed directly under
the root element.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">&lt;data&gt;</span></code> element is no longer required except as a parent for <code class="docutils literal notranslate"><span class="pre">&lt;user-data&gt;</span></code>. Default directories can be
specified with <code class="docutils literal notranslate"><span class="pre">&lt;input/output/reference</span> <span class="pre">path=...&gt;</span></code> or using the slightly clearer names
<code class="docutils literal notranslate"><span class="pre">&lt;input-dir/output-dir/reference-dir&gt;...&lt;.../&gt;</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;requirement</span> <span class="pre">id=&quot;...&quot;/&gt;</span></code> elements can now be placed directly under the root element, without the need for
enclosing <code class="docutils literal notranslate"><span class="pre">&lt;traceability&gt;&lt;requirements&gt;...</span></code> elements.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">&lt;purpose&gt;</span></code> element is now optional; it’s often clearer to put detailed multi-line information
about the test’s purpose in the <code class="docutils literal notranslate"><span class="pre">.py</span></code> file alongside the test implementation.</p></li>
</ul>
<p>Some additional improvements that will benefit advanced users are:</p>
<ul>
<li><p>PySys plugins sometimes provide a test class that can directly used by multiple tests (without each having their
own <code class="docutils literal notranslate"><span class="pre">run.py</span></code>). You can now implement this pattern a lot more easily by specifying a fully qualified
<code class="docutils literal notranslate"><span class="pre">classname</span></code> and setting the <code class="docutils literal notranslate"><span class="pre">module</span></code> to the special string <code class="docutils literal notranslate"><span class="pre">&quot;PYTHONPATH&quot;</span></code> in the <code class="docutils literal notranslate"><span class="pre">pysystest.*</span></code> descriptor,
which will lookup the specified classname in the PYTHONPATH using Python’s module importing mechanism.</p></li>
<li><p>Changed the creation of new tests (and the loading of test descriptors) to include the <code class="docutils literal notranslate"><span class="pre">.py</span></code> suffix in the
<code class="docutils literal notranslate"><span class="pre">module=</span></code> filename, to make it more explicit what is going on. As before, specifying this suffix is optional
so there is no need to update existing tests.</p></li>
<li><p>Added support for specifying project properties and descriptor user-data values using multi-line XML text
(or CDATA) as an alternative to setting the <code class="docutils literal notranslate"><span class="pre">value=</span></code> attribute. When converting string values to a list,
newline is now considered as a delimiter along with comma. This allows long value (especially path-like)
values to be specified in a more readable form, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;property name=&quot;myTestDescriptorPath&quot;&gt;
  ${testRootDir}/foo/foo
  ${testRootDir}/foo/bar, ${testRootDir}/foo/baz

  &lt;!-- Comments and whitespace are ignored when converting a string to a list --&gt;

  ${testRootDir}/foo/bosh
&lt;/property&gt;
</pre></div>
</div>
<p>Although less valuable there, the same approach can be used in non-XML <code class="docutils literal notranslate"><span class="pre">pysystest.py</span></code> files.</p>
</li>
<li><p>Top-level <code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> directory configuration can now also be specified in the <code class="docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> file
by adding a <code class="docutils literal notranslate"><span class="pre">&lt;pysysdirconfig&gt;</span></code> element under the <code class="docutils literal notranslate"><span class="pre">&lt;pysysproject&gt;</span></code>. This allows all the <code class="docutils literal notranslate"><span class="pre">pysysdirconfig</span></code> options
such as your preferred Input/Reference/Output directory names to be specified in <code class="docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> files and
<code class="docutils literal notranslate"><span class="pre">makeproject</span></code> templates.</p></li>
</ul>
</div>
<div class="section" id="new-template-based-test-maker">
<h3>New template-based test maker<a class="headerlink" href="#new-template-based-test-maker" title="Permalink to this headline">¶</a></h3>
<p>There’s now an easy way to create new tests specific to your project, or even multiple templates for individual
directories within your project. This helps to encourage teams to follow the latest best practice by ensuring new
tests are copying known good patterns, and also saves looking up how to do common things when creating new tests.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">make</span></code> command line comes with a <code class="docutils literal notranslate"><span class="pre">pysys-default-test</span></code> template for creating a simple PySys test, you can
add your own by adding <code class="docutils literal notranslate"><span class="pre">&lt;maker-template&gt;</span></code> elements to <code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> in any directory under your project,
or to a <code class="docutils literal notranslate"><span class="pre">&lt;pysysdirconfig&gt;</span></code> element in your <code class="docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> file. Here are some examples (taken from
the cookbook sample):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">pysysdirconfig</span><span class="o">&gt;</span>

        <span class="o">&lt;</span><span class="n">maker</span><span class="o">-</span><span class="n">template</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-test&quot;</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;a test with the Python code pre-customized to get things started&quot;</span>
                <span class="n">copy</span><span class="o">=</span><span class="s2">&quot;./_pysys_templates/MyTemplateTest/*&quot;</span> <span class="o">/&gt;</span>

        <span class="o">&lt;</span><span class="n">maker</span><span class="o">-</span><span class="n">template</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;perf-test&quot;</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;a performance test including configuration for my fictional performance tool&quot;</span>
                <span class="n">copy</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{pysysTemplatesDir}</span><span class="s2">/default-test/*, ./_pysys_templates/perf/my-perf-config.xml&quot;</span><span class="o">/&gt;</span>

        <span class="o">&lt;</span><span class="n">maker</span><span class="o">-</span><span class="n">template</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;foobar-test&quot;</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;an advanced test based on the existing XXX test&quot;</span>
                <span class="n">copy</span><span class="o">=</span><span class="s2">&quot;./PySysDirConfigSample/*&quot;</span>
                <span class="n">mkdir</span><span class="o">=</span><span class="s2">&quot;ExtraDir1, ExtraDir2&quot;</span>
        <span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">replace</span> <span class="n">regex</span><span class="o">=</span><span class="s1">&#39;__pysys_title__ *= r&quot;&quot;&quot;[^&quot;]*&quot;&quot;&quot;&#39;</span> <span class="k">with</span><span class="o">=</span><span class="s1">&#39;__pysys_title__   = r&quot;&quot;&quot; Foobar - My new @</span><span class="si">{DIR_NAME}</span><span class="s1"> test title TODO &quot;&quot;&quot;&#39;</span><span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">replace</span> <span class="n">regex</span><span class="o">=</span><span class="s1">&#39;__pysys_authors__ *= &quot;[^&quot;]*&quot;&#39;</span>    <span class="k">with</span><span class="o">=</span><span class="s1">&#39;__pysys_authors__ = &quot;@</span><span class="si">{USERNAME}</span><span class="s1">&quot;&#39;</span><span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">replace</span> <span class="n">regex</span><span class="o">=</span><span class="s1">&#39;__pysys_created__ *= &quot;[^&quot;]*&quot;&#39;</span>    <span class="k">with</span><span class="o">=</span><span class="s1">&#39;__pysys_created__ = &quot;@</span><span class="si">{DATE}</span><span class="s1">&quot;&#39;</span><span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">replace</span> <span class="n">regex</span><span class="o">=</span><span class="s1">&#39;@@DIR_NAME@@&#39;</span>                    <span class="k">with</span><span class="o">=</span><span class="s1">&#39;@</span><span class="si">{DIR_NAME}</span><span class="s1">&#39;</span><span class="o">/&gt;</span>
        <span class="o">&lt;/</span><span class="n">maker</span><span class="o">-</span><span class="n">template</span><span class="o">&gt;</span>

<span class="o">&lt;/</span><span class="n">pysysdirconfig</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For customizing the PySysTest class the best approach is usually to create a <code class="docutils literal notranslate"><span class="pre">pysystest.py</span></code> template test
containing <code class="docutils literal notranslate"><span class="pre">&#64;&#64;DEFAULT_DESCRIPTOR&#64;&#64;</span></code> to include the default PySys descriptor values (this means your template will
automatically benefit from any future changes to the defaults), and put it in a <code class="docutils literal notranslate"><span class="pre">_pysys_templates/&lt;templatename&gt;</span></code>
directory alongside the <code class="docutils literal notranslate"><span class="pre">pysystestdir.xml</span></code> file. The <code class="docutils literal notranslate"><span class="pre">_pysys_templates</span></code> directory should contain a file
named <code class="docutils literal notranslate"><span class="pre">.pysysignore</span></code> (which avoids the template being loaded as a real test).</p>
<p>Other options are possible (as above) such as copying files from an absolute location such as under your project’s
<code class="docutils literal notranslate"><span class="pre">${testRootDir}</span></code>, copying from PySys default templates directly (if you just want to <em>add</em> files) by
using <code class="docutils literal notranslate"><span class="pre">${pysysTemplatesDir}/default-test/*</span></code>, or copying from a path relative to the XML file where the template is
defined containing a real (but simple) test to copy from (with suitable regex replacements to make it more generic).</p>
<p>See <a class="reference internal" href="pysys/TestDescriptors.html"><span class="doc">Test Descriptors</span></a> for more information about how to configure templates in a <code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> file.</p>
<p>When creating tests using <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">make</span></code>, by default the first template (from the more specific <code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code>)
is selected, but you can also specify any other template by name using the <code class="docutils literal notranslate"><span class="pre">-t</span></code> option, and get a list of available
templates for the current directory using <code class="docutils literal notranslate"><span class="pre">--help</span></code>.</p>
<p>If you are using numeric suffixes (and assuming you don’t have different prefixes in the same directory - not
recommended!) you can now omit the test identifier/directory name argument and PySys will automatically pick one by
incrementing the largest existing numeric identifier.</p>
<p>It is possible to subclass the <a class="reference internal" href="autodocgen/pysys.launcher.console_make.html#pysys.launcher.console_make.DefaultTestMaker" title="pysys.launcher.console_make.DefaultTestMaker"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.launcher.console_make.DefaultTestMaker</span></code></a> responsible for this logic if needed.
The main reason to do that is to provide a <a class="reference internal" href="autodocgen/pysys.launcher.console_make.html#pysys.launcher.console_make.DefaultTestMaker.validateTestId" title="pysys.launcher.console_make.DefaultTestMaker.validateTestId"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.launcher.console_make.DefaultTestMaker.validateTestId</span></code></a> method
to check that new test ids do not conflict with others used by others in a remote version control system (to avoid
merge conflicts).</p>
<p>By default PySys creates <code class="docutils literal notranslate"><span class="pre">.py</span></code> files with tabs for indentation (as in previous PySys releases). If you prefer spaces,
just set the new <code class="docutils literal notranslate"><span class="pre">pythonIndentationSpacesPerTab</span></code> project property to a string containing the required spaces per tab.</p>
</div>
<div class="section" id="more-powerful-test-modes">
<h3>More powerful test modes<a class="headerlink" href="#more-powerful-test-modes" title="Permalink to this headline">¶</a></h3>
<p>This PySys release adds some big usability improvements for defining and using modes.</p>
<p>A more powerful and flexible configuration format is now provided for defining modes, which uses a Python
lambda to provide the list of modes. Each mode can now define any number of <em>parameters</em> to avoid the need to
parse/unpack from the mode string itself; these can then be accessed from a <code class="docutils literal notranslate"><span class="pre">self.mode.params</span></code> dictionary.
The mode name can be automatically generated from the parameters, or provided explicitly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">__pysys_modes__</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                lambda helper: helper.inheritedModes+[</span>
<span class="s2">                        {&#39;mode&#39;:&#39;CompressionGZip&#39;, &#39;compressionType&#39;:&#39;gzip&#39;},</span>
<span class="s2">                ]</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>For those still using <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> files, the same Python lambda can also be added in your <code class="docutils literal notranslate"><span class="pre">&lt;modes&gt;...&lt;/modes&gt;</span></code>
element.</p>
<p>There is also a helper function provided (in <a class="reference internal" href="autodocgen/pysys.config.descriptor.html#pysys.config.descriptor.TestModesConfigHelper.combineModeDimensions" title="pysys.config.descriptor.TestModesConfigHelper.combineModeDimensions"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.descriptor.TestModesConfigHelper.combineModeDimensions</span></code></a>)
to combine multiple mode “dimensions” together, for example every combination of your supported databases and your
supported web browsers. This allows for some quite sophisticated logic to generate the mode list such as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">__pysys_modes__</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        lambda helper: [</span>
<span class="s2">                mode for mode in</span>
<span class="s2">                        helper.combineModeDimensions( # Takes any number of mode lists as arguments and returns a single combined mode list</span>
<span class="s2">                                helper.inheritedModes,</span>
<span class="s2">                                {</span>
<span class="s2">                                                &#39;CompressionNone&#39;: {&#39;compressionType&#39;:None, &#39;isPrimary&#39;:True},</span>
<span class="s2">                                                &#39;CompressionGZip&#39;: {&#39;compressionType&#39;:&#39;gzip&#39;},</span>
<span class="s2">                                },</span>
<span class="s2">                                [</span>
<span class="s2">                                        {&#39;auth&#39;:None}, # Mode name is optional</span>
<span class="s2">                                        {&#39;auth&#39;:&#39;OS&#39;}, # In practice auth=OS modes will always be excluded since MyFunkyOS is a fictional OS</span>
<span class="s2">                                ],</span>
<span class="s2">                                helper.makeAllPrimary(</span>
<span class="s2">                                        {</span>
<span class="s2">                                                &#39;Usage&#39;:         {&#39;cmd&#39;: [&#39;--help&#39;],</span>
<span class="s2">                                                        &#39;expectedExitStatus&#39;:&#39;==0&#39;, &#39;expectedMessage&#39;:None},</span>
<span class="s2">                                                &#39;BadPort&#39;:       {&#39;cmd&#39;: [&#39;--port&#39;, &#39;-1&#39;],</span>
<span class="s2">                                                        &#39;expectedExitStatus&#39;:&#39;!=0&#39;, &#39;expectedMessage&#39;:&#39;Server failed: Invalid port number specified: -1&#39;},</span>
<span class="s2">                                                &#39;SetPortTwice&#39;:  {&#39;cmd&#39;: [&#39;--port&#39;, &#39;123&#39;, &#39;--config&#39;, helper.testDir+&#39;/myserverconfig.json&#39;],</span>
<span class="s2">                                                        &#39;expectedExitStatus&#39;:&#39;!=0&#39;, &#39;expectedMessage&#39;:&#39;Server failed: Cannot specify port twice&#39;},</span>
<span class="s2">                                        }),</span>
<span class="s2">                                )</span>
<span class="s2">                # This is Python list comprehension syntax for filtering the items in the list</span>
<span class="s2">                if (mode[&#39;auth&#39;] != &#39;OS&#39; or helper.import_module(&#39;sys&#39;).platform == &#39;MyFunkyOS&#39;)</span>
<span class="s2">        ]</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>You can specify each dimension of modes either as a dict or a list (the latter is required to benefit from automatic
generation of the mode name from the parameters).</p>
<p>Previously there was just one mode designated as <em>primary</em>, which would run when no explicit <code class="docutils literal notranslate"><span class="pre">--modes</span></code> or <code class="docutils literal notranslate"><span class="pre">--ci</span></code>
argument was specified. Now it is possible to configure multiple modes as primary (see above), and there is a helper
method to add <code class="docutils literal notranslate"><span class="pre">'isPrimary':True</span></code> to a whole list/dict of modes which is handy when using modes for testing
different test scenarios where you really want all of them executed by default even during quick local test runs.</p>
<p>For more details see <a class="reference internal" href="pysys/TestDescriptors.html"><span class="doc">Test Descriptors</span></a>, <a class="reference internal" href="pysys/UserGuide.html"><span class="doc">User Guide</span></a> and the Getting Started sample.</p>
<p>Note that when using the new lambda-based mode configuration, the convention that modes begin with a capital letter
is enforced by automatic upper-casing of the initial letter. If needed this can be turned off for existing projects
which use lowercase mode names and have a mixture of old and new modes styles by setting the project property
<code class="docutils literal notranslate"><span class="pre">enforceModeCapitalization</span></code> to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>There are also improvements to the <code class="docutils literal notranslate"><span class="pre">pysys.py</span></code> command line support for modes:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">run</span> <span class="pre">--mode</span> <span class="pre">MODES</span></code> now accepts regular expressions for modes, permitting more powerful selection of
a desired subset of modes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">print</span> <span class="pre">--mode</span> <span class="pre">MODES</span></code> now accepts the same mode specifiers (including regular expressions as above)
as <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">run</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pysys print -m MyDatabase2.0_FireFox,MyDatabase2.0_Chrome
pysys print -m MyDatabase2.0_.*
pysys print -m !MyOtherDatabase
</pre></div>
</div>
</li>
</ul>
<p>Also, <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">print</span></code> includes the <code class="docutils literal notranslate"><span class="pre">~MODE</span></code> suffix after the test identifier if a <code class="docutils literal notranslate"><span class="pre">--mode</span></code> filter was specified.</p>
</div>
<div class="section" id="project-configuration-features">
<h3>Project configuration features<a class="headerlink" href="#project-configuration-features" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Added automatic expansion of <code class="docutils literal notranslate"><span class="pre">${...}</span></code> project properties in a test/directory’s
<code class="docutils literal notranslate"><span class="pre">input/output/reference</span></code> configuration.</p></li>
<li><p>Added automatic normalization of slashes and <code class="docutils literal notranslate"><span class="pre">..</span></code> sequences in project property values for which
<code class="docutils literal notranslate"><span class="pre">pathMustExist=true</span></code>.</p></li>
<li><p>Added a pre-defined project property <code class="docutils literal notranslate"><span class="pre">${/}</span></code> which is resolved to the forward or backslash character for this OS.</p></li>
<li><p>Added a pre-defined project property <code class="docutils literal notranslate"><span class="pre">${username}</span></code> which is resolved to the user running PySys.</p></li>
<li><p>Added a pre-defined project property <code class="docutils literal notranslate"><span class="pre">${pysysTemplatesDir}</span></code> which is the path to the directory where PySys stores
its default <code class="docutils literal notranslate"><span class="pre">test/</span></code> template for creating new tests; you may wish to reference this when defining the files to
copy into your own test templates.</p></li>
<li><p>Added support for executing Python <code class="docutils literal notranslate"><span class="pre">eval()</span></code> strings when resolving project properties. Other project properties
are available as Python variables when the <code class="docutils literal notranslate"><span class="pre">eval()</span></code> string is executed (and also in a <code class="docutils literal notranslate"><span class="pre">properties</span></code> dict, in case
of any name that is not a valid Python identifier). For more details on how <code class="docutils literal notranslate"><span class="pre">eval()</span></code> strings are evaluated within
PySys see <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertThat" title="pysys.basetest.BaseTest.assertThat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertThat</span></code></a> which uses the same mechanism. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;logConfigURL&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;${eval: &quot;file:///&quot;+os.path.abspath(appHome).replace(&quot;</span><span class="se">\\</span><span class="s1">&quot;, &quot;/&quot;)+&quot;/logConfig.xml&quot;}&#39;</span><span class="o">/&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="process-management-improvements">
<h3>Process management improvements<a class="headerlink" href="#process-management-improvements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Added automatic killing of nested child processes of processes PySys has started (using Unix “process groups”, and
Windows “jobs”). This is especially useful when starting a process using a shell script; previously
only the wrapper script would have been killed, whereas now the process it starts is also terminated.</p></li>
<li><p>Fixed the default library path on macOS(R). Instead of setting <code class="docutils literal notranslate"><span class="pre">DYLD_LIBRARY_PATH=/usr/lib:/usr/local/lib</span></code>
(which overrides executables’ default libraries), we now use the <code class="docutils literal notranslate"><span class="pre">DYLD_FALLBACK_LIBRARY_PATH</span></code> environment
variable. The <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.constants.LIBRARY_PATH_ENV_VAR</span></code> constant is now set to ‘DYLD_FALLBACK_LIBRARY_PATH`.
Additionally, some extra items were added to the value of <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.constants.DYLD_LIBRARY_PATH</span></code> to match the
defaults as described in the latest macOS documentation.</p></li>
<li><p>Added improved debug logging to <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess()</span></code></a> including a full command line for manually re-running
troublesome commands, and expansion of PATH environment variables to show the individual components.</p></li>
<li><p>Added a <code class="docutils literal notranslate"><span class="pre">processFactory</span></code> argument to <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess()</span></code></a> which can be used either to have <code class="docutils literal notranslate"><span class="pre">startProcess()</span></code>
return a custom process subclass with extra features, or to make modifications to the arguments or environment
that were specified by the code that invoked <code class="docutils literal notranslate"><span class="pre">startProcess()</span></code> (if you’re using some wrapper method that
starts a process rather than calling <code class="docutils literal notranslate"><span class="pre">startProcess()</span></code> directly).</p></li>
</ul>
</div>
<div class="section" id="line-mapper-text-manipulation-improvements">
<h3>Line mapper/text manipulation improvements<a class="headerlink" href="#line-mapper-text-manipulation-improvements" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.mappers.html#pysys.mappers.JoinLines" title="pysys.mappers.JoinLines"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.mappers.JoinLines</span></code></a> which combines consecutive related logs such as exception stack traces. There are
also pre-configured mappers for some common tools: <a class="reference internal" href="autodocgen/pysys.mappers.html#pysys.mappers.JoinLines.PythonTraceback" title="pysys.mappers.JoinLines.PythonTraceback"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.mappers.JoinLines.PythonTraceback</span></code></a>,
<a class="reference internal" href="autodocgen/pysys.mappers.html#pysys.mappers.JoinLines.JavaStackTrace" title="pysys.mappers.JoinLines.JavaStackTrace"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.mappers.JoinLines.JavaStackTrace</span></code></a>, <a class="reference internal" href="autodocgen/pysys.mappers.html#pysys.mappers.JoinLines.AntBuildFailure" title="pysys.mappers.JoinLines.AntBuildFailure"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.mappers.JoinLines.AntBuildFailure</span></code></a>. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">assertGrep</span><span class="p">(</span><span class="s1">&#39;myserver.log&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39; (ERROR|FATAL) .*&#39;</span><span class="p">,</span> <span class="n">contains</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
  <span class="n">mappers</span><span class="o">=</span><span class="p">[</span><span class="n">pysys</span><span class="o">.</span><span class="n">mappers</span><span class="o">.</span><span class="n">JoinLines</span><span class="o">.</span><span class="n">JavaStackTrace</span><span class="p">()],</span>
  <span class="n">ignores</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Caused by: java.lang.RuntimeError: My expected exception&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>This will produce a failure outcome that includes the Java stack trace following any error lines, and also
has the ability to ignore errors based on the contents of their stack trace.</p>
</li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.mappers.html#pysys.mappers.SortLines" title="pysys.mappers.SortLines"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.mappers.SortLines</span></code></a> which could be used with the <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.copy" title="pysys.basetest.BaseTest.copy"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.copy</span></code></a> method for ensuring deterministic
results in a <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertDiff" title="pysys.basetest.BaseTest.assertDiff"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertDiff</span></code></a>.</p></li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.mappers.html#pysys.mappers.applyMappers" title="pysys.mappers.applyMappers"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.mappers.applyMappers</span></code></a> which makes it easy to add mapper functionality to your own methods.</p></li>
<li><p>Added a <code class="docutils literal notranslate"><span class="pre">mappers=</span></code> argument to <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.logFileContents" title="pysys.basetest.BaseTest.logFileContents"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.logFileContents</span></code></a> and <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertLineCount" title="pysys.basetest.BaseTest.assertLineCount"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertLineCount</span></code></a>.</p></li>
<li><p>Added a <code class="docutils literal notranslate"><span class="pre">startAfter=</span></code> argument to <a class="reference internal" href="autodocgen/pysys.mappers.html#pysys.mappers.IncludeLinesBetween" title="pysys.mappers.IncludeLinesBetween"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.mappers.IncludeLinesBetween</span></code></a>, as an alternative to the
existing <code class="docutils literal notranslate"><span class="pre">startAt=</span></code>.</p></li>
</ul>
</div>
<div class="section" id="basetest-api-improvements">
<h3>BaseTest API improvements<a class="headerlink" href="#basetest-api-improvements" title="Permalink to this headline">¶</a></h3>
<p>The most significant are:</p>
<ul>
<li><p>The unwieldy <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getExprFromFile" title="pysys.basetest.BaseTest.getExprFromFile"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getExprFromFile</span></code></a> is superceded (though not actually deprecated) by the simpler functions
<a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.grep" title="pysys.basetest.BaseTest.grep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.grep</span></code></a>, <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.grepOrNone" title="pysys.basetest.BaseTest.grepOrNone"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.grepOrNone</span></code></a> and <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.grepAll" title="pysys.basetest.BaseTest.grepAll"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.grepAll</span></code></a> which provide the same capability but with more
memorable/understandable names.</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.unpackArchive" title="pysys.basetest.BaseTest.unpackArchive"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.unpackArchive</span></code></a> to make it easy to store large <code class="docutils literal notranslate"><span class="pre">Input/</span></code> assets such as log files compressed
(<code class="docutils literal notranslate"><span class="pre">.xz/.tar.xz</span></code> recommended for efficiency, but several other archive types also supported). The unpacked files
are automatically deleted during test cleanup to avoid consuming unnecessary disk space (especially if the test
fails).</p></li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.constants.html#pysys.constants.PREFERRED_ENCODING" title="pysys.constants.PREFERRED_ENCODING"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.constants.PREFERRED_ENCODING</span></code></a> which should be used in testcases instead of
<code class="docutils literal notranslate"><span class="pre">locale.getpreferredencoding()</span></code> to avoid thread-safety issues.</p></li>
<li><p>Improved usability of the color highlighting and difference marker when <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertThat" title="pysys.basetest.BaseTest.assertThat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertThat</span></code></a> or
<a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertThatGrep" title="pysys.basetest.BaseTest.assertThatGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertThatGrep</span></code></a> fail, for both primitive values and list/dict values.</p></li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.utils.fileutils.html#pysys.utils.fileutils.listDirContents" title="pysys.utils.fileutils.listDirContents"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.fileutils.listDirContents</span></code></a> for creating a normalized list of the files/directories contained
recursively within a specified directory. This is useful as input for assertions.</p></li>
<li><p>Changed <a class="reference internal" href="autodocgen/pysys.writer.outcomes.html#pysys.writer.outcomes.JUnitXMLResultsWriter" title="pysys.writer.outcomes.JUnitXMLResultsWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.outcomes.JUnitXMLResultsWriter</span></code></a> output to be more standards-compliant: added the <code class="docutils literal notranslate"><span class="pre">timestamp</span></code>
attribute, and changed the failure node to be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">failure</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;OUTCOME: Outcome reason&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;OUTCOME&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>(where OUTCOME could be FAILED, BLOCKED, etc.) instead of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">failure</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;OUTCOME&quot;</span><span class="o">&gt;</span><span class="n">Outcome</span> <span class="n">reason</span><span class="o">&lt;/</span><span class="n">failure</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This may produce better error indicators in CI systems and IDEs that parse these files.</p>
</li>
</ul>
<p>Additional improvements which will be of use to some users:</p>
<ul class="simple">
<li><p>Added <a class="reference internal" href="autodocgen/pysys.constants.html#pysys.constants.EXE_SUFFIX" title="pysys.constants.EXE_SUFFIX"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.constants.EXE_SUFFIX</span></code></a> which is <code class="docutils literal notranslate"><span class="pre">.exe</span></code> on Windows and empty string on Unix. This is convenient
when running executables.</p></li>
<li><p>Improved the failure messages for <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertGrep" title="pysys.basetest.BaseTest.assertGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertGrep</span></code></a> (with <code class="docutils literal notranslate"><span class="pre">contains=False</span></code>) and <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertLineCount" title="pysys.basetest.BaseTest.assertLineCount"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertLineCount</span></code></a>
(with <code class="docutils literal notranslate"><span class="pre">condition=&quot;==0&quot;</span></code>) to include both the first matching expression and the total number of matches. This
is useful when checking log files for unexpected errors and warnings.</p></li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.utils.allocport.html#pysys.utils.allocport.excludedTCPPorts" title="pysys.utils.allocport.excludedTCPPorts"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.allocport.excludedTCPPorts</span></code></a> which can be set before the <a class="reference internal" href="autodocgen/pysys.baserunner.html#pysys.baserunner.BaseRunner" title="pysys.baserunner.BaseRunner"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.baserunner.BaseRunner</span></code></a> is
constructed to prevent the specified ports being allocated by <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getNextAvailableTCPPort" title="pysys.basetest.BaseTest.getNextAvailableTCPPort"><code class="xref py py-obj docutils literal notranslate"><span class="pre">getNextAvailableTCPPort</span></code></a>.
By default PySys comes with exclusions for a handful of ports that are commonly blocked by web browsers for security
reasons.</p></li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.utils.allocport.html#pysys.utils.allocport.logPortAllocationStats" title="pysys.utils.allocport.logPortAllocationStats"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.allocport.logPortAllocationStats</span></code></a> which can be useful for configuring an appropriately sized
pool of TCP ports.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">key</span></code> field to <a class="reference internal" href="autodocgen/pysys.process.user.html#pysys.process.user.STDOUTERR_TUPLE" title="pysys.process.user.STDOUTERR_TUPLE"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.process.user.STDOUTERR_TUPLE</span></code></a> to make it easier to create log file paths that match
a process’s stdout/stderr files.</p></li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.utils.safeeval.html#pysys.utils.safeeval.safeEval" title="pysys.utils.safeeval.safeEval"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.safeeval.safeEval</span></code></a> for cases where you want to evaluate a Python <code class="docutils literal notranslate"><span class="pre">eval()</span></code> string from a test
plugin, for example <code class="docutils literal notranslate"><span class="pre">&quot;expected</span> <span class="pre">&gt;=</span> <span class="pre">value&quot;</span></code>. The string is evaluated in a minimal namespace unpolluted by the
current module/test, but including access to standard Python modules such as <code class="docutils literal notranslate"><span class="pre">os/sys/math</span></code> and PySys constants.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">includeCoverageFromPySysProcess</span></code> option to <a class="reference internal" href="autodocgen/pysys.writer.coverage.html#pysys.writer.coverage.PythonCoverageWriter" title="pysys.writer.coverage.PythonCoverageWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.coverage.PythonCoverageWriter</span></code></a> which is useful
for measuring code coverage when testing custom PySys plugins.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">testobj</span></code> argument to <a class="reference internal" href="autodocgen/pysys.utils.perfreporter.html#pysys.utils.perfreporter.CSVPerformanceReporter.getRunDetails" title="pysys.utils.perfreporter.CSVPerformanceReporter.getRunDetails"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.perfreporter.CSVPerformanceReporter.getRunDetails</span></code></a> in case you wish
to provide different <code class="docutils literal notranslate"><span class="pre">runDetails</span></code> based on some feature of the test object or mode.</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.pollWait" title="pysys.basetest.BaseTest.pollWait"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.pollWait</span></code></a> which should be used instead of <code class="docutils literal notranslate"><span class="pre">time.sleep</span></code> when polling for something to happen
without any log messages (or the existing <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.wait" title="pysys.basetest.BaseTest.wait"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.wait</span></code></a> for longer polls where you do want logging).
In a future release this method will be able to abort early if a test run is cancelled.</p></li>
<li><p><a class="reference internal" href="autodocgen/pysys.process.monitor.html#pysys.process.monitor.BaseProcessMonitor.stop" title="pysys.process.monitor.BaseProcessMonitor.stop"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.process.monitor.BaseProcessMonitor.stop</span></code></a> now waits for the process monitor to terminate before returning,
so that during test cleanup the process monitors will always be stopped before any processes are killed, avoiding
occasional failures of the process monitoring.</p></li>
<li><p>Moved the recently introduced <code class="docutils literal notranslate"><span class="pre">pysys.writer.testoutput.PythonCoverageWriter</span></code> to
its own module <a class="reference internal" href="autodocgen/pysys.writer.coverage.html#pysys.writer.coverage.PythonCoverageWriter" title="pysys.writer.coverage.PythonCoverageWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.coverage.PythonCoverageWriter</span></code></a> (without breaking existing configuration files that
refer to the old name).</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.deleteFile" title="pysys.basetest.BaseTest.deleteFile"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.deleteFile()</span></code></a> which provides a simple and safe way to delete a file similar to the
<a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.deleteDir" title="pysys.basetest.BaseTest.deleteDir"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.deleteDir()</span></code></a> method.</p></li>
<li><p>Added a <code class="docutils literal notranslate"><span class="pre">quiet=True/False</span></code> option to <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForGrep" title="pysys.basetest.BaseTest.waitForGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForGrep</span></code></a> to disable the INFO-level logging.</p></li>
</ul>
</div>
<div class="section" id="fixes">
<h3>Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Fixed methods such as <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertGrep" title="pysys.basetest.BaseTest.assertGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertGrep</span></code></a> to treat <code class="docutils literal notranslate"><span class="pre">ignores='a</span> <span class="pre">string'</span></code> as a list containing that string,
rather than as separate expressions containing each letter in the string which could lead to ignoring lines
that shoudl not be ignored.</p></li>
<li><p>Fixed the project property <code class="docutils literal notranslate"><span class="pre">defaultEnvirons.ENVVAR</span></code> added in 1.6.0 which did not in fact set the environment
variable as described (due to an additional unwanted <code class="docutils literal notranslate"><span class="pre">.</span></code> character); now it does.</p></li>
<li><p>Avoid creating unnecessary runner output directory as a result of <code class="docutils literal notranslate"><span class="pre">mkdir(runner.output+'/../xxx')</span></code> by
normalizing paths before calling <code class="docutils literal notranslate"><span class="pre">mkdir</span></code>.</p></li>
<li><p>Fixed <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertLineCount" title="pysys.basetest.BaseTest.assertLineCount"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertLineCount</span></code></a> bug in which <code class="docutils literal notranslate"><span class="pre">reFlags</span></code> parameter was not honored.</p></li>
<li><p>Fixed numerous Python warnings.</p></li>
<li><p>Fixed bug in which <a class="reference internal" href="autodocgen/pysys.utils.fileutils.html#pysys.utils.fileutils.toLongPathSafe" title="pysys.utils.fileutils.toLongPathSafe"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.fileutils.toLongPathSafe</span></code></a> and <a class="reference internal" href="autodocgen/pysys.utils.fileutils.html#pysys.utils.fileutils.mkdir" title="pysys.utils.fileutils.mkdir"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.fileutils.mkdir</span></code></a> would incorrectly
capitalize the first letter when passed a relative path.</p></li>
<li><p>Improved the formatting of <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">print</span> <span class="pre">--full</span></code> so it is easier to read. Most items with empty or default values
are no longer shown, so you can focus on the information that’s actually interesting.</p></li>
<li><p>Fixed bug in which <code class="docutils literal notranslate"><span class="pre">--modes</span></code> argument would not be honored if running tests with <code class="docutils literal notranslate"><span class="pre">--ci</span></code>.</p></li>
</ul>
</div>
<div class="section" id="migration-notes">
<h3>Migration notes<a class="headerlink" href="#migration-notes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="breaking-changes">
<h4>Breaking changes<a class="headerlink" href="#breaking-changes" title="Permalink to this headline">¶</a></h4>
<p>The main changes that might require changes to existing projects/tests are:</p>
<ul class="simple">
<li><p>Removal of Python 2 and 3.5 support; the minimum supported Python version is now 3.6.</p></li>
<li><p>When user-defined <code class="docutils literal notranslate"><span class="pre">mappers=</span></code> are used (for example during <code class="docutils literal notranslate"><span class="pre">self.copy</span></code>; see also <a class="reference internal" href="autodocgen/pysys.mappers.html#module-pysys.mappers" title="pysys.mappers"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.mappers</span></code></a>), it is now an
error for a mapper to strip off the trailing <code class="docutils literal notranslate"><span class="pre">\\n</span></code> character at the end of each line, as failure to do so can have
unintended consequences on later mappers. This requirement is also more clearly documented.</p></li>
<li><p>Some mistakes in the <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> structure that were previously tolerated will now produce stderr warning
messages (such as incorrectly nesting <code class="docutils literal notranslate"><span class="pre">&lt;modes&gt;</span></code> inside <code class="docutils literal notranslate"><span class="pre">&lt;groups&gt;</span></code>) and others will produce a fatal error
(for example multiple occurrences of the same element). To find out if any tests need fixing up, just execute
<code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">print</span></code>  in your PySys project directory and act on any warning or error messages.</p></li>
<li><p>The deprecated <code class="docutils literal notranslate"><span class="pre">supportMultipleModesPerRun=false</span></code> project property (only used in very old PySys projects) can no
longer be used - please change your tests to use the modern modes approach instead.</p></li>
<li><p>On Windows the <code class="docutils literal notranslate"><span class="pre">testDir</span></code> (and the input/output/reference directories) no longer start with the <code class="docutils literal notranslate"><span class="pre">\\?\</span></code>
long path prefix; instead this can be added for operations where it is needed using
<a class="reference internal" href="autodocgen/pysys.utils.fileutils.html#pysys.utils.fileutils.toLongPathSafe" title="pysys.utils.fileutils.toLongPathSafe"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.fileutils.toLongPathSafe</span></code></a> (as the standard PySys methods already do, for example <code class="docutils literal notranslate"><span class="pre">self.copy</span></code>).
Where possible it is recommended to avoid nesting tests and output directories so deeply that long path support is
needed.</p></li>
</ul>
<p>The remaining breaking changes are unlikely edge cases or in rarely used APIs that are unlikely to affect many users:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">pysys.xml</span></code> package has been renamed to <a class="reference internal" href="autodocgen/pysys.config.html#module-pysys.config" title="pysys.config"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config</span></code></a> to provide a more logical home for test descriptors
and project configuration. Aliases exist so nothing should break, however if you have added extra files to the
<code class="docutils literal notranslate"><span class="pre">pysys/xml/templates</span></code> directory such as customized <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">makeproject</span></code> templates these should now be moved to
the <code class="docutils literal notranslate"><span class="pre">pysys/config/templates</span></code> directory. It is also recommended to find/rename your framework extensions to use the
new name as the <code class="docutils literal notranslate"><span class="pre">pysys.xml</span></code> module name is deprecated and will be removed in a future
release.</p></li>
<li><p>The deprecated <code class="docutils literal notranslate"><span class="pre">pysys.process._stringToUnicode</span></code> method is now removed, since in Python 3 it is a no-op.</p></li>
<li><p>If you created a custom <a class="reference internal" href="autodocgen/pysys.config.descriptor.html#pysys.config.descriptor.DescriptorLoader" title="pysys.config.descriptor.DescriptorLoader"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.descriptor.DescriptorLoader</span></code></a> subclass to manipulate modes, you need to change
it to work with <a class="reference internal" href="autodocgen/pysys.config.descriptor.html#pysys.config.descriptor.TestMode" title="pysys.config.descriptor.TestMode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.descriptor.TestMode</span></code></a> objects instead of strings, and to set at least one of them
to be a primary mode.</p></li>
<li><p>It is now an error to have multiple <code class="docutils literal notranslate"><span class="pre">pysystest.*</span></code> filenames in a single directory, for example <code class="docutils literal notranslate"><span class="pre">pysystest.py</span></code>
and <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code>.</p></li>
<li><p>If a test’s title ends with <code class="docutils literal notranslate"><span class="pre">&quot;goes</span> <span class="pre">here</span> <span class="pre">TODO&quot;</span></code> then the test will report a <code class="docutils literal notranslate"><span class="pre">BLOCKED</span></code> outcome, to encourage
test authors to remember to fill it in. This could cause some existing tests to start blocking, though only if
you have added a title ending with <code class="docutils literal notranslate"><span class="pre">&quot;goes</span> <span class="pre">here</span> <span class="pre">TODO&quot;</span></code>.</p></li>
<li><p>Removed undocumented internal module <code class="docutils literal notranslate"><span class="pre">pysys.utils.loader</span></code>; no-one should be using this; if you are, use Python’s
<code class="docutils literal notranslate"><span class="pre">importlib.import_module()</span></code> instead.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">run</span> <span class="pre">--ci</span></code> flag now excludes tests tagged with group <code class="docutils literal notranslate"><span class="pre">manual</span></code> (in addition to excluding the
<code class="docutils literal notranslate"><span class="pre">manual</span></code> test type, since <code class="docutils literal notranslate"><span class="pre">pysystest.py</span></code> descriptors use groups for this rather than test type).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--json</span></code> output of <code class="docutils literal notranslate"><span class="pre">pysys.py</span> <span class="pre">print</span></code> now has a dict representing the modes and their parameters
for the <code class="docutils literal notranslate"><span class="pre">modes</span></code> value instead of a simple list, and the <code class="docutils literal notranslate"><span class="pre">xmlDescriptor</span></code> field was renamed to <code class="docutils literal notranslate"><span class="pre">descriptorFile</span></code>.
Also the non-JSON <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">print</span></code> output has changed slightly, especially around modes; use <code class="docutils literal notranslate"><span class="pre">--json</span></code> instead of
parsing the non-JSON output directly .</p></li>
<li><p>Removed the <code class="docutils literal notranslate"><span class="pre">primaryMode</span></code> attribute from <a class="reference internal" href="autodocgen/pysys.config.descriptor.html#pysys.config.descriptor.TestDescriptor" title="pysys.config.descriptor.TestDescriptor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.descriptor.TestDescriptor</span></code></a>, as this information is now
stored in the <a class="reference internal" href="autodocgen/pysys.config.descriptor.html#pysys.config.descriptor.TestMode" title="pysys.config.descriptor.TestMode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.descriptor.TestMode</span></code></a> object.</p></li>
</ul>
</div>
<div class="section" id="deprecations">
<h4>Deprecations<a class="headerlink" href="#deprecations" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>It is strongly recommended to use the new <a class="reference internal" href="autodocgen/pysys.constants.html#pysys.constants.PREFERRED_ENCODING" title="pysys.constants.PREFERRED_ENCODING"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.constants.PREFERRED_ENCODING</span></code></a> constant instead of
Python’s built-in <code class="docutils literal notranslate"><span class="pre">locale.getpreferredencoding()</span></code> function, to avoid thread-safety issues in your tests - use of
that function within tests should be considered as deprecated.</p></li>
<li><p>If you have a custom <a class="reference internal" href="autodocgen/pysys.utils.perfreporter.html#pysys.utils.perfreporter.CSVPerformanceReporter" title="pysys.utils.perfreporter.CSVPerformanceReporter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.perfreporter.CSVPerformanceReporter</span></code></a> subclass, the signatures for
<a class="reference internal" href="autodocgen/pysys.utils.perfreporter.html#pysys.utils.perfreporter.CSVPerformanceReporter.getRunDetails" title="pysys.utils.perfreporter.CSVPerformanceReporter.getRunDetails"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.perfreporter.CSVPerformanceReporter.getRunDetails</span></code></a> and
<a class="reference internal" href="autodocgen/pysys.utils.perfreporter.html#pysys.utils.perfreporter.CSVPerformanceReporter.getRunHeader" title="pysys.utils.perfreporter.CSVPerformanceReporter.getRunHeader"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.perfreporter.CSVPerformanceReporter.getRunHeader</span></code></a> have changed to include a <code class="docutils literal notranslate"><span class="pre">testobj</span></code> parameter.
Although this should not immediately break existing applications, to avoid future breaking changes you should
update the signatures of those methods if you override them to accept a <code class="docutils literal notranslate"><span class="pre">testobj</span></code> parameter and also any arbitrary
<code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> that may be added in future.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">pysys.xml</span></code> module is deprecated; rename any imports to use <a class="reference internal" href="autodocgen/pysys.config.html#module-pysys.config" title="pysys.config"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config</span></code></a> instead.</p></li>
<li><p>The <a class="reference internal" href="autodocgen/pysys.utils.fileunzip.html#module-pysys.utils.fileunzip" title="pysys.utils.fileunzip"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.fileunzip</span></code></a> module is deprecated; use <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.unpackArchive" title="pysys.basetest.BaseTest.unpackArchive"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.unpackArchive</span></code></a> instead. For example, replace
<code class="docutils literal notranslate"><span class="pre">unzip(gzfilename,</span> <span class="pre">binary=True)</span></code> with <code class="docutils literal notranslate"><span class="pre">self.unpackArchive(gzfilename,</span> <span class="pre">gzfilename[:-3])</span></code>.</p></li>
<li><p>The (undocumented) <code class="docutils literal notranslate"><span class="pre">DEFAULT_DESCRIPTOR</span></code> constant is now deprecated and should not be used.</p></li>
<li><p>The old <code class="docutils literal notranslate"><span class="pre">&lt;mode&gt;</span></code> elements are deprecated in favor of the new Python lambda syntax
(support for these won’t be removed any time soon, but are discouraged for new tests).</p></li>
<li><p>The <a class="reference internal" href="autodocgen/pysys.utils.pycompat.html#module-pysys.utils.pycompat" title="pysys.utils.pycompat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.pycompat</span></code></a> module is now deprecated; see the documentation inside that module for details on
how to upgrade code that is using it.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">ConsoleMakeTestHelper</span></code> class is now deprecated in favor of <a class="reference internal" href="autodocgen/pysys.launcher.console_make.html#pysys.launcher.console_make.DefaultTestMaker" title="pysys.launcher.console_make.DefaultTestMaker"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.launcher.console_make.DefaultTestMaker</span></code></a>.</p></li>
</ul>
<p>A quick way to check for the removed and deprecated items using a regular expression is shown in the following grep
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grep</span> <span class="o">-</span><span class="n">r</span> <span class="s2">&quot;\(supportMultipleModesPerRun.*alse\|DescriptorLoader\|pysys.utils.loader\|_stringToUnicode\|pysys[.]xml\|pysys.utils.fileunzip\|[^_@]DEFAULT_DESCRIPTOR\|pysys.utils.pycompat\|PY2\|string_types\|binary_type\|isstring[(]\|quotestring[(]\|openfile[(]\|ConsoleMakeTestHelper\|def getRunDetails\|def getRunHeader\|locale.getpreferredencoding\|addResource\|CommonProcessWrapper\|TEST_TEMPLATE\|DESCRIPTOR_TEMPLATE\|ThreadFilter\)&quot;</span> <span class="o">.</span>
</pre></div>
</div>
<p>(This expression also contains some removed/deprecated items from the previous 1.6.0 release, though does not attempt to cover
any earlier releases).</p>
</div>
<div class="section" id="optional-steps">
<h4>Optional steps<a class="headerlink" href="#optional-steps" title="Permalink to this headline">¶</a></h4>
<p>As the default may change in a future release, existing PySys projects are recommended to explicitly specify what
directory they wish to use to store test input by specifying one of the following 3 <code class="docutils literal notranslate"><span class="pre">&lt;input-dir&gt;</span></code> configurations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;pysysproject&gt;

  &lt;pysysdirconfig&gt;

    &lt;!-- The default for PySys projects created before 2.0 --&gt;
    &lt;input-dir&gt;Input&lt;/input-dir&gt;

    &lt;!-- Recommended for new projects - input files are stored in the testDir alongside pysystest.py --&gt;
    &lt;input-dir&gt;.&lt;/input-dir&gt;

    &lt;!-- Special option added in PySys 2.0 that auto-detects based on presence of an Input/ dir; useful for getting
      the new behaviour for new tests without the need to update or potentially create bugs in existing tests
    --&gt;
    &lt;input-dir&gt;!Input_dir_if_present_else_testDir!&lt;/input-dir&gt;

  &lt;/pysysdirconfig&gt;

&lt;/pysysproject&gt;
</pre></div>
</div>
<p>Many users will prefer to use the new <code class="docutils literal notranslate"><span class="pre">pysystest.py</span></code> style for newly created tests alongside older tests using
the <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> style. However for anyone who wants to switch entirely to the new style, a utility script for
automatically converting <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> + <code class="docutils literal notranslate"><span class="pre">run.py</span></code> tests to <code class="docutils literal notranslate"><span class="pre">pysystest.py</span></code> (without losing
version control history) is provided as part of the cookbook sample
at <a class="reference external" href="https://github.com/pysys-test/sample-cookbook/tree/main/util_scripts/pysystestxml_upgrader.py">https://github.com/pysys-test/sample-cookbook/tree/main/util_scripts/pysystestxml_upgrader.py</a></p>
<p>By default <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">make</span></code> will generate tests with a new-style <code class="docutils literal notranslate"><span class="pre">pysystest.py</span></code> file, but if you prefer to keep your
project using the previous <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> and <code class="docutils literal notranslate"><span class="pre">run.py</span></code> structure, just add this to your <code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> to
configure <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">make</span></code> to use a template that based around <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">pysysdirconfig</span><span class="o">&gt;</span>

  <span class="o">&lt;</span><span class="n">maker</span><span class="o">-</span><span class="n">template</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pysys-xml-test&quot;</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;a pre-v2.0 PySys test with pysystest.xml and run.py files&quot;</span>
    <span class="n">copy</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{pysysTemplatesDir}</span><span class="s2">/pysystest-xml-test/*&quot;</span><span class="o">/&gt;</span>

<span class="o">&lt;/</span><span class="n">pysysdirconfig</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Some users may wish to run their tests with the <code class="docutils literal notranslate"><span class="pre">PYTHONWARNINGS=error</span></code> environment variable or <code class="docutils literal notranslate"><span class="pre">-Werror</span></code> command
line argument, which prevents use of language features that Python itself has deprecated or which are likely to
result in test bugs.</p>
</div>
</div>
</div>
<div class="section" id="what-s-new-in-1-6-1">
<h2>What’s new in 1.6.1<a class="headerlink" href="#what-s-new-in-1-6-1" title="Permalink to this headline">¶</a></h2>
<p>PySys 1.6.1 was released in August 2020 and contains fixes for some edge cases regarding allocation of TCP ports
when running on GitHub(R) Actions:</p>
<ul class="simple">
<li><p>Improved detection of the server (non-ephemeral/dynamic) port range on Windows(R) as used by
<a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getNextAvailableTCPPort" title="pysys.basetest.BaseTest.getNextAvailableTCPPort"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getNextAvailableTCPPort()</span></code></a>. This was previously incorrect on recent Windows versions leading to
potential clashes with ephemeral/dynamic/local ports or an insufficient pool of server ports. In addition,
a warning is now logged if a machine is configured with no ports available for starting server processes,
and falls back to using the IANA server port range in this case. If you get this warning on Windows you can
it by reconfiguring your system (e.g. <code class="docutils literal notranslate"><span class="pre">netsh</span> <span class="pre">int</span> <span class="pre">ipv4</span> <span class="pre">set</span> <span class="pre">dynamicportrange</span> <span class="pre">tcp</span> <span class="pre">...</span></code>) or if that’s not possible,
by setting the <code class="docutils literal notranslate"><span class="pre">PYSYS_PORTS</span></code> environment variable.</p></li>
<li><p>Fixed a <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForSocket" title="pysys.basetest.BaseTest.waitForSocket"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForSocket()</span></code></a> bug on macOS(R) in which the wait never succeeds although the socket is
listening.</p></li>
<li><p>Reduced the <code class="docutils literal notranslate"><span class="pre">TIMEOUTS['WaitForAvailableTCPPort']</span></code> constant from 20 minutes to 5 minutes since a properly
configured system should not spend significant amounts of time waiting for ports and it is better to
know sooner if the port pool is exhausted.</p></li>
</ul>
</div>
<div class="section" id="what-s-new-in-1-6-0">
<h2>What’s new in 1.6.0<a class="headerlink" href="#what-s-new-in-1-6-0" title="Permalink to this headline">¶</a></h2>
<p>PySys 1.6.0 was released in August 2020.</p>
<p>The significant new features of PySys 1.6.0 are grouped around a few themes:</p>
<ul class="simple">
<li><p>a new “plugins” concept to encourage a more modular style when sharing functionality between tests;</p></li>
<li><p>easier validation with the new <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertThatGrep" title="pysys.basetest.BaseTest.assertThatGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertThatGrep()</span></code></a> method, which extracts a value using a grep
expression and then checks its value is as expected. For extract-and-assert use cases this approach gives much
clearer messages when the assert fails than using assertGrep;</p></li>
<li><p>new writers for recording test results, including GitHub(R) Actions support and a writer that produces .zip
archives of test output directories, plus new APIs to allow writers to publish artifacts, and to visit each of
the test’s output files;</p></li>
<li><p>a library of line mappers for more powerful copy and grep line pre-processing;</p></li>
<li><p>process starting enhancements such as <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForBackgroundProcesses" title="pysys.basetest.BaseTest.waitForBackgroundProcesses"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForBackgroundProcesses()</span></code></a>, automatic logging of stderr when
a process fails, and <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForGrep" title="pysys.basetest.BaseTest.waitForGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForGrep()</span></code></a> can now abort based on error messages in a different file;</p></li>
<li><p>several pysys.py and project configuration enhancements that make running and configuring PySys easier.</p></li>
<li><p>a new “getting started” <a class="reference external" href="https://github.com/pysys-test/sample-getting-started">sample</a> project which can be
easily forked from GitHub(R) to create new PySys-based projects. The sample also demonstrates common techniques
and best practices for writing tests in PySys.</p></li>
</ul>
<p>As this is a major release of PySys there are also some changes in this release that may require changes to your
project configuration file and/or runner/basetest/writer framework extension classes you’ve written (though in most
cases it won’t be necessary to change individual tests). These breaking changes are either to reduce the chance of
errors going undetected, or to support bug fixes and implementation simplification. So be sure to look at the upgrade
guide below if you want to switch an existing project to use the new version.</p>
<div class="section" id="new-plugin-api">
<h3>New Plugin API<a class="headerlink" href="#new-plugin-api" title="Permalink to this headline">¶</a></h3>
<p>This release introduces a new concept: test and runner “plugins” which provide shared functionality available for
use in testcases.</p>
<p>Existing users will be familiar with the pattern of creating one or more BaseTest framework subclasses to provide a
convenient place for functionality needed by many tests, such as launching the applications you’re testing, or
starting compilation or deployment tools. This traditional approach of using <em>inheritance</em> to share functionality does
have some merits, but in many projects it can lead to unhelpful complexity because:</p>
<ol class="loweralpha simple">
<li><p>it’s not always clear what functionality is provided by your custom subclasses rather than by PySys itself
(which makes it hard to know which documentation to look at)</p></li>
<li><p>there is no automatic namespacing to prevent custom functionality clashing with methods PySys may add in future</p></li>
<li><p>sometimes a test needs functionality from more than one base class, and it’s easy to get multiple inheritance
wrong</p></li>
<li><p>none of this really lends itself well to third parties implementing and distributing additional PySys
capabilities to support additional tools/languages etc</p></li>
</ol>
<p>So, in this release we introduce the concept of “plugins” which use <em>composition</em> rather than <em>inheritance</em> to
provide a simpler way to share functionality across tests. There are currently 3 kinds of plugin:</p>
<ul class="simple">
<li><p><strong>test plugins</strong>; instances of test plugins are created for each <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest" title="pysys.basetest.BaseTest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest</span></code></a> that is instantiated, which allows them
to operate independently of other tests, starting and stopping processes just like code in the <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest" title="pysys.basetest.BaseTest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest</span></code></a> class
would. Test plugins are configured with <code class="docutils literal notranslate"><span class="pre">&lt;test-plugin</span> <span class="pre">classname=&quot;...&quot;</span> <span class="pre">alias=&quot;...&quot;/&gt;</span></code> and can be any Python
class provided it has a method <code class="docutils literal notranslate"><span class="pre">setup(self,</span> <span class="pre">testobj)</span></code> (and no constructor arguments).
As the plugins are instantiated just after the <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest" title="pysys.basetest.BaseTest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest</span></code></a> subclass, you can use them any time after (but not within)
your test’s <code class="xref py py-obj docutils literal notranslate"><span class="pre">__init__()</span></code> constructor (for example, in <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.setup" title="pysys.basetest.BaseTest.setup"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.setup()</span></code></a>).</p></li>
<li><p><strong>runner plugins</strong>; these are instantiated just once per invocation of PySys, by the BaseRunner,
before <a class="reference internal" href="autodocgen/pysys.baserunner.html#pysys.baserunner.BaseRunner.setup" title="pysys.baserunner.BaseRunner.setup"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.baserunner.BaseRunner.setup()</span></code></a> is called. Unlike test plugins, any processes or state they maintain are
shared across all tests. These can be used to start servers/VMs that are shared across tests.
Runner plugins are configured with <code class="docutils literal notranslate"><span class="pre">&lt;runner-plugin</span> <span class="pre">classname=&quot;...&quot;</span> <span class="pre">alias=&quot;...&quot;/&gt;</span></code> and can be any Python
class provided it has a method <code class="docutils literal notranslate"><span class="pre">setup(self,</span> <span class="pre">runner)</span></code> (and no constructor arguments).</p></li>
<li><p><strong>writer plugins</strong>: this kind of plugin has existed in PySys for many releases and are effectively a special kind of
runner plugin with extra callbacks to allow them to write test results and/or output files to a variety of
destinations. Writers must implement a similar but different interface to other runner plugins; see <a class="reference internal" href="autodocgen/pysys.writer.html#module-pysys.writer" title="pysys.writer"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer</span></code></a>
for details. They can be used for everything from writing test outcome to an XML file, to archiving output files, to
collecting files from each test output and using them to generate a code coverage report during cleanup at the end
of the run.</p></li>
</ul>
<p>A test plugin could look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyTestPlugin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="n">myPluginProperty</span> <span class="o">=</span> <span class="s1">&#39;default value&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Example of a plugin configuration property. The value for this plugin instance can be overridden using ``&lt;property .../&gt;``.</span>
<span class="sd">        Types such as boolean/list[str]/int/float will be automatically converted from string.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testObj</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testObj</span> <span class="o">=</span> <span class="n">testObj</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pysys.myorg.MyRunnerPlugin&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Created MyTestPlugin instance with myPluginProperty=</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">myPluginProperty</span><span class="p">)</span>

                <span class="n">testObj</span><span class="o">.</span><span class="n">addCleanupFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__myPluginCleanup</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__myPluginCleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Cleaning up MyTestPlugin instance&#39;</span><span class="p">)</span>

        <span class="c1"># An example of providing a method that can be accessed from each test</span>
        <span class="k">def</span> <span class="nf">getPythonVersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">startProcess</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;--version&#39;</span><span class="p">],</span> <span class="n">stdouterr</span><span class="o">=</span><span class="s1">&#39;MyTestPlugin.pythonVersion&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">waitForGrep</span><span class="p">(</span><span class="s1">&#39;MyTestPlugin.pythonVersion.out&#39;</span><span class="p">,</span> <span class="s1">&#39;(?P&lt;output&gt;.+)&#39;</span><span class="p">)[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>
</div>
<p>With configuration like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">pysysproject</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">test</span><span class="o">-</span><span class="n">plugin</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;myorg.testplugin.MyTestPlugin&quot;</span> <span class="n">alias</span><span class="o">=</span><span class="s2">&quot;myalias&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">pysysproject</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>… you can now access methods defined by the plugin from your tests using <code class="docutils literal notranslate"><span class="pre">self.myalias.getPythonVersion()</span></code>.</p>
<p>You can add any number of test and/or runner plugins to your project, perhaps a mixture of custom plugins specific
to your application, and third party PySys plugins supporting standard tools and languages.</p>
<p>In addition to the alias-based lookup, plugins can get a list of the other plugin instances added through the XML
using <code class="docutils literal notranslate"><span class="pre">self.testPlugins</span></code> (from <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest" title="pysys.basetest.BaseTest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest</span></code></a>) or <code class="docutils literal notranslate"><span class="pre">self.runnerPlugins</span></code> (from <a class="reference internal" href="autodocgen/pysys.baserunner.html#pysys.baserunner.BaseRunner" title="pysys.baserunner.BaseRunner"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.baserunner.BaseRunner</span></code></a>), which
provides a way for plugins to reference each other without depending on the aliases that may be in use in a
particular project configuration.</p>
<p>For examples of the project configuration, including how to set plugin-specific properties that will be passed to
its constructor, see the sample <code class="docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> file.</p>
</div>
<div class="section" id="new-and-improved-result-writers">
<h3>New and improved result writers<a class="headerlink" href="#new-and-improved-result-writers" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.writer.testoutput.html#pysys.writer.testoutput.TestOutputArchiveWriter" title="pysys.writer.testoutput.TestOutputArchiveWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.testoutput.TestOutputArchiveWriter</span></code></a> that creates zip archives of each failed test’s output directory,
producing artifacts that could be uploaded to a CI system or file share to allow the failures to be analysed.
Properties are provided to allow detailed control of the maximum number and size of archives generated, and the
files to include/exclude.</p></li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.writer.ci.html#pysys.writer.ci.GitHubActionsCIWriter" title="pysys.writer.ci.GitHubActionsCIWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.ci.GitHubActionsCIWriter</span></code></a> which if added to your pysysproject.xml will automatically enable
various features when run from GitHub(R) Actions including annotations summarizing failures, grouping/folding of
detailed test output, and setting output variables for published artifacts (e.g. performance .csv files, archived
test output etc) which can be used to upload the artifacts when present.</p>
<p>See <code class="xref py py-obj docutils literal notranslate"><span class="pre">https://github.com/pysys-test/sample-getting-started</span></code> for an example workflow file you can copy into your
own project.</p>
<p>This uses the new <a class="reference internal" href="autodocgen/pysys.writer.api.html#pysys.writer.api.TestOutcomeSummaryGenerator" title="pysys.writer.api.TestOutcomeSummaryGenerator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.api.TestOutcomeSummaryGenerator</span></code></a> mix-in class that can be used when implementing CI
writers to get a summary of test outcomes.</p>
</li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.writer.api.html#pysys.writer.api.ArtifactPublisher" title="pysys.writer.api.ArtifactPublisher"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.api.ArtifactPublisher</span></code></a> interface which can be implemented by writers that support some concept of
artifact publishing, for example CI providers that ‘upload’ artifacts. Artifacts are published by
various <a class="reference internal" href="autodocgen/pysys.utils.perfreporter.html#pysys.utils.perfreporter.CSVPerformanceReporter" title="pysys.utils.perfreporter.CSVPerformanceReporter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.perfreporter.CSVPerformanceReporter</span></code></a> and various writers
including <a class="reference internal" href="autodocgen/pysys.writer.testoutput.html#pysys.writer.testoutput.TestOutputArchiveWriter" title="pysys.writer.testoutput.TestOutputArchiveWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.testoutput.TestOutputArchiveWriter</span></code></a>.</p></li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.writer.testoutput.html#pysys.writer.testoutput.CollectTestOutputWriter" title="pysys.writer.testoutput.CollectTestOutputWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.testoutput.CollectTestOutputWriter</span></code></a> which supercedes the <code class="docutils literal notranslate"><span class="pre">collect-test-output</span></code> feature,
providing a more powerful way to collect files of interest (e.g. performance graphs, code coverage files, etc) from
all tests and collate them into a single directory and optionally a .zip archive.
This uses the new <a class="reference internal" href="autodocgen/pysys.writer.api.html#pysys.writer.api.TestOutputVisitor" title="pysys.writer.api.TestOutputVisitor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.api.TestOutputVisitor</span></code></a> writer interface which can be implemented by writers that wish
to visit each (non-zero) file in the test output directory after each test.</p>
<p>The CollectTestOutputWriter can be used standalone, or as a base class for writers that collect a particular kind
of file (e.g. code coverage) and then do something with it during the runner cleanup phase when all tests have
completed.</p>
</li>
<li><p>Moved Python code coverage generation out to <code class="docutils literal notranslate"><span class="pre">pysys.writer.testoutput.PythonCoverageWriter</span></code> (as of 2.0,
it’s now in <a class="reference internal" href="autodocgen/pysys.writer.coverage.html#pysys.writer.coverage.PythonCoverageWriter" title="pysys.writer.coverage.PythonCoverageWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.coverage.PythonCoverageWriter</span></code></a>) as an example of how to use a plugin to add
code coverage support without subclassing the runner. Existing projects use this behind the scenes, but new projects
should add the writer to their configuration explicitly if they need it (see sample project).</p></li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.writer.console.html#pysys.writer.console.ConsoleFailureAnnotationsWriter" title="pysys.writer.console.ConsoleFailureAnnotationsWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.console.ConsoleFailureAnnotationsWriter</span></code></a> that prints a single annotation line to stdout for each test
failure, for the benefit of IDEs and CI providers that can highlight failures found by regular expression stdout
parsing. An instance of this writer is automatically added to every project, and enables itself if
the <code class="docutils literal notranslate"><span class="pre">PYSYS_CONSOLE_FAILURE_ANNOTATIONS</span></code> environment variable is set, producing make-style console output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">project</span>\<span class="n">test</span>\<span class="n">MyTest_001</span>\<span class="n">pysystest</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">TIMED</span> <span class="n">OUT</span> <span class="o">-</span> <span class="n">Reason</span> <span class="k">for</span> <span class="n">timed</span> <span class="n">out</span> <span class="n">outcome</span> <span class="ow">is</span> <span class="n">general</span> <span class="n">tardiness</span> <span class="p">(</span><span class="n">MyTest_001</span> <span class="p">[</span><span class="n">CYCLE</span> <span class="mi">02</span><span class="p">])</span>
</pre></div>
</div>
<p>The format can be customized using the <code class="docutils literal notranslate"><span class="pre">PYSYS_CONSOLE_FAILURE_ANNOTATIONS</span></code> environment variable, or alternatively
additional instances can be added to the project writers configuration and configured using the properties
described in the writer class.</p>
</li>
<li><p>Added a <code class="docutils literal notranslate"><span class="pre">runDetails</span></code> dictionary to <a class="reference internal" href="autodocgen/pysys.baserunner.html#pysys.baserunner.BaseRunner" title="pysys.baserunner.BaseRunner"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.baserunner.BaseRunner</span></code></a>. This is a dictionary of string metadata about
this test run, and is included in performance summary CSV reports and by some writers. The console summary writer
logs the runDetails when executing 2 or more tests.</p>
<p>The default runDetails contains a few standard values (currently these include <code class="docutils literal notranslate"><span class="pre">outDirName</span></code>, <code class="docutils literal notranslate"><span class="pre">hostname</span></code>, <code class="docutils literal notranslate"><span class="pre">os</span></code>
and <code class="docutils literal notranslate"><span class="pre">startTime</span></code>). Additional items can be added by runner subclasses in the <a class="reference internal" href="autodocgen/pysys.baserunner.html#pysys.baserunner.BaseRunner.setup" title="pysys.baserunner.BaseRunner.setup"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.baserunner.BaseRunner.setup()</span></code></a>
method - for example you could add the build number of your application (perhaps read
using <a class="reference internal" href="autodocgen/pysys.utils.fileutils.html#pysys.utils.fileutils.loadProperties" title="pysys.utils.fileutils.loadProperties"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.fileutils.loadProperties()</span></code></a>).</p>
<p>If you had previously created a custom <a class="reference internal" href="autodocgen/pysys.utils.perfreporter.html#pysys.utils.perfreporter.CSVPerformanceReporter.getRunDetails" title="pysys.utils.perfreporter.CSVPerformanceReporter.getRunDetails"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.perfreporter.CSVPerformanceReporter.getRunDetails()</span></code></a> method it
is recommended to remove it and instead provide the same information in the runner <code class="docutils literal notranslate"><span class="pre">runDetails</span></code>.</p>
</li>
<li><p>Added property <code class="docutils literal notranslate"><span class="pre">versionControlGetCommitCommand</span></code> which if set results in the specified command line
being executed (in the testRootDir) when the test run starts and used to populate the <code class="docutils literal notranslate"><span class="pre">vcsCommit</span></code> key in the
runner’s <code class="docutils literal notranslate"><span class="pre">runDetails</span></code> with a commit/revision number from your version control system. This is a convenient way to
ensure writers and performance reports include the version of the application you’re testing with.</p></li>
</ul>
<p>There are also some more minor enhancements to the writers:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="autodocgen/pysys.writer.html#module-pysys.writer" title="pysys.writer"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer</span></code></a> module has been split up into separate submodules. However the writers module imports all symbols
from the new submodules, so no change is required in your code or projects that reference pysys.writer.XXX classes.</p></li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.writer.console.html#pysys.writer.console.ConsoleSummaryResultsWriter" title="pysys.writer.console.ConsoleSummaryResultsWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.console.ConsoleSummaryResultsWriter</span></code></a> property for <code class="docutils literal notranslate"><span class="pre">showTestTitle</span></code> (default=False) as sometimes seeing
the titles of tests can be helpful when triaging results. There is also a new <code class="docutils literal notranslate"><span class="pre">showTestDir</span></code> which allows the
testDir to be displayed in addition to the output dir in cases where the output dir is not located underneath
the test dir (due to –outdir). Also changed the defaults for some other properties to
showOutcomeReason=True and showOutputDir=True, which are recommended for better visibility into why tests failed.
They can be disabled if desired in the project configuration.</p></li>
<li><p>Added a summary of INSPECT and NOTVERIFIED outcomes at the end of test execution (similar to the existing failures
summary), since often these outcomes do require human attention. This can be disabled using the properties on
<a class="reference internal" href="autodocgen/pysys.writer.console.html#pysys.writer.console.ConsoleSummaryResultsWriter" title="pysys.writer.console.ConsoleSummaryResultsWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.console.ConsoleSummaryResultsWriter</span></code></a> if desired.</p></li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.utils.logutils.html#pysys.utils.logutils.stripANSIEscapeCodes" title="pysys.utils.logutils.stripANSIEscapeCodes"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.logutils.stripANSIEscapeCodes()</span></code></a> which can be used to remove ANSI escape codes such as console
color instructions from the <code class="docutils literal notranslate"><span class="pre">runLogOutput=</span></code> parameter of a custom writer (<a class="reference internal" href="autodocgen/pysys.writer.api.html#pysys.writer.api.BaseResultsWriter" title="pysys.writer.api.BaseResultsWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.api.BaseResultsWriter</span></code></a>),
since usually you wouldn’t want these if writing the output to a file.</p></li>
</ul>
</div>
<div class="section" id="more-powerful-copy-and-line-mapping">
<h3>More powerful copy and line mapping<a class="headerlink" href="#more-powerful-copy-and-line-mapping" title="Permalink to this headline">¶</a></h3>
<p>Manipulating the contents of text files is a very common task in system tests, and this version of PySys has
several improvements that make this easier:</p>
<ul>
<li><p>PySys now comes with some predefined mappers for common pre-processing tasks such as selecting multiple lines of
interest between two regular expressions, and stripping out timestamps and other regular expressions.</p>
<p>These can be found in the new <a class="reference internal" href="autodocgen/pysys.mappers.html#module-pysys.mappers" title="pysys.mappers"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.mappers</span></code></a> module and are particularly useful when using <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.copy" title="pysys.basetest.BaseTest.copy"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.copy()</span></code></a> to
pre-process a file before calling <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertDiff" title="pysys.basetest.BaseTest.assertDiff"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertDiff</span></code></a> to compare it to a reference file. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">assertDiff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s1">&#39;myfile.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;myfile-processed.txt&#39;</span><span class="p">,</span> <span class="n">mappers</span><span class="o">=</span><span class="p">[</span>
         <span class="n">pysys</span><span class="o">.</span><span class="n">mappers</span><span class="o">.</span><span class="n">IncludeLinesBetween</span><span class="p">(</span><span class="s1">&#39;Error message .*:&#39;</span><span class="p">,</span> <span class="n">stopBefore</span><span class="o">=</span><span class="s1">&#39;^$&#39;</span><span class="p">),</span>
         <span class="n">pysys</span><span class="o">.</span><span class="n">mappers</span><span class="o">.</span><span class="n">RegexReplace</span><span class="p">(</span><span class="n">pysys</span><span class="o">.</span><span class="n">mappers</span><span class="o">.</span><span class="n">RegexReplace</span><span class="o">.</span><span class="n">DATETIME_REGEX</span><span class="p">,</span> <span class="s1">&#39;&lt;timestamp&gt;&#39;</span><span class="p">),</span>
    <span class="p">]),</span>
    <span class="s1">&#39;reference-myfile-processed.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(Note that for convenience we use the fact that copy() returns the destination path to allow passing it directly
as the first file for assertDiff to work on).</p>
</li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertGrep" title="pysys.basetest.BaseTest.assertGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertGrep</span></code></a> has a new mappers= argument that can be used to pre-process the lines of a file before
grepping using any mapper function. The main use of this is to allow grepping within a range of lines, as defined by
the <a class="reference internal" href="autodocgen/pysys.mappers.html#pysys.mappers.IncludeLinesBetween" title="pysys.mappers.IncludeLinesBetween"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.mappers.IncludeLinesBetween</span></code></a> mapper:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">assertGrep</span><span class="p">(</span><span class="s1">&#39;example.log&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;MyClass&#39;</span><span class="p">,</span> <span class="n">mappers</span><span class="o">=</span><span class="p">[</span>
     <span class="n">pysys</span><span class="o">.</span><span class="n">mappers</span><span class="o">.</span><span class="n">IncludeLinesBetween</span><span class="p">(</span><span class="s1">&#39;Error message.* - stack trace is:&#39;</span><span class="p">,</span> <span class="n">stopBefore</span><span class="o">=</span><span class="s1">&#39;^$&#39;</span><span class="p">)</span> <span class="p">])</span>
</pre></div>
</div>
<p>This is more reliable than trying to achieve the same effect with <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertOrderedGrep" title="pysys.basetest.BaseTest.assertOrderedGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertOrderedGrep</span></code></a> (which can give
incorrect results if the section markers appear more than once in the file). Therefore, in most cases it’s best to
avoid assertOrderedGrep() and instead try to use <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertDiff" title="pysys.basetest.BaseTest.assertDiff"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertDiff</span></code></a> or <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertGrep" title="pysys.basetest.BaseTest.assertGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertGrep</span></code></a>.</p>
</li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForGrep" title="pysys.basetest.BaseTest.waitForGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForGrep</span></code></a> and <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getExprFromFile" title="pysys.basetest.BaseTest.getExprFromFile"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getExprFromFile</span></code></a> also now support a mappers= argument.</p></li>
<li><p>When used from <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.copy" title="pysys.basetest.BaseTest.copy"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.copy</span></code></a> there is also support for line mappers to be notified when starting/finishing a new
file, which allows for complex and stateful transformation of file contents based on file types/path if needed.</p></li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.copy" title="pysys.basetest.BaseTest.copy"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.copy</span></code></a> can now be used to copy directories in addition to individual files.</p>
<p>It is recommended to use this method instead of <code class="docutils literal notranslate"><span class="pre">shutil.copytree</span></code> as it provides a number of benefits including
better error safety, long path support, and the ability to copy over an existing directory.</p>
</li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.copy" title="pysys.basetest.BaseTest.copy"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.copy</span></code></a> now permits the source and destination to be the same (except for directory copies) which allows it
to be used for in-place transformations.</p></li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.copy" title="pysys.basetest.BaseTest.copy"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.copy</span></code></a> now copies all file attributes including date/time, not just the Unix permissions/mode.</p></li>
</ul>
</div>
<div class="section" id="assertion-improvements">
<h3>Assertion improvements<a class="headerlink" href="#assertion-improvements" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertThatGrep" title="pysys.basetest.BaseTest.assertThatGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertThatGrep()</span></code></a> which makes it easier to do the common operation of extracting a value using grep
and then performing a validation on it using <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertThat" title="pysys.basetest.BaseTest.assertThat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertThat</span></code></a>.</p>
<p>This is essentially a simplified wrapper around the functionality added in 1.5.1, but avoids the need for slightly
complex syntax and hopefully will encourage people to use the extract-then-assert paradigm rather than trying to do
them both at the same time with a single <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertGrep" title="pysys.basetest.BaseTest.assertGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertGrep</span></code></a> which is less powerful and produces much less
informative messages when there’s a failure.</p>
<p>The new method is very easy to use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">assertThatGrep</span><span class="p">(</span><span class="s1">&#39;myserver.log&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Successfully authenticated user &quot;([^&quot;]*)&quot;&#39;</span><span class="p">,</span>
    <span class="s2">&quot;value == expected&quot;</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="s1">&#39;myuser&#39;</span><span class="p">)</span>

<span class="c1"># In cases where you need multiple regex groups for matching purpose, name the one containing the value using (?P&lt;value&gt;...)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">assertThatGrep</span><span class="p">(</span><span class="s1">&#39;myserver.log&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Successfully authenticated user &quot;([^&quot;]*)&quot; in (?P&lt;value&gt;[^ ]+) seconds&#39;</span><span class="p">,</span>
    <span class="s2">&quot;0.0 &lt;= float(value) &lt;= 60.0&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>All assertion methods that have the (deprecated and unnecessary) <code class="docutils literal notranslate"><span class="pre">filedir</span></code> as their second positional (non-keyword)
argument now support the more natural pattern of giving the expr/exprList as the second positional argument,
so instead of doing <code class="docutils literal notranslate"><span class="pre">self.assertGrep('file',</span> <span class="pre">expr='Foo.*')</span></code> you can also now use the more
natural <code class="docutils literal notranslate"><span class="pre">self.assertGrep('file',</span> <span class="pre">'Foo.*')</span></code>. For compatibility with existing testcases, the old signature of
<code class="docutils literal notranslate"><span class="pre">self.assertGrep('file',</span> <span class="pre">'filedir',</span> <span class="pre">[expr=]'expr')</span></code> continues to behave as before, but the recommended usage
in new tests is now to avoid all use of filedir as a positional argument for consistency and readability. (If you
need to set the filedir, you can use the keyword argument or just add it as a prefix to the <code class="docutils literal notranslate"><span class="pre">file</span></code> argument).</p></li>
</ul>
</div>
<div class="section" id="simpler-process-handling">
<h3>Simpler process handling<a class="headerlink" href="#simpler-process-handling" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess()</span></code></a> now logs the last few lines of stderr before aborting the test when a process fails. This
behaviour can be customized with a new <code class="docutils literal notranslate"><span class="pre">onError=</span></code> parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Log stdout instead of stderr</span>
<span class="bp">self</span><span class="o">.</span><span class="n">startProcess</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">onError</span><span class="o">=</span><span class="k">lambda</span> <span class="n">process</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">logFileContents</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">tail</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># Unless stderr is empty, log it and then use it to extract an error message (which will appear in the outcome reason)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">startProcess</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">onError</span><span class="o">=</span><span class="k">lambda</span> <span class="n">process</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">logFileContents</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">tail</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExprFromFile</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s1">&#39;Error: (.*)&#39;</span><span class="p">)</span>

<span class="c1"># Do nothing on error</span>
<span class="bp">self</span><span class="o">.</span><span class="n">startProcess</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">onError</span><span class="o">=</span><span class="k">lambda</span> <span class="n">process</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForGrep" title="pysys.basetest.BaseTest.waitForGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForGrep</span></code></a> has a new optional <code class="docutils literal notranslate"><span class="pre">errorIf=</span></code> parameter that accepts a function which can trigger an abort
if it detects an error condition (not only in the file being waited on, as <code class="docutils literal notranslate"><span class="pre">errorExpr=</span></code> does). For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">waitForGrep</span><span class="p">(</span><span class="s1">&#39;myoutput.txt&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s1">&#39;My message&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
  <span class="n">process</span><span class="o">=</span><span class="n">myprocess</span><span class="p">,</span> <span class="n">errorIf</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExprFromFile</span><span class="p">(</span><span class="s1">&#39;myprocess.log&#39;</span><span class="p">,</span> <span class="s1">&#39; ERROR .*&#39;</span><span class="p">,</span> <span class="n">returnNoneIfMissing</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitProcess" title="pysys.basetest.BaseTest.waitProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitProcess()</span></code></a> now has a <code class="docutils literal notranslate"><span class="pre">checkExitStatus=</span></code> argument that can be used to check the return code of the
process for success.</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForBackgroundProcesses" title="pysys.basetest.BaseTest.waitForBackgroundProcesses"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForBackgroundProcesses()</span></code></a> which waits for completion of all background processes and optionally
checks for the expected exit status. This is especially useful when you have a test that needs to execute
lots of processes but doesn’t care about the order they execute in, since having them all execute concurrently in the
background and then calling waitForBackgroundProcesses() will be a lot quicker than executing them serially in the
foreground.</p></li>
<li><p>Added a way to set global defaults for environment variables that will be used by <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess()</span></code></a>, using
project properties. For example, to set the <code class="docutils literal notranslate"><span class="pre">JAVA_TOOL_OPTIONS</span></code> environment variable that Java(R) uses for JVM
arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;defaultEnvirons.JAVA_TOOL_OPTIONS&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;-Xmx512M&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>When you want to set environment variables globally to affect all processes in all tests, this is simpler than
providing a custom override of <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getDefaultEnvirons" title="pysys.basetest.BaseTest.getDefaultEnvirons"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getDefaultEnvirons()</span></code></a>.</p>
</li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess()</span></code></a> now accepts an <code class="docutils literal notranslate"><span class="pre">info={}</span></code> argument which can hold a dictionary of user-defined metadata
about the process such as port numbers, log file paths etc.</p></li>
</ul>
</div>
<div class="section" id="pysys-py-and-project-configuration-improvements">
<h3>pysys.py and project configuration improvements<a class="headerlink" href="#pysys-py-and-project-configuration-improvements" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Added environment variable <code class="docutils literal notranslate"><span class="pre">PYSYS_DEFAULT_ARGS</span></code> which can be used to specify default arguments that the current
user/machine should use with pysys run, to avoid the need to explicitly provide them on the command line
each time, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PYSYS_DEFAULT_ARGS</span><span class="o">=--</span><span class="n">progress</span> <span class="o">--</span><span class="n">outdir</span> <span class="n">__pysys_outdir</span>
<span class="n">pysys</span><span class="o">.</span><span class="n">py</span> <span class="n">run</span>
</pre></div>
</div>
</li>
<li><p>The sample project file and project defaults introduce a new naming convention of <code class="docutils literal notranslate"><span class="pre">__pysys_*</span></code> for output
directories and files created by PySys (for example, by writers). This helps avoid outputs getting mixed up with
testcase directories and also allows for easier ignore rules for version control systems.</p></li>
<li><p>Added command line option <code class="docutils literal notranslate"><span class="pre">-j</span></code> as an alias for <code class="docutils literal notranslate"><span class="pre">--threads</span></code> (to control the number of jobs/threads). The old
command line option <code class="docutils literal notranslate"><span class="pre">-n</span></code> continues to work, but <code class="docutils literal notranslate"><span class="pre">-j</span></code> is the main short name that’s documented for it.
As an alternative to specifying an absolute number of threads, a multiplier of the number of cores in the machine
can be provided e.g. <code class="docutils literal notranslate"><span class="pre">-j</span> <span class="pre">x1.5</span></code>. This could be useful in CI and other automated testing environments.
Finally, if only one test is selected it will single-threaded regardless of the <code class="docutils literal notranslate"><span class="pre">--threads</span></code> argument.</p></li>
<li><p>Added support for including Python log messages for categories other than pysys.* in the PySys test output,
using a “python:” prefix on the category name, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pysys</span> <span class="n">run</span> <span class="o">-</span><span class="n">v</span> <span class="n">python</span><span class="p">:</span><span class="n">myorg</span><span class="o">.</span><span class="n">mycategory</span><span class="o">=</span><span class="n">debug</span>
</pre></div>
</div>
</li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">run</span> <span class="pre">--ci</span></code> option which automatically sets the best defaults for non-interactive execution of PySys
to make it easier to run in CI jobs. See <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">run</span> <span class="pre">--help</span></code> for more information.</p></li>
<li><p>Added convention of having a <code class="docutils literal notranslate"><span class="pre">-XcodeCoverage</span></code> command line option that enables coverage for all supported
languages. You may wish to add support for this is you have a plugin providing support for a different language.</p></li>
<li><p>Added a standard property <code class="docutils literal notranslate"><span class="pre">${os}</span></code> to the project file for finer-grained control of platform-specific properties.
The new  <code class="docutils literal notranslate"><span class="pre">${os}</span></code> property gets its value from Python’s <code class="docutils literal notranslate"><span class="pre">platform.system().lower()</span></code>, and has values such
as <code class="docutils literal notranslate"><span class="pre">windows</span></code>, <code class="docutils literal notranslate"><span class="pre">linux</span></code>, <code class="docutils literal notranslate"><span class="pre">darwin</span></code>, etc. For comparison the existing <code class="docutils literal notranslate"><span class="pre">${osfamily}</span></code> is always either
<code class="docutils literal notranslate"><span class="pre">windows</span></code> or <code class="docutils literal notranslate"><span class="pre">unix</span></code>.</p></li>
<li><p>Added a standard property <code class="docutils literal notranslate"><span class="pre">${outDirName}</span></code> to the project file which is the basename from the <code class="docutils literal notranslate"><span class="pre">-outdir</span></code>, giving
a user-customizable “name” for the current test run that can be used in project property paths to keep test
runs separate, for example, this could be used to label performance CSV files from separate test runs with
<code class="docutils literal notranslate"><span class="pre">--outdir</span> <span class="pre">perf_baseline</span></code> and <code class="docutils literal notranslate"><span class="pre">--outdir</span> <span class="pre">after_perf_improvements</span></code>.</p></li>
<li><p>The standard project property <code class="docutils literal notranslate"><span class="pre">testRootDir</span></code> is now defined automatically without the need to
add the boilerplate <code class="docutils literal notranslate"><span class="pre">&lt;property</span> <span class="pre">root=&quot;testRootDir&quot;/&gt;</span></code> to your project configuration. The old property name <code class="docutils literal notranslate"><span class="pre">root</span></code>
continues to be defined for compatibility with older projects.</p></li>
<li><p>When importing a properties file using <code class="docutils literal notranslate"><span class="pre">&lt;property</span> <span class="pre">file=...</span> <span class="pre">/&gt;&quot;</span> <span class="pre">there</span> <span class="pre">are</span> <span class="pre">some</span> <span class="pre">new</span> <span class="pre">attributes</span> <span class="pre">available</span> <span class="pre">for</span>
<span class="pre">controlling</span> <span class="pre">how</span> <span class="pre">the</span> <span class="pre">properties</span> <span class="pre">are</span> <span class="pre">imported:</span> <span class="pre">``includes=</span></code> and <code class="docutils literal notranslate"><span class="pre">excludes=</span></code> allow a regular expression to be
specified to control which properties keys in the file will be imported, and <code class="docutils literal notranslate"><span class="pre">prefix=</span></code> allows a string prefix to
be added onto every imported property, which provides namespacing so you know where each property came from and a
way to ensure there is no clash with other properties.</p></li>
<li><p>Added a handler for notifications from Python’s ‘’warnings’’ module so that any warnings are logged to run.log with
a stack trace (rather than just in stderr which is hard to track down). There is also a summary WARN log message at
the end of the test run if any Python warnings were encountered. There is however no error so users can choose when
and whether to deal with the warnings.</p></li>
<li><p>Colored output is disabled if the <code class="docutils literal notranslate"><span class="pre">NO_COLOR</span></code> environment variable is set; this is a cross-product standard
(<a class="reference external" href="https://no-color.org/">https://no-color.org/</a>). The <code class="docutils literal notranslate"><span class="pre">PYSYS_COLOR</span></code> variable take precedence if set.</p></li>
<li><p>Code coverage can now be disabled automatically for tests where it is not wanted (e.g. performance tests) by adding
the <code class="docutils literal notranslate"><span class="pre">disableCoverage</span></code> group to the <code class="docutils literal notranslate"><span class="pre">pysystest.*</span></code> descriptor, or the <code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> for a whole
directory. This is equivalent to setting the <code class="docutils literal notranslate"><span class="pre">self.disableCoverage</span></code> attribute on the base test.</p></li>
<li><p><a class="reference internal" href="autodocgen/pysys.writer.coverage.html#pysys.writer.coverage.PythonCoverageWriter" title="pysys.writer.coverage.PythonCoverageWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Python</span> <span class="pre">code</span> <span class="pre">coverage</span></code></a> now produces an XML <code class="docutils literal notranslate"><span class="pre">coverage.xml</span></code> report
in addition to the <code class="docutils literal notranslate"><span class="pre">.coverage</span></code> file and HTML report. This is useful for some code coverage UI/aggregation services.</p></li>
<li><p>The prefix “__” is now used for many files and directories PySys creates, to make it easier to spot which are
generated artifacts rather than checked in files. You may want to add <code class="docutils literal notranslate"><span class="pre">__pysys_*</span></code> and possibly <code class="docutils literal notranslate"><span class="pre">__coverage_*</span></code>
to your version control system’s ignore patterns so that paths created by the PySys runner and performance/writer
log files don’t show up in your local changes.</p></li>
</ul>
</div>
<div class="section" id="miscellaneous-test-api-improvements">
<h3>Miscellaneous test API improvements<a class="headerlink" href="#miscellaneous-test-api-improvements" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.utils.fileutils.html#pysys.utils.fileutils.loadProperties" title="pysys.utils.fileutils.loadProperties"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.fileutils.loadProperties()</span></code></a> for reading .properties files, and <a class="reference internal" href="autodocgen/pysys.utils.fileutils.html#pysys.utils.fileutils.loadJSON" title="pysys.utils.fileutils.loadJSON"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.fileutils.loadJSON()</span></code></a>
for loading .json files.</p></li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.logFileContents" title="pysys.basetest.BaseTest.logFileContents"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.logFileContents</span></code></a> now has a global variable <code class="docutils literal notranslate"><span class="pre">self.logFileContentsDefaultExcludes</span></code> (default <code class="docutils literal notranslate"><span class="pre">[]</span></code>) which
it uses to specify the line exclusion regular expressions if no <code class="docutils literal notranslate"><span class="pre">excludes=[...]</span></code> is passed as a parameter. This
provides a convenient way to filter out lines that you usually don’t care about at a global level (e.g. from a
<a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.setup" title="pysys.basetest.BaseTest.setup"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.setup</span></code></a> method shared by all tests), such as unimportant lines logged to stderr during startup of
commonly used processes which would otherwise be logged by <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess</span></code></a> when a process fails to start.</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.disableLogging" title="pysys.basetest.BaseTest.disableLogging"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.disableLogging()</span></code></a> for cases where you need to pause logging (e.g. while repeatedly polling) to avoid
cluttering the run log.</p></li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.config.project.html#pysys.config.project.Project.getProperty" title="pysys.config.project.Project.getProperty"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.project.Project.getProperty()</span></code></a> which is a convenient and safe way to get a project property
of bool/int/float/list[str] type. Also added <a class="reference internal" href="autodocgen/pysys.baserunner.html#pysys.baserunner.BaseRunner.getXArg" title="pysys.baserunner.BaseRunner.getXArg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.baserunner.BaseRunner.getXArg()</span></code></a> which does the same thing for
<code class="docutils literal notranslate"><span class="pre">-Xkey=value</span></code> arguments.</p></li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getExprFromFile" title="pysys.basetest.BaseTest.getExprFromFile"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getExprFromFile</span></code></a> now supports <code class="docutils literal notranslate"><span class="pre">(?P&lt;groupName&gt;...)</span></code> named regular expression groups, and will return
a dictionary containing the matched groups if any are present in the regular expression. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">authInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExprFromFile</span><span class="p">(</span><span class="s1">&#39;myserver.log&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Successfully authenticated user &quot;(?P&lt;username&gt;[^&quot;]*)&quot; in (?P&lt;authSecs&gt;[^ ]+) seconds\.&#39;</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getOutcomeLocation" title="pysys.basetest.BaseTest.getOutcomeLocation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getOutcomeLocation()</span></code></a> which can be used from custom writers to record the file and line number
corresponding to the outcome, if known.</p></li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h3>Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>In some cases foreground processes could be left running after timing out; this is now fixed.</p></li>
<li><p>Ensure ANSI escape codes (e.g. for console coloring) do not appear in JUnit XML writer output files, or in test
outcome reasons.</p></li>
<li><p>Setting the project property <code class="docutils literal notranslate"><span class="pre">redirectPrintToLogger</span></code> to any value (including <code class="docutils literal notranslate"><span class="pre">false</span></code>) was treated as if
it had been set to <code class="docutils literal notranslate"><span class="pre">true</span></code>; this is now fixed.</p></li>
</ul>
</div>
<div class="section" id="upgrade-guide-and-compatibility">
<h3>Upgrade guide and compatibility<a class="headerlink" href="#upgrade-guide-and-compatibility" title="Permalink to this headline">¶</a></h3>
<p>As this is a major version release of PySys we have taken the opportunity to clean up some aspects which could
cause new errors or require changes. In many cases it will be necessary to make changes to your project configuration,
and code changes if you have created custom BaseRunner/BaseTest/writer subclasses - though individual tests will
generally not require changes, so the total migration effort should be small.</p>
<p>The changes that everyone should pay attention to are:</p>
<ul>
<li><p>The default values of several project properties have been changed to reflect best practice.</p>
<p>If you are migrating an existing project we recommend sticking with the current behaviour to start with, by adding
the following properties to your project configuration (except for any that you already define <code class="docutils literal notranslate"><span class="pre">&lt;property</span> <span class="pre">.../&gt;</span></code>
overrides for). Then once the PySys upgrade is complete and all tests passing you can switch to some of the new
defaults (by removing these properties) if and when convenient.</p>
<p>The properties you should set to keep the same behaviour as pre-1.6.0 versions of PySys are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!-- Whether tests will by default report a failure outcome when a process completes with a non-zero return code.
    The default value as specified below will be used when the ignoreExitStatus= parameter to the function is not
    specified. The default was changed to false in PySys 1.6.0. --&gt;
&lt;property name=&quot;defaultIgnoreExitStatus&quot; value=&quot;true&quot;/&gt;

&lt;!-- Whether tests will abort as soon as a process or wait operation completes with errors, rather than attempting
    to limp on. The default value as specified below will be used when the abortOnError parameter to the function
    is not specified. Default was changed to true in PySys 1.6.0. --&gt;
&lt;property name=&quot;defaultAbortOnError&quot; value=&quot;false&quot;/&gt;

&lt;!-- Recommended behaviour is to NOT strip whitespace unless explicitly requested with the stripWhitespace=
     option; this option exists to keep compatibility for old projects. The default was changed to false
     in PySys 1.6.0.  --&gt;
&lt;property name=&quot;defaultAssertDiffStripWhitespace&quot; value=&quot;true&quot;/&gt;

&lt;!-- Overrides the default name use to for the runner&#39;s ``self.output`` directory (which may be used for things
    like code coverage reports, temporary files etc).
    The default was changed to &quot;__pysys_runner.${outDirName}&quot; in PySys 1.6.0.
    If a relative path is specified, it is relative to the testRootDir, or if an absolute --outdir was specified,
    relative to that directory.
--&gt;
&lt;property name=&quot;pysysRunnerDirName&quot; value=&quot;pysys-runner-${outDirName}&quot;/&gt;

&lt;!-- Overrides the default name use to for the performance summary .csv file. The default was changed to
    &quot;__pysys_performance/${outDirName}_${hostname}/perf_${startDate}_${startTime}.${outDirName}.csv&quot; in PySys 1.6.0.
--&gt;
&lt;property name=&quot;csvPerformanceReporterSummaryFile&quot; value=&quot;performance_output/${outDirName}_${hostname}/perf_${startDate}_${startTime}.csv&quot;/&gt;

&lt;!-- Set this to true unless you used the &quot;mode&quot; feature before it was redesigned in PySys 1.4.1. --&gt;
&lt;property name=&quot;supportMultipleModesPerRun&quot; value=&quot;false&quot;/&gt;

&lt;!-- Set temporary directory end var for child processes to the testcase output directory to avoid cluttering up
    common file locations. Empty string means don&#39;t do this. &quot;self.output&quot; is recommended.
--&gt;
&lt;property name=&quot;defaultEnvironsTempDir&quot; value=&quot;&quot;/&gt;

&lt;!-- Controls whether print() and sys.stdout.write() statements will be automatically converted into logger.info()
    calls. If redirection is disabled, output from print() statements will not be captured in run.log files and will
    often not appear in the correct place on the console when running multi-threaded.

    Note that this affects custom writers as well as testcases. If you have a custom writer, use
    pysys.utils.logutils.stdoutPrint() to write to stdout without any redirection. --&gt;
&lt;property name=&quot;redirectPrintToLogger&quot; value=&quot;false&quot;/&gt;

&lt;!-- Produces more informative messages from waitForGrep/Signal. Can be set to false for the terser behaviour if
     preferred. --&gt;
&lt;property name=&quot;verboseWaitForGrep&quot; value=&quot;false&quot;/&gt;
</pre></div>
</div>
<p>The list is ordered with the properties most likely to break existing tests at the top of the list, so you may wish
to start with the easier ones at the bottom of the list.</p>
</li>
<li><p>If you have testcases using the non-standard descriptor filenames <code class="docutils literal notranslate"><span class="pre">.pysystest</span></code> or <code class="docutils literal notranslate"><span class="pre">descriptor.xml</span></code> (rather
than the usual <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code>) they will not be found by this version of PySys by default, so action is required
to have them execute as normal. If you wish to avoid renaming the files, just set the new project
property <code class="docutils literal notranslate"><span class="pre">pysysTestDescriptorFileNames</span></code> to a comma-separated list of the names you want to use,
e.g. “pysystest.xml, .pysystest, descriptor.xml”.</p>
<p>If you use the non-standard filename <code class="docutils literal notranslate"><span class="pre">.pysysproject</span></code> rather than <code class="docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> for your project
configuration file you will need to rename it.</p>
</li>
<li><p>If your BaseTest or BaseRunner makes use of <code class="docutils literal notranslate"><span class="pre">-Xkey[=value]</span></code> command line overrides with int/float/bool/list types, you
should review your code and/or test thoroughly as there are now automatic conversions from string to int/float/bool/list[str]
in some cases where previously the string type would have been retained.
a) -Xkey and -Xkey=true/false now consistently produce a boolean True/False
(previously -Xkey=true would produce a string <code class="docutils literal notranslate"><span class="pre">&quot;true&quot;</span></code> whereas -Xkey would produce a boolean <code class="docutils literal notranslate"><span class="pre">True</span></code>) and
b) -X attributes set on BaseRunner now undergo conversion from string to match the bool/int/float/list type of the
default value if a static field of that name already exists on the runner class (which brings BaseRunner into line
with the behaviour that BaseTest has had since 1.5.0, and also adds support for the <code class="docutils literal notranslate"><span class="pre">list</span></code> type). This applies to
the attributes set on the object, but not to the contents of the xargs dictionary.</p>
<p>The same type conversion applies to any custom <a class="reference internal" href="autodocgen/pysys.writer.html#module-pysys.writer" title="pysys.writer"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer</span></code></a> classes, so if you have a static variable providing a
default value, then in this version the variable will be set to the type of that bool/int/float/list rather than to
string.</p>
<p>So, as well as checking your tests still pass you should test that the configuration of your writers
and <code class="docutils literal notranslate"><span class="pre">pysys.py</span> <span class="pre">run</span> <span class="pre">-X</span></code> handling is also working as expected.</p>
</li>
<li><p>Since <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess</span></code></a> now logs stderr/out automatically before aborting, if you previously wrote extensions
that manually log stderr/out after process failures (in a try…except/finally block), you may wish to remove them
to avoid duplication, or change them to use the new <code class="docutils literal notranslate"><span class="pre">onError=</span></code> mechanism.</p></li>
<li><p>The default directory for performance output is now under <code class="docutils literal notranslate"><span class="pre">__pysys_performance/</span></code> rather than
<code class="docutils literal notranslate"><span class="pre">performance_output/</span></code>, so if you have any tooling that picks up these files you will need to redirect it, or set the
<code class="docutils literal notranslate"><span class="pre">csvPerformanceReporterSummaryFile</span></code> project property described above. The default filename also includes
the <code class="docutils literal notranslate"><span class="pre">${outDirName}</span></code>. See <a class="reference internal" href="autodocgen/pysys.utils.perfreporter.html#module-pysys.utils.perfreporter" title="pysys.utils.perfreporter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.perfreporter</span></code></a>.</p></li>
</ul>
<p>Be sure to remove use of the following deprecated items at your earliest convenience:</p>
<ul>
<li><p>Deprecated the <code class="docutils literal notranslate"><span class="pre">ThreadFilter</span></code> class. Usually it is not recommended
to suppress log output and better alternatives are available, e.g. the quiet=True option for <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess</span></code></a>,
and the <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.disableLogging" title="pysys.basetest.BaseTest.disableLogging"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.disableLogging()</span></code></a> method.
Please remove uses of ThreadFilter from your code as it will be removed in a future release.</p></li>
<li><p>The method <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.addResource" title="pysys.basetest.BaseTest.addResource"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.basetest.BaseTest.addResource</span></code></a> is deprecated and will be removed in a future release, so please
change tests to stop using it; use <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.addCleanupFunction" title="pysys.basetest.BaseTest.addCleanupFunction"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.basetest.BaseTest.addCleanupFunction</span></code></a> instead.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">pysys.process.commonwrapper.CommonProcessWrapper</span></code> class is now renamed to <a class="reference internal" href="autodocgen/pysys.process.html#pysys.process.Process" title="pysys.process.Process"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.process.Process</span></code></a>. A
redirection module exists, so any code that depends on the old location will still work, but please change references
to the new name the old one will be removed in a future release.</p></li>
<li><p>If you need code coverage of a Python application, instead of the built-in python coverage support e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pythonCoverageDir&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;__coverage_python.$</span><span class="si">{outDirName}</span><span class="s2">&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pythonCoverageArgs&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;--rcfile=$</span><span class="si">{testRootDir}</span><span class="s2">/python_coveragerc&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">collect</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">output</span> <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;.coverage*&quot;</span> <span class="n">outputDir</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{pythonCoverageDir}</span><span class="s2">&quot;</span> <span class="n">outputPattern</span><span class="o">=</span><span class="s2">&quot;@FILENAME@_@TESTID@_@UNIQUE@&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>change to using the new writer, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">writer</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;pysys.writer.testoutput.PythonCoverageWriter&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;destDir&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;__coverage_python.$</span><span class="si">{outDirName}</span><span class="s2">&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pythonCoverageArgs&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;--rcfile=$</span><span class="si">{testRootDir}</span><span class="s2">/python_coveragerc&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">writer</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>(if using 2.0+, use <a class="reference internal" href="autodocgen/pysys.writer.coverage.html#pysys.writer.coverage.PythonCoverageWriter" title="pysys.writer.coverage.PythonCoverageWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.coverage.PythonCoverageWriter</span></code></a> instead of
<code class="docutils literal notranslate"><span class="pre">pysys.writer.testoutput.PythonCoverageWriter</span></code>.</p>
</li>
</ul>
<p>Finally there are also some fixes, cleanup, and better error checking that <em>could</em> require changes (typically to
extension/framework classes rather than individual tests) but in most cases will not be noticed. Most users can ignore
the following list and consult it only if you get new test failures after upgrading PySys:</p>
<ul class="simple">
<li><p>Timestamps in process monitor output, writers, performance reporter and similar places are now in local time instead
of UTC.
This means these timestamps will match up with the times in run.log output which have always been local time.</p></li>
<li><p>Performance CSV files contain some details about the test run. A couple of these have been renamed: <code class="docutils literal notranslate"><span class="pre">time</span></code> is
now <code class="docutils literal notranslate"><span class="pre">startTime</span></code> and <code class="docutils literal notranslate"><span class="pre">outdir</span></code> is now <code class="docutils literal notranslate"><span class="pre">outDirName</span></code>. The keys and values can be changed as needed using
the <code class="docutils literal notranslate"><span class="pre">runDetails</span></code> field of <a class="reference internal" href="autodocgen/pysys.baserunner.html#pysys.baserunner.BaseRunner" title="pysys.baserunner.BaseRunner"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.baserunner.BaseRunner</span></code></a>. It is encouraged to use this rather than the previous
mechanism of <a class="reference internal" href="autodocgen/pysys.utils.perfreporter.html#pysys.utils.perfreporter.CSVPerformanceReporter.getRunDetails" title="pysys.utils.perfreporter.CSVPerformanceReporter.getRunDetails"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.perfreporter.CSVPerformanceReporter.getRunDetails()</span></code></a>.</p></li>
<li><p>Exceptions from cleanup functions will now lead to test failures whereas before they were only logged, so may have
easily gone unnoticed. You can disable this using the new “ignoreErrors=True” argument to
<a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.addCleanupFunction" title="pysys.basetest.BaseTest.addCleanupFunction"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.addCleanupFunction</span></code></a> if desired.</p></li>
<li><p>Properties files referenced in the project configuration are now read using UTF-8 encoding if possible, falling back
to ISO8859-1 if they contain invalid UTF-8. This follows Java(R) 9+ behaviour and provides for more stable results
than the previous PySys behaviour of using whatever the default locale encoding is, which does not conform to any
standard for .properties file and makes it impossible to share a .properties file across tests running in different
locales. The PySys implementation still does not claim to fully implement the .properties file format, for example
<code class="docutils literal notranslate"><span class="pre">\</span></code> are treated as literals not escape sequences. See <a class="reference internal" href="autodocgen/pysys.utils.fileutils.html#pysys.utils.fileutils.loadProperties" title="pysys.utils.fileutils.loadProperties"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.fileutils.loadProperties()</span></code></a> for details.</p></li>
<li><p>Duplicate <code class="docutils literal notranslate"><span class="pre">&lt;property</span> <span class="pre">name=&quot;...&quot;</span> <span class="pre">.../&gt;</span></code> project properties now produce an error to avoid unintentional mistakes.
However it is still permitted to overwrite project properties from a .properties file.
You can also use the new <code class="docutils literal notranslate"><span class="pre">includes</span></code>/<code class="docutils literal notranslate"><span class="pre">excludes</span></code> attributes when importing a .properties file to avoid clashes.</p></li>
<li><p>PySys used to silently ignore project and writer properties that use a missing (or typo’d) property or environment
variable, setting it to “” (or the default value if specified). To ensure errors are noticed up-front, it is now a
fatal error if a property’s value value cannot be resolved - unless a <code class="docutils literal notranslate"><span class="pre">default=</span></code> value is provided in which case
the default is used (but it would be an error if the default also references a non-existent variable). This is
unlikely to cause problems for working projects, however if you have some unused properties with invalid values you
may have to remove them. The new behaviour only applies to <code class="docutils literal notranslate"><span class="pre">&lt;property</span> <span class="pre">name=&quot;...&quot;</span> <span class="pre">value=&quot;...&quot;</span> <span class="pre">[default=&quot;...&quot;]/&gt;</span></code>
elements, it does not apply to properties read from .properties files, which still default to “” if unresolved.
Run your tests with <code class="docutils literal notranslate"><span class="pre">-vDEBUG</span></code> logging if you need help debugging properties problems.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">PYSYS_PERMIT_NO_PROJECTFILE</span></code> option is no longer supported - you must now have a pysysproject.xml file for
all projects.</p></li>
<li><p>Writer, performance and code coverage logs now go under <code class="docutils literal notranslate"><span class="pre">--outdir</span></code> if an absolute <code class="docutils literal notranslate"><span class="pre">--outdir</span></code> path is specified
on the command line rather than the usual location under <code class="docutils literal notranslate"><span class="pre">testDirRoot/</span></code>.</p></li>
<li><p>On Windows the default output directory is now <code class="docutils literal notranslate"><span class="pre">win</span></code> rather than the (somewhat misleading) <code class="docutils literal notranslate"><span class="pre">win32</span></code>.
There is no change to the value of PySys constants such as PLATFORM, just the default output directory. If you
prefer a different output directory on your machine you could customize it by setting environment variable
<code class="docutils literal notranslate"><span class="pre">PYSYS_DEFAULT_ARGS=--outdir</span> <span class="pre">__myoutputdir</span></code>.</p></li>
<li><p>If you created a custom subclass of <a class="reference internal" href="autodocgen/pysys.utils.perfreporter.html#pysys.utils.perfreporter.CSVPerformanceReporter" title="pysys.utils.perfreporter.CSVPerformanceReporter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.perfreporter.CSVPerformanceReporter</span></code></a> using the 1.3.0 release and
it does not yet have (and pass through to the superclass) a <code class="docutils literal notranslate"><span class="pre">runner</span></code> and/or <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> argument you will need
to add these, as an exception will be generated otherwise.</p></li>
<li><p>Made it an error to change project properties after the project has been loaded. This was never intended, as projects
are immutable. In the unlikely event you do this, change to storing user-defined cross-test/global state in your
runner class instead.</p></li>
<li><p>Project properties whose name clashes with one of the pre-defined fields of <a class="reference internal" href="autodocgen/pysys.config.project.html#pysys.config.project.Project" title="pysys.config.project.Project"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.project.Project</span></code></a>
(e.g. “properties” or “root”) will no longer override those fields - which would most likely not work correctly
anyway. If you need to get a property whose name clashes with a built-in member, use
<code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.project.Project.properties</span></code>.</p></li>
<li><p>PySys now checks that its working directory (<code class="docutils literal notranslate"><span class="pre">os.chdir()</span></code>) and environment (<code class="docutils literal notranslate"><span class="pre">os.environ</span></code>) have not been modified
during execution of tests (after <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.baserunner.BaseRunner.setup()').</span> <span class="pre">Sometimes</span> <span class="pre">test</span> <span class="pre">authors</span> <span class="pre">do</span> <span class="pre">this</span> <span class="pre">by</span> <span class="pre">mistake</span>
<span class="pre">and</span> <span class="pre">it's</span> <span class="pre">extremely</span> <span class="pre">dangerous</span> <span class="pre">as</span> <span class="pre">it</span> <span class="pre">causes</span> <span class="pre">behaviour</span> <span class="pre">changes</span> <span class="pre">(and</span> <span class="pre">potentially</span> <span class="pre">file</span> <span class="pre">system</span> <span class="pre">race</span> <span class="pre">conditions)</span> <span class="pre">in</span>
<span class="pre">subsequent</span> <span class="pre">tests</span> <span class="pre">that</span> <span class="pre">can</span> <span class="pre">be</span> <span class="pre">very</span> <span class="pre">hard</span> <span class="pre">to</span> <span class="pre">debug.</span>
<span class="pre">The</span> <span class="pre">environment</span> <span class="pre">and</span> <span class="pre">working</span> <span class="pre">directory</span> <span class="pre">should</span> <span class="pre">only</span> <span class="pre">be</span> <span class="pre">modified</span> <span class="pre">for</span> <span class="pre">child</span> <span class="pre">processes</span> <span class="pre">not</span> <span class="pre">for</span> <span class="pre">PySys</span> <span class="pre">itself</span> <span class="pre">-</span>
<span class="pre">calling</span> <span class="pre">or</span> <span class="pre">overriding</span> <span class="pre">`BaseTest.getDefaultEnvirons()</span></code> is a good way to do this.</p></li>
<li><p>Attempting to write to <code class="docutils literal notranslate"><span class="pre">runDetails</span></code> or <code class="docutils literal notranslate"><span class="pre">pysys.constants.TIMEOUTS</span></code> after <a class="reference internal" href="autodocgen/pysys.baserunner.html#pysys.baserunner.BaseRunner.setup" title="pysys.baserunner.BaseRunner.setup"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.baserunner.BaseRunner.setup()</span></code></a>
has completed (e.g. from individual tests) is no longer permitted in the interests of safety.</p></li>
<li><p>Changed the implementation of the outcome constants such as <a class="reference internal" href="autodocgen/pysys.constants.html#pysys.constants.FAILED" title="pysys.constants.FAILED"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.constants.FAILED</span></code></a> to be an instance of class
<a class="reference internal" href="autodocgen/pysys.constants.html#pysys.constants.Outcome" title="pysys.constants.Outcome"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.constants.Outcome</span></code></a> rather than an integer. It is unlikely this change will affect existing code (unless you
have created any custom outcome types, which is not documented). The use of objects to represent outcomes allows for
simpler and more efficient conversion to display name using a <code class="docutils literal notranslate"><span class="pre">%s</span></code> format string or <code class="docutils literal notranslate"><span class="pre">str()</span></code> without the need for
the LOOKUP dictionary (which still works, but is now deprecated). It also allows easier checking if an outcome
represents a failure using <a class="reference internal" href="autodocgen/pysys.constants.html#pysys.constants.Outcome.isFailure" title="pysys.constants.Outcome.isFailure"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.constants.Outcome.isFailure()</span></code></a>. The <a class="reference internal" href="autodocgen/pysys.constants.html#pysys.constants.PRECEDENT" title="pysys.constants.PRECEDENT"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.constants.PRECEDENT</span></code></a> constant is
deprecated in favor of <a class="reference internal" href="autodocgen/pysys.constants.html#pysys.constants.OUTCOMES" title="pysys.constants.OUTCOMES"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.constants.OUTCOMES</span></code></a> which has an identical value.</p></li>
<li><p>There is no longer a default writer so if you choose delete the &lt;writers&gt; element from your project you won’t
have any writers.</p></li>
<li><p>Removed undocumented <code class="docutils literal notranslate"><span class="pre">TEST_TEMPLATE</span></code> constant from <code class="docutils literal notranslate"><span class="pre">pysys.basetest</span></code> and <code class="docutils literal notranslate"><span class="pre">DESCRIPTOR_TEMPLATE</span></code>
from <a class="reference internal" href="autodocgen/pysys.config.descriptor.html#module-pysys.config.descriptor" title="pysys.config.descriptor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.descriptor</span></code></a> (they’re now constants on <a class="reference internal" href="autodocgen/pysys.launcher.console_make.html#pysys.launcher.console_make.ConsoleMakeTestHelper" title="pysys.launcher.console_make.ConsoleMakeTestHelper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.launcher.console_make.ConsoleMakeTestHelper</span></code></a> if you
really need them, but this is unlikely and they are not part of the public PySys API).</p></li>
<li><p>Removed deprecated and unused constant <code class="docutils literal notranslate"><span class="pre">DTD</span></code> from <a class="reference internal" href="autodocgen/pysys.config.project.html#module-pysys.config.project" title="pysys.config.project"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.project</span></code></a> and <a class="reference internal" href="autodocgen/pysys.config.descriptor.html#module-pysys.config.descriptor" title="pysys.config.descriptor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.descriptor</span></code></a>.</p></li>
<li><p>Removed deprecated method <code class="docutils literal notranslate"><span class="pre">purgeDirectory()</span></code> from <a class="reference internal" href="autodocgen/pysys.baserunner.html#pysys.baserunner.BaseRunner" title="pysys.baserunner.BaseRunner"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.baserunner.BaseRunner</span></code></a>
and <a class="reference internal" href="autodocgen/pysys.writer.outcomes.html#pysys.writer.outcomes.JUnitXMLResultsWriter" title="pysys.writer.outcomes.JUnitXMLResultsWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.outcomes.JUnitXMLResultsWriter</span></code></a>. Use <a class="reference internal" href="autodocgen/pysys.utils.fileutils.html#pysys.utils.fileutils.deletedir" title="pysys.utils.fileutils.deletedir"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.fileutils.deletedir</span></code></a> instead.</p></li>
<li><p>Removed deprecated classes <code class="docutils literal notranslate"><span class="pre">ThreadedStreamHandler</span></code> and <code class="docutils literal notranslate"><span class="pre">ThreadedFileHandler</span></code> from the
<code class="docutils literal notranslate"><span class="pre">pysys.</span></code> module as there is no reason for PySys to provide these. These are trivial to implement using the
Python logging API if anyone does need similar functionality.</p></li>
<li><p><a class="reference internal" href="autodocgen/pysys.process.user.html#pysys.process.user.ProcessUser" title="pysys.process.user.ProcessUser"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.process.user.ProcessUser</span></code></a> no longer sets <code class="docutils literal notranslate"><span class="pre">self.output</span></code>, and it sets <code class="docutils literal notranslate"><span class="pre">self.input</span></code> to the project’s
testRootDir instead of the current directory. Since these are overridden by <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest" title="pysys.basetest.BaseTest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.basetest.BaseTest</span></code></a> and
<a class="reference internal" href="autodocgen/pysys.baserunner.html#pysys.baserunner.BaseRunner" title="pysys.baserunner.BaseRunner"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.baserunner.BaseRunner</span></code></a> it is unlikely this will affect anyone.</p></li>
<li><p>Changed the log messages at the end of a test run to say “THERE WERE NO FAILURES” instead of
“THERE WERE NO NON PASSES”, and similarly for the “Summary of non passes:”.</p></li>
<li><p><a class="reference internal" href="autodocgen/pysys.process.html#pysys.process.Process.wait" title="pysys.process.Process.wait"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.process.Process.wait</span></code></a> now raises an error if the specified timeout isn’t a positive
number (giving the same behaviour as <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitProcess" title="pysys.basetest.BaseTest.waitProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitProcess</span></code></a>) rather than the dangerous behaviour of waiting without
a timeout.</p></li>
</ul>
</div>
</div>
<div class="section" id="release-history">
<h2>Release History<a class="headerlink" href="#release-history" title="Permalink to this headline">¶</a></h2>
<p>PySys 1.5.1 was released in May 2020.</p>
<p>Documentation improvements:</p>
<p>PySys now uses Sphinx to build its documentation (instead of epydoc), and new content has also been written resulting
in a significantly larger set of HTML documentation that is also easier to navigate, and brings together
the detailed API reference with information on usage and how to get started with PySys. The main <code class="docutils literal notranslate"><span class="pre">.rst</span></code>
documentation source files are shipped inside the binary distribution of PySys so that users can view and
potentially even re-package the documentation combined with their own extensions.</p>
<p>Assertion and waitForGrep improvements:</p>
<ul>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertThat" title="pysys.basetest.BaseTest.assertThat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertThat</span></code></a> has been radically overhauled with a powerful mechanism that uses named parameters (e.g.
<code class="docutils literal notranslate"><span class="pre">actualXXX=</span></code> and <code class="docutils literal notranslate"><span class="pre">expected=</span></code>) to produce self-describing log messages and outcome reasons, and even the ability to
evaluate arbitrary Python expressions in the parameters, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">assertThat</span><span class="p">(</span><span class="s2">&quot;actualStartupMessage == expected&quot;</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="s1">&#39;Started successfully&#39;</span><span class="p">,</span> <span class="n">actualStartupMessage</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">assertThat</span><span class="p">(</span><span class="s1">&#39;actualUser == expected&#39;</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="s1">&#39;myuser&#39;</span><span class="p">,</span> <span class="n">actualUser</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>

<span class="bp">self</span><span class="o">.</span><span class="n">assertThat</span><span class="p">(</span><span class="s2">&quot;actual == expected&quot;</span><span class="p">,</span> <span class="n">actual__eval</span><span class="o">=</span><span class="s2">&quot;myDataStructure[&#39;item1&#39;][-1].getId()&quot;</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">assertThat</span><span class="p">(</span><span class="s2">&quot;actual == expected&quot;</span><span class="p">,</span> <span class="n">actual__eval</span><span class="o">=</span><span class="s2">&quot;myDataStructure[&#39;item2&#39;][-1].getId()&quot;</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">assertThat</span><span class="p">(</span><span class="s2">&quot;actual == expected&quot;</span><span class="p">,</span> <span class="n">actual__eval</span><span class="o">=</span><span class="s2">&quot;myDataStructure[&#39;item3&#39;][-1].getId()&quot;</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="s2">&quot;baz&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This automatically produces informative log messages such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Assert</span> <span class="n">that</span> <span class="p">(</span><span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span><span class="p">)</span> <span class="k">with</span> <span class="n">actual</span> <span class="p">(</span><span class="n">myDataStructure</span><span class="p">[</span><span class="s1">&#39;item1&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span> <span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span> <span class="o">...</span> <span class="n">passed</span>
<span class="n">Assert</span> <span class="n">that</span> <span class="p">(</span><span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span><span class="p">)</span> <span class="k">with</span> <span class="n">actual</span> <span class="p">(</span><span class="n">myDataStructure</span><span class="p">[</span><span class="s1">&#39;item2&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span> <span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span> <span class="o">...</span> <span class="n">passed</span>
<span class="n">Assert</span> <span class="n">that</span> <span class="p">(</span><span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span><span class="p">)</span> <span class="k">with</span> <span class="n">actual</span> <span class="p">(</span><span class="n">myDataStructure</span><span class="p">[</span><span class="s1">&#39;item3&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span> <span class="o">=</span><span class="s1">&#39;baZaar&#39;</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="s1">&#39;baz&#39;</span> <span class="o">...</span> <span class="n">failed</span>
     <span class="n">actual</span><span class="p">:</span> <span class="s1">&#39;baZaar&#39;</span>
   <span class="n">expected</span><span class="p">:</span> <span class="s1">&#39;baz&#39;</span>
               <span class="o">^</span>
</pre></div>
</div>
<p>Note that when two named parameters are provided and the condition string is a simple equality
comparison (<code class="docutils literal notranslate"><span class="pre">==</span></code> or <code class="docutils literal notranslate"><span class="pre">is</span></code>), additional lines are logged when the assertion fails to show at what point the
two arguments differ. For best results make sure you have colours turned on.</p>
<p>As a result of these changes to assertThat, the less powerful <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertEval" title="pysys.basetest.BaseTest.assertEval"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertEval</span></code></a> method is now deprecated and
new tests should use assertThat instead.</p>
<p>Both methods also now allow the condition/eval string to make use of some additional standard Python modules such as
<code class="docutils literal notranslate"><span class="pre">math</span></code> and <code class="docutils literal notranslate"><span class="pre">re</span></code>, and to use <code class="docutils literal notranslate"><span class="pre">import_module('...').XXX</span></code> to dynamically import additional modules.</p>
</li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertGrep" title="pysys.basetest.BaseTest.assertGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertGrep</span></code></a> (and <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertLastGrep" title="pysys.basetest.BaseTest.assertLastGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertLastGrep</span></code></a>) now return the regular expression match object, or if any
<code class="docutils literal notranslate"><span class="pre">(?P&lt;groupName&gt;...)</span></code> named groups are present in the regular expression, a dictionary containing the matched values.
This allows matching values from within the regular expression in a way that produces nicely descriptive error
messages, and also enables more sophisticated checking (e.g. by casting numeric types to float). For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">assertThat</span><span class="p">(</span><span class="s1">&#39;username == expected&#39;</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="s1">&#39;myuser&#39;</span><span class="p">,</span>
  <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">assertGrep</span><span class="p">(</span><span class="s1">&#39;myserver.log&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Successfully authenticated user &quot;(?P&lt;username&gt;[^&quot;]*)&quot;&#39;</span><span class="p">))</span>

<span class="bp">self</span><span class="o">.</span><span class="n">assertThat</span><span class="p">(</span><span class="s1">&#39;0 &lt;= float(authSecs) &lt; max&#39;</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">MAX_AUTH_TIME</span><span class="p">,</span>
  <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">assertGrep</span><span class="p">(</span><span class="s1">&#39;myserver.log&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Successfully authenticated user &quot;[^&quot;]*&quot; in (?P&lt;authSecs&gt;[^ ]+) seconds\.&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForGrep" title="pysys.basetest.BaseTest.waitForGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForGrep</span></code></a> now provides the same dictionary return value when given a regular expression with named
groups, so the above trick can also be used during execution of the test when convenient.</p>
</li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForGrep" title="pysys.basetest.BaseTest.waitForGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForGrep()</span></code></a> has been added as a new and clearer name for <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForSignal" title="pysys.basetest.BaseTest.waitForSignal"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForSignal()</span></code></a>, and we recommend
using waitForGrep in new tests from now on (see upgrade section for more information about this change).</p></li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForGrep" title="pysys.basetest.BaseTest.waitForGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForGrep</span></code></a> (and <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForSignal" title="pysys.basetest.BaseTest.waitForSignal"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForSignal</span></code></a>) now logs more useful information if the
<code class="docutils literal notranslate"><span class="pre">verboseWaitForGrep</span></code> (or its alias, <code class="docutils literal notranslate"><span class="pre">verboseWaitForSignal</span></code>) is set to true in the <code class="docutils literal notranslate"><span class="pre">pysysproject.xml</span></code>
properties. This includes logging at the start of waiting rather than at the end of waiting (to make it easier to
debug hangs during test development or when triaging an automated test run). In addition, if a non-default timeout
was specified this is included in the log message, and for the (small proportion of) waits that take longer than
30 seconds an additional message is logged to indicate how long was actually spent, which makes it easier to debug
tests that sometimes timeout and sometimes complete just before they would have timed out. All of this new
functionality only applies if you have <code class="docutils literal notranslate"><span class="pre">verboseWaitForGrep=true</span></code> so will not affect existing projects, but this
is now enabled for newly created projects.</p></li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForGrep" title="pysys.basetest.BaseTest.waitForGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForGrep</span></code></a> (and <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForSignal" title="pysys.basetest.BaseTest.waitForSignal"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForSignal</span></code></a>) now has a <code class="docutils literal notranslate"><span class="pre">detailMessage</span></code> parameter that can
be used to provide some extra information to explain more about the wait condition.</p></li>
<li><p>All <code class="docutils literal notranslate"><span class="pre">assertXXX</span></code> methods in <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest" title="pysys.basetest.BaseTest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest</span></code></a> now return a value to indicate the result of the assertion. In most
cases this is a boolean <code class="docutils literal notranslate"><span class="pre">True</span></code>/<code class="docutils literal notranslate"><span class="pre">False</span></code>. This creates an opportunity to gather or log additional diagnostic
information (e.g. using <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.logFileContents" title="pysys.basetest.BaseTest.logFileContents"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.logFileContents</span></code></a>) after an assertion fails.</p></li>
<li><p>Regular expression behaviour can now be customized by a <code class="docutils literal notranslate"><span class="pre">reFlags=</span></code> parameter on methods such as
<a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertGrep" title="pysys.basetest.BaseTest.assertGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertGrep</span></code></a>, <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForGrep" title="pysys.basetest.BaseTest.waitForGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForGrep</span></code></a>, etc. This allows for ignoring case, and use of verbose regular
expression syntax, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">assertGrep</span><span class="p">(</span><span class="s1">&#39;myserver.log&#39;</span><span class="p">,</span> <span class="n">reFlags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="n">r</span>\<span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  in</span><span class="se">\</span>
<span class="s2">  \d +  # the integral part</span>
<span class="s2">  \.    # the decimal point</span>
<span class="s2">  \d *  # some fractional digits</span>
<span class="s2">  \ seconds\. # in verbose regex mode we escape spaces with a slash</span>
<span class="s2">  </span><span class="se">\&quot;</span><span class="s2">&quot;&quot;)</span>
</pre></div>
</div>
</li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertDiff" title="pysys.basetest.BaseTest.assertDiff"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertDiff</span></code></a> now has colour-coding of the added/removed lines when logging a diff to the console on failure.</p></li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertDiff" title="pysys.basetest.BaseTest.assertDiff"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertDiff</span></code></a> usability was improved by including the relative path to each file
in the assertion messages, so you can now use the same basename for the file to be compared and the reference
file without losing track of which is which. This also makes it easier to manually diff the output directory against
the <code class="docutils literal notranslate"><span class="pre">Reference</span></code> directory using GUI diff tools when debugging test failures.</p></li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertDiff" title="pysys.basetest.BaseTest.assertDiff"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertDiff</span></code></a> has a new advanced feature, <em>autoUpdateAssertDiffReferences</em>, to help when you
have a large set of test reference files which need to be updated after a behaviour or output formatting change.
If you run the tests with <code class="docutils literal notranslate"><span class="pre">-XautoUpdateAssertDiffReferences</span></code> any diff failures will result in PySys overwriting
the reference file with the contents of the comparison file, providing an easy way to quickly update a large set
of references. Use this feature with caution, since it overwrites reference files with no backup. In
particular, make sure you have committed all reference files to version control before running the command, and
then afterwards be sure to carefully check the resulting diff to make sure the changes were as expected before
committing.</p></li>
</ul>
<p>Improvements to the <code class="docutils literal notranslate"><span class="pre">pysys.py</span></code> tool:
- PySys now supports v3.8 of Python.</p>
<ul class="simple">
<li><p>Added <code class="docutils literal notranslate"><span class="pre">Test</span> <span class="pre">directory</span></code> to <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">print</span> <span class="pre">--full</span></code>. The directory is given as a path relative to the directory
PySys was run from.</p></li>
</ul>
<p>New project options:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> project configuration has a new <code class="docutils literal notranslate"><span class="pre">&lt;project-help&gt;...&lt;/project-help&gt;</span></code> element which can be
used to provide project-specific text to be appended to the <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">run</span> <span class="pre">--help</span></code> usage message. This could be useful
for documenting <code class="docutils literal notranslate"><span class="pre">-Xkey=value</span></code> options that are relevant for this project, and general usage information. A
<code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Help</span></code> heading is automatically added if no other heading is present, and PySys will intelligently add or
remove indentation from the specified content so that it aligns with the built-in options.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> has a new property <code class="docutils literal notranslate"><span class="pre">defaultAssertDiffStripWhitespace</span></code> which controls whether
<a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertDiff" title="pysys.basetest.BaseTest.assertDiff"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertDiff</span></code></a> ignores whitespace (and blank lines at the end of a file). The recommended
value is False, but to maintain compatibility with existing projects the default if not specified in the project file
is True.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">&lt;property</span> <span class="pre">name=.../&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;property</span> <span class="pre">file=.../&gt;</span></code> elements have a new optional attribute
called <code class="docutils literal notranslate"><span class="pre">pathMustExist=&quot;true/false&quot;</span></code> that can be set to true to indicate that the project should not load (and no
tests be run) if the .properties file does not exist, or in the case of <code class="docutils literal notranslate"><span class="pre">&lt;property</span> <span class="pre">name=.../&gt;</span></code>, if the property
value does not exist (either as an absolute path or as a path relative to the project root directory). We recommend
setting using <code class="docutils literal notranslate"><span class="pre">pathMustExist</span></code> on all <code class="docutils literal notranslate"><span class="pre">&lt;property</span> <span class="pre">file=.../&gt;</span></code> elements to be explicit about whether the file is
optional or mandatory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;pythonpath&gt;</span></code> can now be used (and is recommended) instead of <code class="docutils literal notranslate"><span class="pre">&lt;path&gt;</span></code> to add items to the PYTHONPATH. There is
no plan to remove support for <code class="docutils literal notranslate"><span class="pre">&lt;path&gt;</span></code> but this should increase clarity for new users.</p></li>
</ul>
<p>Port allocation improvements:</p>
<ul class="simple">
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getNextAvailableTCPPort" title="pysys.basetest.BaseTest.getNextAvailableTCPPort"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getNextAvailableTCPPort</span></code></a> and <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForSocket" title="pysys.basetest.BaseTest.waitForSocket"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForSocket</span></code></a> now support IPv6, via the new
<code class="docutils literal notranslate"><span class="pre">socketAddressFamily</span></code> argument (IPv4 remains the default). It is also possible now to control which host
address/interface is used to check that an allocated port isn’t in use using the new <code class="docutils literal notranslate"><span class="pre">hosts</span></code> argument.</p></li>
<li><p>A new environment variable <code class="docutils literal notranslate"><span class="pre">PYSYS_PORTS=minport-maxport,port,...</span></code> can be used to override the set of possible
server ports allocated from <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getNextAvailableTCPPort" title="pysys.basetest.BaseTest.getNextAvailableTCPPort"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getNextAvailableTCPPort()</span></code></a>. This avoids the usual logic which uses
<code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.portalloc.getEphemeralTCPPortRange()</span></code> to detect the local/client-side ports which should be avoided
for server-side use. In addition, the default behaviour of getEphemeralTCPPortRange has changed on Linux, so that
if <code class="docutils literal notranslate"><span class="pre">/proc/sys/net/ipv4/ip_local_port_range</span></code> is missing, PySys will fall back to using the default IANA ephemeral
port range (with a warning). This makes it possible to use PySys in environments such as
Windows Subsystem for Linux (WSL) v1 which may not have the usual Linux network stack.</p></li>
</ul>
<p>Advanced pysystest.xml additions:</p>
<ul>
<li><p>It is now possible to use <code class="docutils literal notranslate"><span class="pre">${...}</span></code> project properties when specifying the Python module to load for a given test,
for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">data</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="k">class</span> <span class="nc">name</span><span class="o">=</span><span class="s2">&quot;PySysTest&quot;</span> <span class="n">module</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{testRootDir}</span><span class="s2">/test-utils/custom_run_module.py&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">data</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>User-defined key/value data can be added to <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> (and will be inherited from any parent
<code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> files):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">data</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">user</span><span class="o">-</span><span class="n">data</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;myThing&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;foobar&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">data</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Any user-defined data is available as a string in the <code class="docutils literal notranslate"><span class="pre">userData</span></code> field of <a class="reference internal" href="autodocgen/pysys.config.descriptor.html#pysys.config.descriptor.TestDescriptor" title="pysys.config.descriptor.TestDescriptor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">self.descriptor</span></code></a>,
and each named value will be set as a variable on the <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest" title="pysys.basetest.BaseTest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest</span></code></a> class. If a static (non-instance) variable of the same name
exists on the test class at construction then the <code class="docutils literal notranslate"><span class="pre">&lt;user-data&gt;</span></code> will override it, but its type will be coerced
automatically to an int/float/bool to match the type of the variable. A <code class="docutils literal notranslate"><span class="pre">pysys.py</span> <span class="pre">run</span> <span class="pre">-Xname=value</span></code> argument can be
specified to provide a temporary override for any items in the test’s user data. Note that there is no
automatic substituting of <code class="docutils literal notranslate"><span class="pre">${...}</span></code> properties in user data values.</p>
</li>
</ul>
<p>Bug fixes:</p>
<ul class="simple">
<li><p>Handling of errors deleting previous test output has been improved. In 1.5.0, there was a usability regression in
which a test would fail to run if any part of its output directory could not be deleted due
to a shell or tool (e.g. tail) keeping it locked. Now, although error deleting files will still cause the test to
fail (since this has a high chance of affecting correctness), directory deletion errors are logged at WARN in the
test output but do not cause an error.</p></li>
<li><p>Fixed bug in which <code class="docutils literal notranslate"><span class="pre">BaseTest.assertDiff</span></code> was not logging the diff to the console after a failure.</p></li>
<li><p>Fixed bug in which a <code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> in the same directory as a <code class="docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> would be read twice,
potentially resulting in duplicated a <code class="docutils literal notranslate"><span class="pre">id-prefix</span></code>.</p></li>
<li><p>Fixed some bugs in the selection of test ids on the command line. Now we always prefer an exact match over any
possible suffix matches, and give an error if there are multiple matching suffixes rather than just picking one.</p></li>
<li><p>Fixed 1.5.0 bug in which a <code class="docutils literal notranslate"><span class="pre">-Xkey=value</span></code> command line value of <code class="docutils literal notranslate"><span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">0</span></code> would be converted to a boolean
True or False value instead of an int, when the <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest" title="pysys.basetest.BaseTest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest</span></code></a> object has a field named <code class="docutils literal notranslate"><span class="pre">key</span></code> of type int.</p></li>
<li><p>Fixed reading .properties file values that contain an equals <code class="docutils literal notranslate"><span class="pre">=</span></code> symbol.</p></li>
<li><p>Replace new line characters in test outcome reasons to avoid confusing tools.</p></li>
<li><p>Changed <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getNextAvailableTCPPort" title="pysys.basetest.BaseTest.getNextAvailableTCPPort"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getNextAvailableTCPPort</span></code></a> to check the allocated port isn’t in use on <code class="docutils literal notranslate"><span class="pre">localhost</span></code> (previously
we only checked <code class="docutils literal notranslate"><span class="pre">INADDR_ANY</span></code> which doesn’t include the <code class="docutils literal notranslate"><span class="pre">localhost</span></code> interface).</p></li>
</ul>
<p>Upgrade guide and compatibility:
This is a minor release so is not expected to break existing tests, however we recommend reading the notes
below and making any ‘recommended’ changes at a convenient time after upgrading (to avoid problems in future major
upgrades), and also running your tests with the new version before upgrading to confirm everything still works as
expected.</p>
<ul>
<li><p>Default project property <code class="docutils literal notranslate"><span class="pre">defaultAssertDiffStripWhitespace</span></code> was added. It is recommended to add this to
your <code class="docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> file set to false, but it is likely some test reference files may need fixing, so the
default value is True which maintains pre-1.5.1 behaviour.</p></li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForSignal" title="pysys.basetest.BaseTest.waitForSignal"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForSignal()</span></code></a> is now just an alias for the newly added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForGrep" title="pysys.basetest.BaseTest.waitForGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForGrep()</span></code></a>, which is the
preferred method to use for waiting until a regular expression is found in a file. This is a bit of API cleanup that
provides consistency with widely-used <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertGrep" title="pysys.basetest.BaseTest.assertGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertGrep()</span></code></a>, and increases clarity for new users who could
otherwise be unsure of the meaning of the term “signal”.</p>
<p>The two methods are identical except for a small usability improvement in the method signature to avoid a common
mistake in which the (rarely used, and never needed) <code class="docutils literal notranslate"><span class="pre">filedir</span></code> was given a prominent position as the second
positional argument and therefore sometimes incorrectly given the value intended for the <code class="docutils literal notranslate"><span class="pre">expr</span></code> expression to be
searched, as can be seen from the two signatures:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">waitForSignal</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">filedir</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">...</span> <span class="p">)</span>
<span class="k">def</span> <span class="nf">waitForGrep</span><span class="p">(</span>   <span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">filedir</span><span class="o">=</span><span class="kc">None</span> <span class="p">)</span>
</pre></div>
</div>
<p>In the new waitForGrep method, <code class="docutils literal notranslate"><span class="pre">filedir</span></code> can only be specified as a <code class="docutils literal notranslate"><span class="pre">filedir=</span></code> keyword argument, permitting the
more natural positional usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">waitForGrep</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;expr&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>There is no plan to actually remove waitForSignal, however in the interests of consistency we’d recommend doing a
find-replace <code class="docutils literal notranslate"><span class="pre">self.waitForSignal</span> <span class="pre">-&gt;</span> <span class="pre">self.waitForGrep</span></code> on your tests at a convenient time, bearing in mind that it
could result in test failures in the unlikely event you are setting <code class="docutils literal notranslate"><span class="pre">filedir</span></code> and doing so positionally rather
than with <code class="docutils literal notranslate"><span class="pre">filedir=</span></code>.</p>
<p>If you use the <code class="docutils literal notranslate"><span class="pre">verboseWaitForSignal</span></code> project property, we recommend you transition to the new
<code class="docutils literal notranslate"><span class="pre">verboseWaitForGrep</span></code> property, though both work on both methods for now.</p>
</li>
<li><p>In <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess()</span></code></a>, <code class="docutils literal notranslate"><span class="pre">background=True/False</span></code> has been added as an alternative and simpler equivalent of
<code class="docutils literal notranslate"><span class="pre">state=BACKGROUND</span></code>. It is preferred to use <code class="docutils literal notranslate"><span class="pre">background=True</span></code> in new tests (although there is no plan to
remove <code class="docutils literal notranslate"><span class="pre">state</span></code> so it is not mandatory to change existing tests).</p></li>
<li><p>The global namespace available for use in eval() methods such as <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertThat" title="pysys.basetest.BaseTest.assertThat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertThat</span></code></a>, <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertEval" title="pysys.basetest.BaseTest.assertEval"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertEval</span></code></a>,
<a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertLineCount" title="pysys.basetest.BaseTest.assertLineCount"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertLineCount</span></code></a> and <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForGrep" title="pysys.basetest.BaseTest.waitForGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForGrep</span></code></a> has been cut down to remove some functions and modules
(e.g. <code class="docutils literal notranslate"><span class="pre">filegrep</span></code>) that no-one is likely to be using. If you find you need anything that is no longer available,
just use <code class="docutils literal notranslate"><span class="pre">import_module('modulename').member</span></code> in your eval string to add it, but it is highly unlikely this will
affect anyone as none of the removed symbols were documented. Also <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertEval" title="pysys.basetest.BaseTest.assertEval"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertEval</span></code></a> is deprecated in
favor of <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertThat" title="pysys.basetest.BaseTest.assertThat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertThat</span></code></a> which provides more powerful capabilities (note that <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertThat" title="pysys.basetest.BaseTest.assertThat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertThat</span></code></a> was itself
previously deprecated, but after recent changes is now the preferred way to perform general-purpose assertions).</p></li>
<li><p>There are some deprecations in this release, to remove some items that no-one is likely to be using from the API.
We encourage users to check for and remove any references to the following to be ready for future removal:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pysys.utils.filecopy</span></code> and its functions <code class="docutils literal notranslate"><span class="pre">copyfileobj</span></code> and <code class="docutils literal notranslate"><span class="pre">filecopy</span></code> are now deprecated (and hidden from the
documentation) as there are functions in Python’s standard library module <code class="docutils literal notranslate"><span class="pre">shutil</span></code> that do the same thing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pysys.utils.threadpool</span></code> is also deprecated and hidden from the public API as it was never really
intended for general purpose use and Python 3 contains similar functionality.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">DTD</span></code> constants in <a class="reference internal" href="autodocgen/pysys.config.project.html#module-pysys.config.project" title="pysys.config.project"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.project</span></code></a> and <a class="reference internal" href="autodocgen/pysys.config.descriptor.html#module-pysys.config.descriptor" title="pysys.config.descriptor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.descriptor</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pysys.config.descriptor.XMLDescriptorParser</span></code> (replaced by <a class="reference internal" href="autodocgen/pysys.config.descriptor.html#pysys.config.descriptor.DescriptorLoader" title="pysys.config.descriptor.DescriptorLoader"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.descriptor.DescriptorLoader</span></code></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pysys.config.descriptor.XMLDescriptorContainer</span></code> (replaced by <a class="reference internal" href="autodocgen/pysys.config.descriptor.html#pysys.config.descriptor.TestDescriptor" title="pysys.config.descriptor.TestDescriptor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.descriptor.TestDescriptor</span></code></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pysys.config.descriptor.XMLDescriptorCreator</span></code> and <code class="docutils literal notranslate"><span class="pre">DESCRIPTOR_TEMPLATE</span></code> (create descriptors manually if needed)</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="section" id="to-1-5-0">
<h3>1.4.0 to 1.5.0<a class="headerlink" href="#to-1-5-0" title="Permalink to this headline">¶</a></h3>
<p>PySys 1.5.0 was released in July 2019.</p>
<p>PySys 1.5.0 brings some significant new features for large PySys projects
including support for running a test in multiple modes, and
<code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> files that allow you to specify defaults that apply to
all testcases under a particular directory - such as groups, modes, a prefix
to add to the start of each test id, and a numeric hint to help define the
execution order of your tests.</p>
<p>There is also new support for collecting files from each test output
directory (e.g. code coverage files), new features in the <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">run</span></code> and
<code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">print</span></code> command lines, and a host of small additions to the API to make
test creation easier e.g. <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertEval" title="pysys.basetest.BaseTest.assertEval"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertEval</span></code></a>, <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.copy" title="pysys.basetest.BaseTest.copy"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.copy</span></code></a> (with filtering of each copied
line) and <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.write_text" title="pysys.basetest.BaseTest.write_text"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.write_text</span></code></a> (for easy programmatic creation of files in the output
directory).</p>
<p>This is a major release and therefore there are a few significant changes
that could required changes in existing projects; please review the
compatibility section of this document and perform an initial test run using
the new PySys version to check for issues before switching over.</p>
<p>Miscellaneous new features:</p>
<ul>
<li><p>Added support for running tests in multiple modes from within a single PySys
execution. To make use of this, add the following property to your
<code class="xref py py-obj docutils literal notranslate"><span class="pre">pysysproject.xml</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;supportMultipleModesPerRun&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>The old concept of modes within PySys is now deprecated in favor of the
more powerful features of <code class="xref py py-obj docutils literal notranslate"><span class="pre">supportMultipleModesPerRun=True</span></code> so we recommend
all users to add this project setting when possible. Please note though that
it will result in slightly different behaviour (e.g. different output
directory names) if you have any tests with <code class="xref py py-obj docutils literal notranslate"><span class="pre">&lt;mode&gt;...</span></code> in their
descriptor. See the user guide for detailed information about running tests
in multiple modes.</p>
</li>
<li><p>Added a project configuration option that collects a copy of all test output
files matching a specified pattern into a single directory. This is useful
for collecting together code coverage files from all tests into one place,
and could also be used for collating other outputs such as performance or
memory usage graphs. Files are copied from the output directory at the
end of each test’s execution, and before any files are purged. The sample
project file shows how to use this feature to collect Python code
coverage files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pythonCoverageDir&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;__pysys_coverage_python_@OUTDIR@&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">collect</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">output</span> <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;.coverage*&quot;</span> <span class="n">outputDir</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{pythonCoverageDir}</span><span class="s2">&quot;</span> <span class="n">outputPattern</span><span class="o">=</span><span class="s2">&quot;@FILENAME@_@TESTID@_@UNIQUE@&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>The output directory is wiped clean at the start of each test run to prevent
unwanted interference between test runs, and is created on demand when the
first matching output file is found, so the directory will not be created if
there is no matching output.</p>
</li>
<li><p>Added support for generating code coverage reports for programs written in
Python, using the coverage.py library. To enable this, ensure the coverage
library is installed (<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">coverage</span></code>), add collecting of test output
files named <code class="docutils literal notranslate"><span class="pre">.coverage*</span></code> to a directory stored in the <code class="docutils literal notranslate"><span class="pre">pythonCoverageDir</span></code>
project property (see above example), and run the tests with
<code class="docutils literal notranslate"><span class="pre">-X</span> <span class="pre">pythonCoverage=true</span></code>. You can optionally set a project property
<code class="docutils literal notranslate"><span class="pre">pythonCoverageArgs</span></code> to pass arguments to the coverage tool, such as which
modules/files to include or omit. After all tests have been executed, the
runner calls a new method <code class="xref py py-obj docutils literal notranslate"><span class="pre">processCoverageData</span></code> which combines all the
collected coverage files into a single file and produces an HTML report
from it, within the pythonCoverageDir directory. If you wish to produce
coverage reports using other tools or languages (such as Java), this
should be easy to achieve by following the same pattern - using
<code class="xref py py-obj docutils literal notranslate"><span class="pre">&lt;collect-test-output&gt;</span></code> to gather the coverage files and providing a
custom implementation of <a class="reference internal" href="autodocgen/pysys.baserunner.html#pysys.baserunner.BaseRunner.processCoverageData" title="pysys.baserunner.BaseRunner.processCoverageData"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.baserunner.BaseRunner.processCoverageData</span></code></a>.</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertEval" title="pysys.basetest.BaseTest.assertEval"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertEval</span></code></a> method which supersedes <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertThat" title="pysys.basetest.BaseTest.assertThat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertThat</span></code></a> and provides
a convenient way to assert an arbitrary Python expression, with generation of
a clear outcome reason that is easy to understand and debug.</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.copy" title="pysys.basetest.BaseTest.copy"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.copy</span></code></a> method for copying a binary or text file, with
optional transformation of the contents by a series of mapping functions.
This can be used to extract information of interest from a log file before
diff-ing with a reference copy, for example by stripping out timestamps
and irrelevant information.</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.write_text" title="pysys.basetest.BaseTest.write_text"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.write_text</span></code></a> method for writing characters to a text file
in the output directory using a single line of Python.</p></li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">expectedExitStatus</span></code> parameter to <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess()</span></code></a> method
which can be used to assert that a command returns a non-zero exit code,
for example <code class="docutils literal notranslate"><span class="pre">self.startProcess(...,</span> <span class="pre">expectedExitStatus='==5')</span></code>.
This is simpler and more intuitive than setting <code class="xref py py-obj docutils literal notranslate"><span class="pre">ignoreExitStatus=True</span></code> and
then checking the exit status separately.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">quiet</span></code> parameter to <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess()</span></code></a> method
which disable INFO/WARN level logging (unless a failure outcome is appended),
which is useful when calling a process repeatedly to poll for completion of
some operation.</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startPython" title="pysys.basetest.BaseTest.startPython"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startPython</span></code></a> method with similar options to <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess</span></code></a>
that should be used for starting Python processes. Supports functionality
such as Python code coverage.</p></li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.disableCoverage</span></code> attribute which can be used to globally
disable all code coverage (in all languages) for a specific test. For example
if you apply a group called ‘performance’ to all performance tests, you could
disable coverage for those tests by adding this line to your BaseTest:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s1">&#39;performance&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">disableCoverage</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">hostname</span></code>, <code class="docutils literal notranslate"><span class="pre">startTime</span></code> and <code class="docutils literal notranslate"><span class="pre">startDate</span></code> project properties which can be
used in any <code class="docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> configuration file. The start time/date
gives the UTC time when the test run began, using the yyyy-mm-dd HH.MM.SS
format which is suitable for inclusion in file/directory names.</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getBoolProperty" title="pysys.basetest.BaseTest.getBoolProperty"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getBoolProperty()</span></code></a> helper method which provides a simple way to
get a True/False value indicating whether a setting is enabled, either
directly using a <code class="docutils literal notranslate"><span class="pre">-X</span> <span class="pre">prop=value</span></code> argument, or with a property set in the
<code class="docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> configuration file.</p></li>
<li><p>Added environment variable <code class="docutils literal notranslate"><span class="pre">PYSYS_PORTS_FILE</span></code> which if present will be read
as a UTF-8/ASCII file with one port number on each line, and used to populate
the pool of ports for <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getNextAvailableTCPPort" title="pysys.basetest.BaseTest.getNextAvailableTCPPort"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getNextAvailableTCPPort()</span></code></a>. This can be used to
avoid port conflicts when invoking PySys from an environment where some ports
are taken up by other processes.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">TIMEOUTS['WaitForAvailableTCPPort']</span></code> which controls how long
<a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getNextAvailableTCPPort" title="pysys.basetest.BaseTest.getNextAvailableTCPPort"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getNextAvailableTCPPort()</span></code></a> will wait before throwing an exception.
Previously <code class="docutils literal notranslate"><span class="pre">getNextAvailableTCPPort()</span></code> would have thrown an exception if
other tests were using up all ports from the available pool; the new
behaviour is to block and retry until this timeout is reached.</p></li>
</ul>
<p>Improvements to the XML descriptors that provide information about tests:</p>
<ul>
<li><p>Added support for disabling search for testcases in part of a directory tree
by adding a <code class="docutils literal notranslate"><span class="pre">.pysysignore</span></code> or <code class="docutils literal notranslate"><span class="pre">pysysignore</span></code> file. This is just an empty file
that prevents searching inside the directory tree that contains it for tests.
This could be useful for reducing time taken to locate testcase and also for
avoiding errors if a subdirectory of your PySys project directory contains
any non-PySys files with filenames that PySys would normally interpret
as a testcase such as <code class="docutils literal notranslate"><span class="pre">descriptor.xml</span></code>.</p></li>
<li><p>Added a new XML file called <code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> which is similar to
<code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> and allows setting configuration options that affect all
tests under the directory containing the <code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> file.</p>
<p>This allows setting things like groups, test id prefix, execution order,
and skipping of tests for a set of related testcases without needing to
add the options to each and every individual <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> file. For
example, if you have a couple of directories containing performance tests
you could add <code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> files to each with a
<code class="docutils literal notranslate"><span class="pre">&lt;group&gt;performance&lt;/group&gt;</span></code> element so it’s easy to include/exclude all
your performance when you invoke <code class="docutils literal notranslate"><span class="pre">pysys.py</span> <span class="pre">run</span></code>. You could also include
a <code class="docutils literal notranslate"><span class="pre">&lt;execution-order</span> <span class="pre">hint=&quot;+100&quot;/&gt;</span></code> to specify that performance
tests should be run after your other tests(the default order hint is 0.0).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> file can contain any option that’s valid in
a <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> file except the <code class="docutils literal notranslate"><span class="pre">description/title/purpose</span></code>. a sample
<code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> file is provided in <code class="docutils literal notranslate"><span class="pre">pysys/config/templates/dirconfig</span></code>.</p>
<p>See the PySys User Guide for more information.</p>
</li>
<li><p>Added support for specifying a prefix that will be added to start of the
testcase directory name to form the testcase identifier. This can be
specified in <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> testcase descriptor files and/or in
directory-level <code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> files like this:</p>
<blockquote>
<div><p>&lt;id-prefix&gt;MyComponent.Performance.&lt;/id-prefix&gt;</p>
</div></blockquote>
<p>Large test projects may benefit from setting prefixes in <code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code>
files to provide automatic namespacing of testcases, ensuring there are no name
clashes across different test directories, and providing a way to group
together related test ids without the need to use very long names for
each individual testcase directory. Prefixes can be specified cumulatively,
so with the final testcase id generated from adding the prefix from each
parent directory, finishing with the name of the testcase directory itself.</p>
<p>We recommend using an underscore or dot character for separating test
prefixes.</p>
</li>
<li><p>Added support for specifying the order in which testcases are run. To do
this, specify a floating point value in any <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> testcase
descriptor, or <code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> descriptor (which provides a default for
all testcases under that directory):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">execution</span><span class="o">-</span><span class="n">order</span> <span class="n">hint</span><span class="o">=</span><span class="s2">&quot;+100.0&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>Tests with a higher ordering hint are executed after tests with lower
values. The default order value is 0.0, and values can be positive or
negative. Tests with the same order hint are executed based on the
sort order of the testcase directories. It is also possible to configure
hints at a project level for specific modes or groups. See the user guide
for more information.</p>
<p>You might want to specify a large order hint for long-running performance or
robustness tests to ensure they execute after more important unit/correctness
tests. You might want to specify a negative hint for individual tests that
are known to take a long time (if you’re running with multiple threads), to
ensure they get an early start and don’t hold up the completion of the test
run.</p>
</li>
<li><p>Added a new way to skip tests, by adding this element to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysystest.xml</span></code>
descriptor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">skipped</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Skipped due to open bug ABC-123&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>Although tests can still be skipped by setting the <code class="docutils literal notranslate"><span class="pre">state=&quot;skipped&quot;</span></code>
attribute, the use of the <code class="docutils literal notranslate"><span class="pre">skipped</span></code> element is recommended as it provides a
way to specify the reason the test has been skipped, and also allows a
whole directory of tests to be skipped by adding the element to a
<code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> file. The default <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> template generated
for new testcases now contains a commented-out <code class="docutils literal notranslate"><span class="pre">skipped</span></code> element instead of
a <code class="xref py py-obj docutils literal notranslate"><span class="pre">state=</span></code> attribute.</p>
</li>
<li><p>Added a new API for overriding the way test descriptors are loaded from a
directory on the file system. This allows for programmatic customization
of descriptor settings such as the supported modes for each testcase, and
also provides a way to make PySys capable of finding and running non-PySys
tests (by programmatically creating PySys TestDescriptor objects for them).
See the <a class="reference internal" href="autodocgen/pysys.config.descriptor.html#pysys.config.descriptor.DescriptorLoader" title="pysys.config.descriptor.DescriptorLoader"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.descriptor.DescriptorLoader</span></code></a> class for more details.</p></li>
</ul>
<p>Improvements to the <code class="docutils literal notranslate"><span class="pre">pysys.py</span></code> command line tool:</p>
<ul>
<li><p>Added support for running tests by specifying just a (non-numeric) suffix
without needing to include the entire id. Although support for specifying a
pure numeric suffix (e.g. <code class="docutils literal notranslate"><span class="pre">pysys.py</span> <span class="pre">run</span> <span class="pre">10</span></code>) has been around for a long time,
you can now do the same with strings such as <code class="docutils literal notranslate"><span class="pre">pysys.py</span> <span class="pre">run</span> <span class="pre">foo_10</span></code>.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">--sort</span></code> option to <code class="docutils literal notranslate"><span class="pre">pysys.py</span> <span class="pre">print</span></code>. This allows sorting by <code class="docutils literal notranslate"><span class="pre">title</span></code>
which is very helpful for displaying related testcases together (especially
if the titles are written carefully with common information at the beginning
of each one) and therefore for more easily locating testcases of interest.
It can also sort by <code class="docutils literal notranslate"><span class="pre">id</span></code> or <code class="docutils literal notranslate"><span class="pre">executionOrderHint</span></code> which indicates the order
in which the testcases will be executed. The default sort order if none of
these options is specified continues to be based on the full path of the
<code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> files.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">--grep</span></code>/<code class="docutils literal notranslate"><span class="pre">-G</span></code> filtering option to <code class="docutils literal notranslate"><span class="pre">pysys.py</span> <span class="pre">print</span></code> and <code class="docutils literal notranslate"><span class="pre">pysys.py</span> <span class="pre">run</span></code>
which selects testcases that have the specific regular expression (matched
case insensitively) in their <code class="docutils literal notranslate"><span class="pre">id</span></code> or <code class="docutils literal notranslate"><span class="pre">title</span></code>. This can be a convenient way
to quickly run a set of tests related to a particular feature area.</p></li>
<li><p>Added a concise summary of the test ids for any non-passes in a format that’s
easy to copy and paste into a new command, such as for re-running the failed
tests. This can be disabled using the <a class="reference internal" href="autodocgen/pysys.writer.console.html#pysys.writer.console.ConsoleSummaryResultsWriter" title="pysys.writer.console.ConsoleSummaryResultsWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writer.console.ConsoleSummaryResultsWriter</span></code></a> property
<code class="docutils literal notranslate"><span class="pre">showTestIdList</span></code> if desired.</p></li>
<li><p>Added an environment variable <code class="docutils literal notranslate"><span class="pre">PYSYS_DEFAULT_THREADS</span></code> which can be used to set
the number of threads to use with <code class="docutils literal notranslate"><span class="pre">--threads</span> <span class="pre">auto</span></code> is specified on a
per-machine or per-user basis.</p></li>
<li><p>Added the ability to set logging verbosity for specific <code class="docutils literal notranslate"><span class="pre">pysys.*</span></code> categories
individually using <code class="docutils literal notranslate"><span class="pre">-vCAT=LEVEL</span></code>. For example to enable just DEBUG logging
related to process starting, use <code class="docutils literal notranslate"><span class="pre">-vprocess=DEBUG</span></code>. Detailed DEBUG logging
related to assertions including the processed version of the input files uses
the category “assertions” and is no longer included by default when the
root log level is specified using <code class="docutils literal notranslate"><span class="pre">-vDEBUG</span></code> since it tends to be excessively
verbose and slow to generate; if required, it can be enabled using
<code class="docutils literal notranslate"><span class="pre">-vassertions=DEBUG</span></code>.</p></li>
<li><p>Argument parsing now permits mixing of <code class="docutils literal notranslate"><span class="pre">-OPTION</span></code> and non-option (e.g. test
id) arguments, rather than requiring that the test ids be specified
only at the end of the command line. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pysys</span> <span class="n">run</span> <span class="o">--</span><span class="n">threads</span> <span class="n">auto</span> <span class="n">MyTest_001</span> <span class="o">-</span><span class="n">vDEBUG</span>
</pre></div>
</div>
</li>
<li><p>Added automatic conversion of strings specified on the command line with
<code class="docutils literal notranslate"><span class="pre">-Xkey=value</span></code> to int, float or bool if there’s a static variable of the
same name and one of those types defined on the test <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest" title="pysys.basetest.BaseTest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest</span></code></a> class. This makes it
easier to write tests that have their parameters overridden from the command
line. For example, if a test class has a static variable <code class="docutils literal notranslate"><span class="pre">iterations=1000</span></code>
to control how many iterations it performs, it can be run with
<code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">run</span> <span class="pre">-Xiterations=10</span></code> during test development to override the number
of iterations to a much lower number without any changes to <code class="docutils literal notranslate"><span class="pre">run.py</span></code>.
Note that this doesn’t apply to BaseRunner, only BaseTest.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">--json</span></code> output mode to <code class="docutils literal notranslate"><span class="pre">pysys.py</span> <span class="pre">print</span></code> which dumps full information
about the available tests in JSON format suitable for reading in from other
programs.</p></li>
<li><p>Changed <code class="docutils literal notranslate"><span class="pre">makeproject</span></code> so that when a template is to be specified, it is now
necessary to use an explicit <code class="docutils literal notranslate"><span class="pre">--template</span></code> argument, e.g <code class="docutils literal notranslate"><span class="pre">--template=NAME</span></code>.</p></li>
</ul>
<p>Bug fixes:</p>
<ul class="simple">
<li><p>PySys now uses <code class="docutils literal notranslate"><span class="pre">Test</span> <span class="pre">outcome</span> <span class="pre">reason:</span></code> rather than <code class="docutils literal notranslate"><span class="pre">Test</span> <span class="pre">failure</span> <span class="pre">reason:</span></code>
to display the outcome, since there is sometimes a reason for non-failure
outcomes such as SKIPPED.</p></li>
<li><p>Fixed <code class="docutils literal notranslate"><span class="pre">--purge</span></code> to delete files in nested subdirectories of the output
directory not just direct children of the output directory.</p></li>
<li><p>Previous versions of PySys did not complain if you created multiple tests
with the same id (in different parent directories under the same project).
This was dangerous as the results would overwrite each other, so in this
version PySys checks for this condition and will terminate with an error
if it is detected. If you intentionally have multiple tests with the same
name in different directories, add an <code class="docutils literal notranslate"><span class="pre">&lt;id-prefix&gt;</span></code> element to the
<code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> or (better) to a <code class="docutils literal notranslate"><span class="pre">pysysdirconfig.xml</span></code> file to provide
separate namespaces for the tests in each directory and avoid colliding ids.</p></li>
<li><p>The Ant JUnit writer now includes the test duration.</p></li>
<li><p>Improved <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertGrep" title="pysys.basetest.BaseTest.assertGrep"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertGrep</span></code></a> outcome reason to include the entire matching string
when a <code class="docutils literal notranslate"><span class="pre">contains=False</span></code> test fails since <code class="docutils literal notranslate"><span class="pre">ERROR</span> <span class="pre">-</span> <span class="pre">The</span> <span class="pre">bad</span> <span class="pre">thing</span> <span class="pre">happened</span></code> is
a much more useful outcome reason than just <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>.</p></li>
<li><p>Fixed CSV performance reporter runDetails which was including each item
twice.</p></li>
<li><p>On Windows, paths within the testcase are now normalized so that the drive
letter is always capitalized (e.g. <code class="docutils literal notranslate"><span class="pre">C:</span></code> not <code class="docutils literal notranslate"><span class="pre">c:</span></code>). Previously the
capitalization of the drive letter would vary depending on how exactly PySys
was launched, which could occasionally lead to inconsistent behaviour if
testing an application that relies on the ASCII sort order of paths.</p></li>
</ul>
<p>Upgrade guide and compatibility:</p>
<p>Occasionally it is necessary for a new PySys release to include changes that
might change or break the behaviour of existing test suites. As 1.5.0 is a
major release it is possible that some users might need to make changes:</p>
<ul>
<li><p>Errors and typos in <code class="docutils literal notranslate"><span class="pre">pysystest.xml</span></code> XML descriptors will now prevent any tests
from running, whereas previously they would just be logged. Since an invalid
descriptor prevents the associated testcase from reporting a result, the
new behaviour ensures such mistakes will be spotted and fixed promptly.
If you have any non-PySys files under your PySys project root directory
with names such as <code class="docutils literal notranslate"><span class="pre">descriptor.xml</span></code> which PySys would normally recognise
as testcases, you can avoid errors by adding a <code class="docutils literal notranslate"><span class="pre">.pysysignore</span></code> file to prevent
PySys looking in that part of the directory tree.</p></li>
<li><p><a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.mkdir" title="pysys.basetest.BaseTest.mkdir"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.mkdir</span></code></a> now returns the absolute path (including the output
directory) instead of just the relative path passed in. This make it easier
to use in-line while performing operations such as creating a file in the
new directory. Code that relied on the old behaviour of returning the
path passed in may need to be updated to avoid having the output directory
specified twice. If you’re using <code class="docutils literal notranslate"><span class="pre">os.path.join</span></code> then no change will be
required.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">self.output</span></code> variable in <a class="reference internal" href="autodocgen/pysys.baserunner.html#pysys.baserunner.BaseRunner" title="pysys.baserunner.BaseRunner"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.baserunner.BaseRunner</span></code></a> is no longer set to the current
directory, but instead to a <code class="docutils literal notranslate"><span class="pre">pysys-runner-OUTDIR</span></code> subdirectory of the
test root (or to <code class="docutils literal notranslate"><span class="pre">OUTDIR/pysys-runner</span></code> if <code class="docutils literal notranslate"><span class="pre">OUTDIR</span></code> is an absolute path).
This ensures that any files created by the runner go into a known location
that is isolated from other runs using a different <code class="xref py py-obj docutils literal notranslate"><span class="pre">OUTDIR</span></code>. The runner’s
<code class="docutils literal notranslate"><span class="pre">self.output</span></code> directory is often not actually used for anything since
most logic that writes output files lives in <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest" title="pysys.basetest.BaseTest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest</span></code></a> subclasses, so
most users won’t be affected. For the same reason, the runner output
directory is not created (or cleaned) automatically.
If you have a custom <code class="docutils literal notranslate"><span class="pre">BaseRunner</span></code> that writes files to its output directory
then you should add a call to <code class="docutils literal notranslate"><span class="pre">self.deleteDir</span> <span class="pre">&lt;BaseTest.deleteDir&gt;</span></code> and then
<a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.mkdir" title="pysys.basetest.BaseTest.mkdir"><code class="xref py py-obj docutils literal notranslate"><span class="pre">self.mkdir</span></code></a> to
clean previous output and then create the new output directory.</p></li>
<li><p>The behaviour of <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getDefaultEnvirons" title="pysys.basetest.BaseTest.getDefaultEnvirons"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getDefaultEnvirons</span></code></a> has changed compared to
PySys 1.4.0, but only when the command being launched is <code class="docutils literal notranslate"><span class="pre">sys.executable</span></code>,
i.e. another instance of the current Python process (<code class="docutils literal notranslate"><span class="pre">getDefaultEnvirons</span></code> is
used by <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess</span></code></a> when <code class="docutils literal notranslate"><span class="pre">environs=</span></code> is not explicitly provided).</p>
<p>In 1.4.0 the returned environment always set the <code class="docutils literal notranslate"><span class="pre">PYTHONHOME</span></code> environment
variable, and on Windows would add a copy of the` <code class="xref py py-obj docutils literal notranslate"><span class="pre">PATH`</span></code> environment from the
parent process. In PySys 1.5.0 this is no longer the case, as the 1.4.0
behaviour was found to cause subtle problems when running from a virtualenv
installation or when the child Python itself launches another Python process
of a different version. The new behaviour is that <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getDefaultEnvirons" title="pysys.basetest.BaseTest.getDefaultEnvirons"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getDefaultEnvirons</span></code></a> adds
the directory containing the Python executable to <code class="docutils literal notranslate"><span class="pre">PATH</span></code> (on all OSes), and
copies the <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> from the parent process only on Unix (where it
is necessary to reliably load the required libraries). <code class="xref py py-obj docutils literal notranslate"><span class="pre">getDefaultEnvirons</span></code>
no longer sets the <code class="docutils literal notranslate"><span class="pre">PYTHONHOME</span></code> environment variable.</p>
</li>
<li><p>The format of <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">print</span></code> has changed to use a <code class="docutils literal notranslate"><span class="pre">|</span></code> character instead of a
colon to separate the test id and titles. This makes it easier to copy and
paste test ids from <code class="docutils literal notranslate"><span class="pre">pysys</span> <span class="pre">print</span></code> into the command line.</p></li>
<li><p>Several fields in the <a class="reference internal" href="autodocgen/pysys.config.descriptor.html#pysys.config.descriptor.TestDescriptor" title="pysys.config.descriptor.TestDescriptor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.config.descriptor.TestDescriptor</span></code></a> (aka <code class="docutils literal notranslate"><span class="pre">XMLDescriptorContainer</span></code>) class
that used to contain absolute paths now contain paths relative to
the newly introduced <code class="xref py py-obj docutils literal notranslate"><span class="pre">testDir</span></code> member. These are: <code class="xref py py-obj docutils literal notranslate"><span class="pre">module</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">output</span></code>,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">input</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">reference</span></code>. The values of <code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.output/input/reference</span></code>
have not changed (these are still absolute paths), so this change is unlikely
to affect many users.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">PROJECT</span></code> variable in the <code class="xref py py-obj docutils literal notranslate"><span class="pre">constants</span></code> module is deprecated. Use
<code class="xref py py-obj docutils literal notranslate"><span class="pre">self.project</span></code> instead (which is defined on classes such as <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest" title="pysys.basetest.BaseTest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest</span></code></a>,
<a class="reference internal" href="autodocgen/pysys.baserunner.html#pysys.baserunner.BaseRunner" title="pysys.baserunner.BaseRunner"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.baserunner.BaseRunner</span></code></a> etc).</p></li>
</ul>
</div>
<div class="section" id="to-1-4-0">
<h3>1.3.0 to 1.4.0<a class="headerlink" href="#to-1-4-0" title="Permalink to this headline">¶</a></h3>
<p>PySys 1.4.0 was released in April 2019.</p>
<p>Installation:</p>
<ul class="simple">
<li><p>The available options for installing PySys have been reworked and modernised.
The recommended way to install PySys is by running <code class="xref py py-obj docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">PySys</span></code>.</p></li>
<li><p>A binary <code class="xref py py-obj docutils literal notranslate"><span class="pre">whl</span></code> wheel is now available for the first time, which is more
efficient, reliable and lightweight than other installation methods, and
is used by the pip installer. The <code class="xref py py-obj docutils literal notranslate"><span class="pre">tar.gz</span></code> source distribution is still
available but is no longer a recommended installation mechanism. The Windows
GUI installer is no longer published as this is superseded by the simpler
installation experience provided by <code class="xref py py-obj docutils literal notranslate"><span class="pre">pip</span></code>.</p></li>
<li><p>HTML documentation of the PySys API is no longer installed locally by default,
but is available on <a class="reference external" href="https://pysys-test.github.io/pysys-test">https://pysys-test.github.io/pysys-test</a> website or as a
separate zip file available from
<a class="reference external" href="https://github.com/pysys-test/pysys-test/releases">https://github.com/pysys-test/pysys-test/releases</a>.</p></li>
</ul>
<p>Improvements to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.py</span></code> tool:</p>
<ul>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.py</span></code> has a new <code class="xref py py-obj docutils literal notranslate"><span class="pre">makeproject</span></code> command that generates a default
<code class="xref py py-obj docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> with some recommended defaults to make it easy to start a
new project without needing to download the samples.</p></li>
<li><p>As an alternative to the usual <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.py</span></code> executable script, it is now also
possible to launch PySys using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pysys</span>
</pre></div>
</div>
</li>
<li><p>Added new command line option <code class="xref py py-obj docutils literal notranslate"><span class="pre">--printLogs</span> <span class="pre">all|failures|none</span></code> (default value
is <code class="xref py py-obj docutils literal notranslate"><span class="pre">all</span></code>) which allows user to avoid the printing of run.log to the stdout
console either for all tests, or for tests that pass. This is useful to
avoid generating huge amounts of output during large test runs (which can
be problematic when stdout is captured by a Continuous Integration system),
or to show detailed information only for failing tests which makes it easier
for a user to locate the diagnostic information they care about more quickly.
The specified value is stored in <code class="xref py py-obj docutils literal notranslate"><span class="pre">runner.printLogs</span></code> and can be changed by
custom writer implementations if desired, for example to avoid duplicating
information already being printed to stdout by the writer in a different
format.</p></li>
<li><p>PySys will now automatically enable colored output if there is no color
setting in the <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">PYSYS_COLOR</span></code> environment - provided
PySys is running in an interactive terminal. On Windows the <code class="xref py py-obj docutils literal notranslate"><span class="pre">colorama</span></code>
library is now a dependency to ensure colored output is always possible.</p></li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">--threads</span> <span class="pre">auto</span></code> which is equivalent to <code class="xref py py-obj docutils literal notranslate"><span class="pre">--threads</span> <span class="pre">0</span></code> and provides
a clearer way to indicate that PySys will automatically determine how many
threads to run tests with based on the number of available CPUs.</p></li>
<li><p>The outcome reason string now has a suffix specifying how many additional
failure outcomes were logged (so if you have a complex test you can see at a
glance if there’s just one problem to resolve, or 5, or 20!).</p></li>
</ul>
<p>New project options:</p>
<ul>
<li><p>Added support for running PySys tests under Travis CI(R) to the sample
<code class="xref py py-obj docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> file. Travis support includes by default only printing
<code class="xref py py-obj docutils literal notranslate"><span class="pre">run.log</span></code> output for failed tests, and containing that detailed output within
a folded section that can be expanded if needed. To enable this just ensure
that the Travis CI writer is enabled in your project configuration file,
which you can copy from the sample project configuration file if you already
have an existing project file.</p></li>
<li><p>Added support for configuring the default encodings to use for common file
patterns in the <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> configuration, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">default</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">encoding</span> <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;*.yaml&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="o">/&gt;.</span>
</pre></div>
</div>
<p>The sample project configuration file now
sets utf-8 as the default encoding for XML, json and yaml files, and also
for testcase run.log files (though run.log continues to be written in local
encoding unless the project file is updated). For more information on this
feature, see comments in <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> and in
<code class="xref py py-obj docutils literal notranslate"><span class="pre">ProcessUser.getDefaultFileEncoding()</span></code>.</p>
</li>
<li><p>Use of <code class="docutils literal notranslate"><span class="pre">print()</span></code> rather than <code class="docutils literal notranslate"><span class="pre">self.log</span></code> is a common mistake that results in
essential diagnostic information showing up on the console but not
stored in <code class="docutils literal notranslate"><span class="pre">run.log</span></code>. A new project option <code class="xref py py-obj docutils literal notranslate"><span class="pre">redirectPrintToLogger</span></code>
can optionally be enabled to instruct PySys to catch output written using
<code class="docutils literal notranslate"><span class="pre">print()</span></code> statements or to <code class="docutils literal notranslate"><span class="pre">sys.stdout</span></code> and redirect it to the logging
framework, so it will show up in <code class="docutils literal notranslate"><span class="pre">run.log</span></code>. Writers that genuinely need
the ability to write directly to stdout should be changed to use
<a class="reference internal" href="autodocgen/pysys.utils.logutils.html#pysys.utils.logutils.stdoutPrint" title="pysys.utils.logutils.stdoutPrint"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.logutils.stdoutPrint</span></code></a>.</p></li>
<li><p>There are new settings for customizing the default environment used by
<a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;defaultEnvironsDefaultLang&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;defaultEnvironsTempDir&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;self.output&#39;&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getDefaultEnvirons" title="pysys.basetest.BaseTest.getDefaultEnvirons"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getDefaultEnvirons()</span></code></a> for more information on these.</p>
</li>
</ul>
<p>Main API improvements:</p>
<ul>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.skipTest" title="pysys.basetest.BaseTest.skipTest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.skipTest()</span></code></a> method, which can be used to avoid running the
rest of the <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.execute" title="pysys.basetest.BaseTest.execute"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.execute()</span></code></a> or <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.validate" title="pysys.basetest.BaseTest.validate"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.validate()</span></code></a> method, if it is not appropriate for
the test to execute on this platform/mode.</p></li>
<li><p>Added boolean <a class="reference internal" href="autodocgen/pysys.constants.html#pysys.constants.IS_WINDOWS" title="pysys.constants.IS_WINDOWS"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.constants.IS_WINDOWS</span></code></a> constant, since conditionalizing logic for Windows
versus all other Operating Systems is very common; this avoids the need for
error-prone matching against string literals.</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess()</span></code></a> argument <code class="xref py py-obj docutils literal notranslate"><span class="pre">stdouterr</span></code> which allows
specifying the base prefix to use for writing process standard output and
error using a single parameter, either as a string or from a tuple such
as that returned from <code class="xref py py-obj docutils literal notranslate"><span class="pre">allocateUniqueStdOutErr()</span></code>. As as result there is no
longer a need to save the generated stdout and stderr to local variables
before passing to startProcess; you can simply specify:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">startProcess</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">stdouterr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">allocateUniqueStdOutErr</span><span class="p">(</span><span class="s1">&#39;myprocess&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Alternatively if you don’t care about allocating unique names (perhaps
because you have only one instance of the process) a simple string prefix
can be specified instead. The final <code class="xref py py-obj docutils literal notranslate"><span class="pre">stdout</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">stderr</span></code> paths are available
on the returned <code class="xref py py-obj docutils literal notranslate"><span class="pre">ProcessWrapper</span></code> object.</p>
<p>If no displayName is provided, <code class="xref py py-obj docutils literal notranslate"><span class="pre">startProcess</span></code> will generate one based on
the <code class="xref py py-obj docutils literal notranslate"><span class="pre">stdouterr</span></code> prefix so it’s easy to identify which process is being
started.</p>
</li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getDefaultEnvirons" title="pysys.basetest.BaseTest.getDefaultEnvirons"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getDefaultEnvirons()</span></code></a> method which is now used by
<a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess()</span></code></a> to provide a minimal but clean set of environment variables
for launching a given process, and can also be used as a basis for creating
customized environments using the new <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.createEnvirons" title="pysys.basetest.BaseTest.createEnvirons"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.createEnvirons()</span></code></a> helper method.
There are some new project properties to control how this works, which
you may wish to consider using for new projects, but are not enabled by
default in existing projects to maintain compatibility:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;defaultEnvironsDefaultLang&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;defaultEnvironsTempDir&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;self.output&#39;&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getDefaultEnvirons" title="pysys.basetest.BaseTest.getDefaultEnvirons"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getDefaultEnvirons()</span></code></a> for more information on these.
If needed you can further customize the environment by overriding
<code class="xref py py-obj docutils literal notranslate"><span class="pre">getDefaultEnvirons</span></code>.</p>
</li>
<li><dl class="simple">
<dt>Extended the writers API:</dt><dd><ul class="simple">
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">runLogOutput=</span></code> parameter to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">processResult()</span></code> method of
the <code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseResultsWriter</span></code> class so that writers such as the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">JUnitXMLResultsWriter</span></code> can include the test output with no loss of unicode
character information.</p></li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">testoutdir=</span></code> parameter to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">setup()</span></code> method so writers have
a way to identify different test runs on the same machine.</p></li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">runner=</span></code> parameter to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">setup()</span></code> method so writers have
access to the runner instance for reading/modifying configuration
settings.</p></li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">isEnabled()</span></code> method that can optionally be used by a writer to
disable itself based on the environment in which it is running, or
to enable itself even when <code class="xref py py-obj docutils literal notranslate"><span class="pre">--record</span></code> isn’t specified, which is useful
for writers that produce output for a CI system.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Rewrote the process monitoring API to make it easier to add extra monitoring
statistics (by subclassing the OS-specific <code class="xref py py-obj docutils literal notranslate"><span class="pre">DEFAULT_PROCESS_MONITOR</span></code> or the
superclass <code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseProcessMonitor</span></code>, or to add a custom handler for the
generated statistics, by subclassing <code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseProcessMonitorHandler</span></code>.</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startBackgroundThread" title="pysys.basetest.BaseTest.startBackgroundThread"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startBackgroundThread</span></code></a> method which takes care of ensuring
threads are stopped and joined during cleanup, that exceptions from threads
result in BLOCKED outcomes and that logging output from background threads
goes to the same handlers as foreground logging. The thread target can
be either a simple function or an instance method (e.g. on the testcase).
A Python <code class="xref py py-obj docutils literal notranslate"><span class="pre">threading.Event</span></code> object called <code class="xref py py-obj docutils literal notranslate"><span class="pre">stopped</span></code> is passed to the
background thread to make it easy to determine when it should finish
executing. The <code class="xref py py-obj docutils literal notranslate"><span class="pre">ProcessUser.addOutcome()</span></code> method is now thread-safe
(though most of the <code class="xref py py-obj docutils literal notranslate"><span class="pre">ProcessUser</span></code> and <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest" title="pysys.basetest.BaseTest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest</span></code></a> should still not be accessed
from multiple threads without locking).</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.pythonDocTest" title="pysys.basetest.BaseTest.pythonDocTest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.pythonDocTest()</span></code></a> method for executing the doctests in a
Python file.</p></li>
</ul>
<p>Minor API additions:</p>
<ul class="simple">
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">PerformanceUnit.NANO_SECONDS</span></code> (with alias <code class="xref py py-obj docutils literal notranslate"><span class="pre">ns</span></code>) which is now
recommended when measuring the peformance of operations that take less than a
second.</p></li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">__str__</span></code> implementations for BaseTest and BaseRunner, which uniquely
identify the test (and cycle, in multi-cycle runs). This may be useful for
diagnostic and logging purposes.</p></li>
<li><p>Performance reporter classes can now make use of <code class="xref py py-obj docutils literal notranslate"><span class="pre">self.runner</span></code> to access
information such as the mode in which the test is running for reporting
purposes.</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertPathExists" title="pysys.basetest.BaseTest.assertPathExists"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertPathExists</span></code></a> for checking that a file exists (or not).</p></li>
<li><p>The default implementation of <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.getDefaultFileEncoding" title="pysys.basetest.BaseTest.getDefaultFileEncoding"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.getDefaultFileEncoding()</span></code></a> now
delegates to the runner’s implementation, allowing customizations to be
performed in just one place if neede for both <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest" title="pysys.basetest.BaseTest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest</span></code></a> and runner class.</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.compareVersions" title="pysys.basetest.BaseTest.compareVersions"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.compareVersions()</span></code></a> static helper method for
comparing two alphanumeric dotted version strings.</p></li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.deletedir</span></code> which is more convenient that the associated
<code class="xref py py-obj docutils literal notranslate"><span class="pre">fileutils.deletedir</span></code> for paths under the <code class="xref py py-obj docutils literal notranslate"><span class="pre">self.output</span></code> directory.</p></li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.addOutcome(override=...)</span></code> argument which can be used to
specify a new test outcome that replaces any existing outcomes even if
they have a higher precedence.</p></li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">ignores=</span></code> argument to <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.waitForSignal" title="pysys.basetest.BaseTest.waitForSignal"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.waitForSignal()</span></code></a> method which
excludes lines matching the specified expression from matching both the
main <code class="xref py py-obj docutils literal notranslate"><span class="pre">expr</span></code> match expression and any <code class="xref py py-obj docutils literal notranslate"><span class="pre">errorExpr</span></code> expressions.</p></li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.fileutils.toLongPathSafe/fromLongPathSafe</span></code> which on Windows performs
the necessary magic to allow Python to access paths longer than 256
characters (and on other platforms are a no-op), and <code class="xref py py-obj docutils literal notranslate"><span class="pre">pathexists</span></code> which
is a long path-safe version of <code class="xref py py-obj docutils literal notranslate"><span class="pre">os.path.exists</span></code>. PySys will now handle long
paths in the most critical places, such as <code class="xref py py-obj docutils literal notranslate"><span class="pre">deletedir</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">logFileContents</span></code>,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">openfile</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">assertPathExists</span></code>, when enumerating available tests, and during
test cleanup. Test authors can make use of <code class="xref py py-obj docutils literal notranslate"><span class="pre">toLongPathSafe</span></code> as needed in
their own test cases.</p></li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.utils.logutils.html#pysys.utils.logutils.stdoutPrint" title="pysys.utils.logutils.stdoutPrint"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.logutils.stdoutPrint</span></code></a> for writers that genuinely need
the ability to write directly to stdout without using a logger.</p></li>
</ul>
<p>Upgrade guide and compatibility:</p>
<p>It is pretty rare for a new PySys release to include changes that might change
or break the behaviour of existing test suites, but occasionally it is
necessary in order to fix bugs or allow us to provide new functionality. In
this release there are a few such changes:</p>
<ul>
<li><p>In the previous release unknown or invalid keyword arguments passed to
assert* methods would be silently ignored (potentially masking mistakes);
now it is an error to specify an invalid argument.</p></li>
<li><p>The environment <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcess" title="pysys.basetest.BaseTest.startProcess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcess</span></code></a> uses by default if no <code class="xref py py-obj docutils literal notranslate"><span class="pre">environs=</span></code>
parameter was specified has changed. Although the documentation states that
a clean environment is used if no <code class="xref py py-obj docutils literal notranslate"><span class="pre">environs</span></code> dictionary is specified, in
PySys v1.1, 1.2 and 1.3 the Windows behaviour changed to include a copy of
all environment variables in the parent PySys process (typically a very
large set of variables), which could cause tests to unintentionally
be affected by the environment it was run from. This is now fixed, so that
a small minimal set of environment variables are always returned, as returned
by the new <code class="xref py py-obj docutils literal notranslate"><span class="pre">ProcessUser.getDefaultEnvirons()</span></code> method. As a result on Windows
a much smaller set of environment variables and PATH/LD_LIBRARY_PATH
components will be used, and on Unix instead of a completely empty
environment, a few variables will now be set. If this causes problems you can
temporarily go back to the legacy behaviour by setting this
<code class="xref py py-obj docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;defaultEnvironsLegacyMode&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/pysys-test/pysys-test/issues/9">https://github.com/pysys-test/pysys-test/issues/9</a> for more information.</p>
</li>
<li><p>The default process monitor file format has changed in this release to
provide consistency across all operating systems, and because the
Windows-specific statistics private/thread/handle count were not correct and
cannot easily be obtained in a robust way. If you need these, or wish to
use a wider set of monitoring statistics than PySys provides in the box, it
is easy to create a custom <code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseProcessMonitor</span></code> subclass, perhaps using a
cross-platform Python library such as <code class="xref py py-obj docutils literal notranslate"><span class="pre">psutil</span></code> to gather the data.</p>
<p>Previously there was no header line, and on Windows the columns were:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span><span class="o">/</span><span class="n">mm</span><span class="o">/</span><span class="n">yy</span> <span class="n">HH</span><span class="p">:</span><span class="n">MM</span><span class="p">:</span><span class="n">SS</span><span class="p">,</span> <span class="n">CPU</span><span class="p">,</span> <span class="n">Resident</span><span class="p">,</span> <span class="n">Virtual</span><span class="p">,</span> <span class="n">Private</span><span class="p">,</span> <span class="n">Threads</span><span class="p">,</span> <span class="n">Handles</span>
</pre></div>
</div>
<p>and on Linux:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm</span><span class="o">/</span><span class="n">dd</span><span class="o">/</span><span class="n">yy</span> <span class="n">HH</span><span class="p">:</span><span class="n">MM</span><span class="p">:</span><span class="n">SS</span><span class="p">,</span> <span class="n">CPU</span><span class="p">,</span> <span class="n">Resident</span><span class="p">,</span> <span class="n">Virtual</span>
</pre></div>
</div>
<p>In this release there is a header line comment at the start of the file
beginning with <code class="xref py py-obj docutils literal notranslate"><span class="pre">#</span></code> indicating the column headings. Also a standard date
format is used, and only the columns supported on all operating systems are
included:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yyyy</span><span class="o">-</span><span class="n">mm</span><span class="o">-</span><span class="n">dd</span> <span class="n">HH</span><span class="p">:</span><span class="n">MM</span><span class="p">:</span><span class="n">SS</span><span class="p">,</span> <span class="n">CPU</span><span class="p">,</span> <span class="n">Resident</span><span class="p">,</span> <span class="n">Virtual</span>
</pre></div>
</div>
<p>This behaviour can be customized for all your testcases from your runner’s
<code class="xref py py-obj docutils literal notranslate"><span class="pre">setup</span></code> method. For example to go back to the previous file format (although
without the Windows-specific columns, which are no longer supported), add:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ProcessMonitorTextFileHandler</span><span class="o">.</span><span class="n">setDefaults</span><span class="p">(</span>
    <span class="p">[</span>
       <span class="n">ProcessMonitorKey</span><span class="o">.</span><span class="n">DATE_TIME_LEGACY</span><span class="p">,</span>
       <span class="n">ProcessMonitorKey</span><span class="o">.</span><span class="n">CPU_CORE_UTILIZATION</span><span class="p">,</span>
       <span class="n">ProcessMonitorKey</span><span class="o">.</span><span class="n">MEMORY_RESIDENT_KB</span><span class="p">,</span>
       <span class="n">ProcessMonitorKey</span><span class="o">.</span><span class="n">MEMORY_VIRTUAL_KB</span><span class="p">,</span>
    <span class="p">],</span> <span class="n">writeHeaderLine</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Also note that the numProcessors keyword argument to <code class="xref py py-obj docutils literal notranslate"><span class="pre">startProcessMonitor</span></code> is
deprecated. For now it can still be used to scale down the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">CPU_CORE_UTILIZATION</span></code> value but it is not recommended for use and may be
removed in a future release. Use <code class="xref py py-obj docutils literal notranslate"><span class="pre">CPU_TOTAL_UTILIZATION</span></code> if you wish to see
total CPU usage across all cores.</p>
<p>In the previous release, the Linux process monitor also gathered data
from child processes (that were running at the moment the monitor was
started). As this functionality was Linux-specific, not documented, and
generated incorrect results this has been removed. Optional support for
monitoring child processes may be re-added in a future PySys release.
Although child process are not included in the statistics for each process,
the contributions from its child threads are included.</p>
</li>
<li><p>If you have created a custom subclass of <code class="xref py py-obj docutils literal notranslate"><span class="pre">ProcessMonitor</span></code> you will need to
rework it, as this class no longer exists and the API has been rewritten in
order to make it easier to maintain and extend.
For example it is now easier to add extra monitoring statistics (by
subclassing <code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseProcessMonitor</span></code>), or provide custom handlers for the data
for different file formats or automated checking of results (by subclassing
<code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseProcessMonitorHandler</span></code>; no longer requires subclassing the process
monitor itself). If you have written a custom subclass of ProcessMonitor
to customize what data is gathered you will need to rework it when moving to
this version of PySys. If you need to provide custom code to handle the
generated statistics, you can now do that by passing a
<code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseProcessMonitorHandler</span></code> subclass to <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.startProcessMonitor" title="pysys.basetest.BaseTest.startProcessMonitor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.startProcessMonitor</span></code></a>.</p></li>
<li><p>Fixed bug in which symbols (classes, constants, imports) defined in one
<code class="xref py py-obj docutils literal notranslate"><span class="pre">run.py</span></code> could be seen by other run.py files, potentially causing test
behaviour to vary based on what other tests had previously run, and/or
race conditions seen only during parallel execution. Now every <code class="xref py py-obj docutils literal notranslate"><span class="pre">run.py</span></code> file
has its own independent namespace. It is possible some previously passing
tests might fail as a result of this change, if they were relying on
the buggy behaviour to implicitly import symbols.</p></li>
<li><p>Although most real PySys projects had a <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysysproject.xml</span></code> file in the root
directory specifying the configuration, PySys v1.3.0 and earlier treated
this file as optional, resulting in confusing error messages, and
long and sometimes disruptive searching of non-test directories if a user
tried to run PySys from a non-test directory (e.g. from <code class="xref py py-obj docutils literal notranslate"><span class="pre">c:</span></code>). To avoid
user confusion, by default PySys will now terminate with an error if you
try to run it from a directory which doesn’t have a project file. Any users
who found the ability to use it without a project file useful can enable
it by setting the <code class="xref py py-obj docutils literal notranslate"><span class="pre">PYSYS_PERMIT_NO_PROJECTFILE=true</span></code> environment variable.</p></li>
<li><p>Removed <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.smtpserver</span></code> which was never used by any part of PySys,
does not really belong in this project, and adds little over Python’s
built-in <code class="xref py py-obj docutils literal notranslate"><span class="pre">smtpd</span></code> module.</p></li>
<li><p>Removed <code class="xref py py-obj docutils literal notranslate"><span class="pre">DEFAULT_STYLESHEET</span></code> <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys-log.xsl</span></code> as referenced in
<code class="xref py py-obj docutils literal notranslate"><span class="pre">XMLResultsWriter</span></code>, as it does not work in most modern browsers
(e.g. Chrome, Firefox) for security reasons and is not widely used. If you
need this functionality, the ability to specify a custom .xsl stylesheet for
the <code class="xref py py-obj docutils literal notranslate"><span class="pre">XMLResultsWriter</span></code> is still available as a configuration option in
<code class="xref py py-obj docutils literal notranslate"><span class="pre">pysysproject.xml</span></code>.</p></li>
<li><p>Any custom performance reporter classes created using PySys 1.3.0
and which provided a custom constructor should be updated to include the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">**kwargs</span></code> parameter added in this version of PySys, as the old constructor
signature is now deprecated. As this API was added in 1.3.0 no other versions
are affected.</p></li>
</ul>
<p>Bug fixes:</p>
<ul class="simple">
<li><p>Fixed bug in which random log lines might not be written to <code class="xref py py-obj docutils literal notranslate"><span class="pre">run.log</span></code> and/or
stdout when running tests multi-threaded (as a result of an underlying
python bug <a class="reference external" href="https://bugs.python.org/issue35185">https://bugs.python.org/issue35185</a>).</p></li>
<li><p>Fixed bug in which symbols (classes, constants, imports) defined in one
<code class="xref py py-obj docutils literal notranslate"><span class="pre">run.py</span></code> could be seen by other run.py files, potentially causing test
behaviour to vary based on what other tests had previously run, and/or
race conditions seen only during parallel execution. Now every <code class="xref py py-obj docutils literal notranslate"><span class="pre">run.py</span></code> file
has its own independent namespace. It is possible some previously passing
tests might fail as a result of this change, if they were relying on
the buggy behaviour to implicitly import symbols.</p></li>
<li><p>Fixed <code class="xref py py-obj docutils literal notranslate"><span class="pre">startProcess()</span></code> to use a clean and minimal set of environment
variables on Windows if no <code class="xref py py-obj docutils literal notranslate"><span class="pre">environs=</span></code> parameter was specified, rather than
copying all environment variables from the parent PySys process to the child
process. See <a class="reference external" href="https://github.com/pysys-test/pysys-test/issues/9">https://github.com/pysys-test/pysys-test/issues/9</a> for more
information.</p></li>
<li><p>Fixed <code class="xref py py-obj docutils literal notranslate"><span class="pre">startProcess()</span></code> to add a <code class="xref py py-obj docutils literal notranslate"><span class="pre">BLOCKED</span></code> test outcome when a process fails
to start due to a <code class="xref py py-obj docutils literal notranslate"><span class="pre">ProcessError</span></code>, unless <code class="xref py py-obj docutils literal notranslate"><span class="pre">ignoreExitStatus=True</span></code>. Previously
this flag only affected non-zero exit codes, resulting in <code class="xref py py-obj docutils literal notranslate"><span class="pre">ProcessError</span></code>
failures getting ignored.</p></li>
<li><p>Fixed <code class="xref py py-obj docutils literal notranslate"><span class="pre">startProcess()</span></code> to correctly handle passing empty arguments,
and arguments containing spaces, quotes and glob characters on Windows.
Previously, empty arguments were skipped, and arguments containing spaces
were only handled correctly if first character was not a space.</p></li>
<li><p>Fixed a number of errors in the statistics reported by process monitors,
especially on Windows where negative values were sometimes returned
(due to integer overflow), incorrect (and very time-consuming) aggregation
based on the child threads that existed at the time the process monitor was
first started, lack of support for non-English Windows installations
(which have localized counter names) and that the statistics might be
returned for the wrong process due to the way the performance counter API
changes which process is being monitored when processes of the same name
terminate.
On Linux the statistics were sometimes wrong due to undocumented and
in some cases incorrect aggregation across child processes, which has now
been removed. The values are now correct on all operating systems.</p></li>
<li><p>Fix bug in which non-ASCII characters in test outcome reasons could
prevent the test log being written to disk if executed in multi-threaded
mode. Only affects Python 2.</p></li>
<li><p>Significant improvements to robustness when testing support for international
(I18N) characters. This includes implementing fully safe logging of unicode
strings (with <code class="xref py py-obj docutils literal notranslate"><span class="pre">?</span></code> replacements for any unsupported characters) that works
regardless of what encoding is in use for stdout and <code class="xref py py-obj docutils literal notranslate"><span class="pre">run.log</span></code>. Also fixed
exception when logging unicode characters in Python 2 if a formatter was not
configured in <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysysproject.xml</span></code>, by ensuring it is always stored as a
unicode character string not a byte string (which used to happen in Python 2
if it was not mentioned in the project config). Fixed <code class="xref py py-obj docutils literal notranslate"><span class="pre">logFileContents</span></code> to
more robustly handle files containing I18N/non-ASCII characters.</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">JUnitXMLResultsWriter</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">XMLResultsWriter</span></code> now write using UTF-8
encoding rather than local/default encoding, and also include the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">encoding=&quot;utf-8&quot;</span></code> header in the XML header. Since previously there was no
<code class="xref py py-obj docutils literal notranslate"><span class="pre">encoding</span></code> header many tools would have interpreted them as UTF-8 already,
and now the behaviour is consistent with that expectation.</p></li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.writers.replaceIllegalXMLCharacters()</span></code> utility function, and use
it to avoid <code class="xref py py-obj docutils literal notranslate"><span class="pre">XMLResultsWriter</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">JUnitXMLResultsWriter</span></code> from generating
invalid XML if <code class="xref py py-obj docutils literal notranslate"><span class="pre">run.log</span></code> or outcome reason contain characters not permitted
by XML. Also ASCII control characters (e.g. coloring instructions
from other tools) are now stripped out of all outcome reason strings
(including in run.log and non-XML based writers) since such characters
are not useful and make summary test results harder to read.</p></li>
<li><p>Fixed rare condition in which performance result reporting would be prevented
due to spurious error about <code class="xref py py-obj docutils literal notranslate"><span class="pre">resultKey</span></code> already being used.</p></li>
</ul>
</div>
<div class="section" id="to-1-3-0">
<h3>1.2.0 to 1.3.0<a class="headerlink" href="#to-1-3-0" title="Permalink to this headline">¶</a></h3>
<p>Changes affecting compatibility:</p>
<ul class="simple">
<li><p>Fixed <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.assertDiff" title="pysys.basetest.BaseTest.assertDiff"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.assertDiff</span></code></a> (and filediff) handling of “include” expressions
list to filter out lines if no include expressions match (as documented)
rather than if any include expressions match. This fix may cause tests to fail
that had previously - and incorrectly - passed as a result of all lines
being filtered out before the comparison. There is also now a message
logged at warn level when every line in a file comparison is filtered
out, since in most cases this is not desirable behaviour.</p></li>
<li><p>Changed <code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.py</span> <span class="pre">run</span></code> to return a non-zero exit code if any tests
failed, whereas previously it would return 0.</p></li>
</ul>
<p>Other fixes and new features:</p>
<ul>
<li><p>PySys now provides ‘single-source’ support for both Python 2.7 and
Python 3.x, without the need for the 2to3.py script to be run at
installation time for use with Python 3.</p></li>
<li><p>Added support for specifying what file encoding is to be used for reading
and writing text files (for example in <code class="xref py py-obj docutils literal notranslate"><span class="pre">waitForSignal</span></code> and various
assertions). This is especially important for Python 3 where text files
are processed using unicode character strings rather than Python 2
byte “str” objects. The encoding can be specified explicitly on
individual methods the open files, or globally based on file names
or extensions by overriding the new <code class="xref py py-obj docutils literal notranslate"><span class="pre">ProcessUser.getDefaultFileEncoding()</span></code>
method. For example, <code class="xref py py-obj docutils literal notranslate"><span class="pre">getDefaultFileEncoding</span></code> could be overridden to
specify that .xml files should be treated as UTF-8 by default. If
the encoding is not specified explicitly or through
<code class="xref py py-obj docutils literal notranslate"><span class="pre">getDefaultFileEncoding()</span></code>, Python selects the preferred encoding based
on the locale that it is running in.</p></li>
<li><p>Changed the way multiple cycles are executed in multi-threaded mode to
allow tests from different cycles to execute in parallel instead of waiting
for each cycle to fully complete before starting the next cycle. This
improved parallelism makes it much easier to reproduce race
conditions demonstrated by a single testcase, which was not possible
with the previous threading behaviour. To maintain existing
behaviour for users who have provided a <code class="xref py py-obj docutils literal notranslate"><span class="pre">runner.cycleComplete()</span></code> method,
concurrent cycle execution will be disabled if <code class="xref py py-obj docutils literal notranslate"><span class="pre">cycleComplete()</span></code> is overridden.
Anybody affected by this is encouraged to transition away from use of
<code class="xref py py-obj docutils literal notranslate"><span class="pre">cycleComplete()</span></code> and perform any required cleanup tasks in
<a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.cleanup" title="pysys.basetest.BaseTest.cleanup"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.cleanup()</span></code></a> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseRunner.testComplete()</span></code> instead.</p></li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">&lt;requires-python&gt;</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">&lt;requires-pysys&gt;</span></code> elements to the project XML
file which allow checking for the specified minimum python or pysys
version, resulting in a clear error if attempting to use the wrong
version.</p></li>
<li><p>Added support for coloring console output to highlight passes, fails,
warnings and more. This is configured in the project configuration file.
Coloring can also be enabled or disabled for a particular user and/or
machine using the <code class="xref py py-obj docutils literal notranslate"><span class="pre">PYSYS_COLOR=true/false</span></code> environment variable override.
Coloring works on any terminal that supports ANSI escape sequences (e.g.
most Unix terminals). On Windows, which does not, it is possible to get
colored output by installing a package such as “colorama”, which PySys will
load if it is present on the python path. It is possible to customize the
colors used or to use alternative libraries for coloring on windows by
providing a custom ColorLogFormatter class. The colors used for each
category of log messages can be customized in the project configuration
file, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">formatter</span><span class="o">&gt;&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;color:timed out&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;MAGENTA&quot;</span><span class="o">/&gt;&lt;/</span><span class="n">formatter</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">ProcessUser.getExprFromFile</span></code> helper method to automate the common task
of retrieving some text from a file, for example to capture information
such as a process identifier from a log file, or to extract some
performance results that were logged.</p></li>
<li><p>Added <a class="reference internal" href="pysys/BaseTest.html#pysys.basetest.BaseTest.reportPerformanceResult" title="pysys.basetest.BaseTest.reportPerformanceResult"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTest.reportPerformanceResult()</span></code></a> and a flexible framework for
recording performance results (e.g. throughput, latency etc) measured
by PySys tests, including storage of results in a human-readable and
machine-parsable CSV file together with run-specific information
such as the host where the test was executed. The CSV files can be
aggregated across multiple test runs and/or cycles and imported into
any spreadsheet for comparisons and more detailed analysis. The standard
CSVPerformanceReporter can be subclassed and replaced with an alternative
recording mechanism if desired (e.g. writing directly to a database or
other file format). Fibonacci_test_005 demonstrates how performance
results can be reported using this framework.</p></li>
<li><p>Added support for providing a custom class to implement formatting of
log messages, for both run.log and stdout. Errors in the <code class="xref py py-obj docutils literal notranslate"><span class="pre">&lt;formatters&gt;</span></code> XML
node will now be treated as errors rather than being silently ignored.</p></li>
<li><p>Changed pysys.py to ignore trailing slash characters on test ids, which
makes it easier to use shell tab completion to select a specific test.</p></li>
<li><p>Fixed pysys.py command line parser to give a clear error if requested to
execute a non-existent test id, or if the test descriptor XML could
not be parsed. Previously invalid test ids would be either silently
ignored without an error, or would result in other test ids being
executed more than once.</p></li>
<li><p>Fixed <code class="xref py py-obj docutils literal notranslate"><span class="pre">ProcessUser.startProcess</span></code> to use the test output directory (rather
than the current working directory) as the root when a relative path is
specified for the workingDir argument.</p></li>
<li><p>Fixed bug in which log level and exception tracebacks were being
inadvertently suppressed from the stdout console output when executing
from multiple threads.</p></li>
<li><p>Fixed manual tester thread to report a BLOCKED outcome instead of hanging
if a fatal error occurs (e.g. Tck does not load due to DISPLAY not being
configured correctly).</p></li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseResultsWriter</span></code> class and associated docstring documentation to
make it easier to create new results writers.</p></li>
<li><p>Changed standard record writers to report the number of cycles starting
from 1 rather than from 0 (which is consistent with how cycles are
displayed by the rest of PySys).</p></li>
<li><p>Extended the concept of “writers” to include not just “record” writers
(which are enabled only when <code class="xref py py-obj docutils literal notranslate"><span class="pre">--record</span></code> is specified) but also “summary”
writers which are always enabled and log a summary at the end of test
execution (if none is explicitly configured a default
<code class="xref py py-obj docutils literal notranslate"><span class="pre">ConsoleSummaryResultsWriter</span></code> is instantiated), and “progress” writers
which are enabled only when <code class="xref py py-obj docutils literal notranslate"><span class="pre">--progress</span></code> is specified and log progress
information throughout a run.</p></li>
<li><p>The monolithic logic for writing a summary to the console at the end of
test execution has been refactored out of baserunner and into
the configurable and separately extendable <code class="xref py py-obj docutils literal notranslate"><span class="pre">ConsoleSummaryResultsWriter</span></code> class.
Any baserunner subclasses that are currently overriding the summary printing
functionality and/or making use of the results dictionary returned by
<code class="xref py py-obj docutils literal notranslate"><span class="pre">start()</span></code> should now switch to using “summary” writers instead. This
functionality will be removed in a future release and is now deprecated.</p></li>
<li><p>The default summary results writer now has a configuration parameter
<code class="xref py py-obj docutils literal notranslate"><span class="pre">showOutcomeReason</span></code> which causes the outcome reason string to be included
underneath each failure outcome, to provide a quick summary of what went
wrong.</p></li>
<li><p>The default summary results writer now has a configuration parameter
<code class="xref py py-obj docutils literal notranslate"><span class="pre">showOutputDir</span></code> which causes the path to the test’s output directory
to be printed underneath each failure outcome, to make it easy to quickly
find and open the relevant files to debug the failure.</p></li>
<li><p>Added a <code class="xref py py-obj docutils literal notranslate"><span class="pre">--progress</span></code> command line option (can also be switched on using
the <code class="xref py py-obj docutils literal notranslate"><span class="pre">PYSYS_PROGRESS=true</span></code> environment variable), which logs a summary of
how many test have executed, outcomes, a list of most recent failure
reasons and a list of what other tests are currently executing. This
provides very helpful feedback to the user while executing a long
test run. The progress reporting is implemented in a fully extensible
way using a new kind of ‘progress’ result writer. A custom progress
result writer class can be configured for a project; if none is
specified the default <code class="xref py py-obj docutils literal notranslate"><span class="pre">ConsoleProgressResultsWriter</span></code> is added automatically.</p></li>
<li><p>Fixed unexpected DEBUG logging on standard output after any of the
Python <code class="xref py py-obj docutils literal notranslate"><span class="pre">logging.info/warn/error()</span></code> methods is called. This behaviour was
triggered if certain libraries (e.g SSL libraries) were not available
when python starts.</p></li>
<li><p>Added <code class="xref py py-obj docutils literal notranslate"><span class="pre">defaultIgnoreExitStatus</span></code> project property which controls whether
non-zero return codes from <code class="xref py py-obj docutils literal notranslate"><span class="pre">startProcess()</span></code> result in test failures, when the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">ignoreExitStatus</span></code> flag is not explicitly specified. To retain the same
behaviour for existing projects, <code class="xref py py-obj docutils literal notranslate"><span class="pre">defaultIgnoreExitStatus</span></code> is set to True if
the property is not configured in the project configuration. However to
promote best practice for new PySys projects, the example pysys project
configuration file sets <code class="xref py py-obj docutils literal notranslate"><span class="pre">defaultIgnoreExitStatus</span></code> to False, which ensures
that processes that return failure codes are not ignored unless explicitly
intended by the author of the testcase.</p></li>
<li><p>Fixed <code class="xref py py-obj docutils literal notranslate"><span class="pre">waitForSocket</span></code>, which in previous versions immediately returned
success instead of waiting a valid socket connection as documented.</p></li>
<li><p>If the test run is interrupted from the keyboard, the prompt that asks
whether to continue to run tests is no longer displayed if there are no more
tests left to run. The prompt can also be completely disabled using an
environment variable <code class="xref py py-obj docutils literal notranslate"><span class="pre">PYSYS_DISABLE_KBRD_INTERRUPT_PROMPT=true</span></code>, for users who
prefer Ctrl+C to immediately terminate the test run in all cases.</p></li>
<li><p>Added <a class="reference internal" href="autodocgen/pysys.utils.pycompat.html#module-pysys.utils.pycompat" title="pysys.utils.pycompat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pysys.utils.pycompat</span></code></a> module containing a small set of helpers for
writing code that works with Python 2 and Python 3.</p></li>
<li><p>Fixed writing to process stdin so that if a character string is passed in it
will be converted to a byte object automatically, using the default
encoding. Previously, it was not possible to write character strings in
Python 3, and in Python 2 it would only work if they contained only ascii
characters.</p></li>
</ul>
</div>
<div class="section" id="to-1-2-0">
<h3>1.1.1 to 1.2.0<a class="headerlink" href="#to-1-2-0" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Added the errorExpr argument to the waitForSignal method. Occurrence of any
matches to expressions in this argument will terminate the waitForSignal
loop, allowing early exit prior to the timeout.</p></li>
<li><p>Refactored reconfiguration of global logging out of the pysys __init__.py
class into the pysys.py launcher. This allows other applications making
use of the PySys framework to make their own logging decisions.</p></li>
<li><p>Improved usability of the assertDiff method by writing out the unified
diff to a file in the output subdirectory so failures are easier to triage.</p></li>
<li><p>Added the literal argument to the assertGrep method to avoid having to
escape regular expressions.</p></li>
<li><p>Added the utils.fileutils module for miscellaneous file related utilities.</p></li>
</ul>
</div>
<div class="section" id="to-1-1-1">
<h3>1.1.0 to 1.1.1<a class="headerlink" href="#to-1-1-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The validateOnly option has been added to the pysys.py run launcher
task. When set the purge output subdirectory, setup and execute methods
on the test will not be invoked. This makes it easier to fix validation
errors in the test without the need to re-run the entire test.</p></li>
<li><p>The logFileContents() method has been added to the pysys.basetest.BaseTest
class to allow logging of file contents to the run.log. This can be used
to provide additional diagnostic information to the run.log to assist
the triage of test failures.</p></li>
<li><p>The CSVResultsWriter has been added to the set of test summary writers.
See the sample pysysproject.xml file for more details.</p></li>
<li><p>It is now possible to specify a regex for matching in the test selection.
See the run usage for more details (pysys.py run -h).</p></li>
</ul>
</div>
<div class="section" id="to-1-1-0">
<h3>0.9.3 to 1.1.0<a class="headerlink" href="#to-1-1-0" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>This release introduces optional fail fast semantics at a macro and micro
level. At a macro level this is either through the “defaultAbortOnError”
project property, or through the “-b|–abort” option to the pysys launcher
run task. See the sample pysysproject.xml, and the run task
help usage respectively for more details. At a micro level, all assert and
process related methods now take an optional “abortOnError” parameter to
override any macro setting. When enabled any error will cause the test to
immediately fail, reporting the failure reason.</p></li>
<li><p>Outcomes which are considered a fail now log information as to the cause
of the failure. Additionally a call record is reported, giving a comma
separated list of “module:lineno” entries detailing the call stack up to
the test class instance. This is to aid diagnosing test failure causes.</p></li>
<li><p>The test title is now output to console when running the test.</p></li>
<li><p>The BaseRunner class now contains an isPurgableFile() method. This method
can be overridden by any extensions to denote if a zero length file should
be purged from the output subdirectory after running of the test.</p></li>
<li><p>It is now possible to register cleanup functions in the BaseTest to negate
the need to override the cleanup() action where a call to
BaseTest.cleanup(self) must specifically be made. See the epydoc for the
addCleanupFunction() in the ProcessUser module.</p></li>
</ul>
</div>
<div class="section" id="to-0-9-3">
<h3>0.9.2 to 0.9.3<a class="headerlink" href="#to-0-9-3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Added Darwin as a supported platform.</p></li>
<li><p>Added the maker tag to the pysysproject file to allow specifying a
custom test maker class, e.g. to create specific run templates etc.
See the pysysproject.xml file in pysys-examples for more information.</p></li>
<li><p>The make option to pysys.py now accepts the testcase directory to be
specified to a value other than the current working directory.</p></li>
</ul>
</div>
<div class="section" id="to-0-9-2">
<h3>0.9.1 to 0.9.2<a class="headerlink" href="#to-0-9-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The method getNextAvailableTCPPort has been added to the
pysys.basetest.BaseTest class to allow users to allocate server TCP ports
in a robust manner.</p></li>
<li><p>The unix and windows process helpers have been updated to fix handle leaks
(defect #11 “ProcessMonitor leaks file handles”), and to delete the stdin
queue when processes go away.</p></li>
</ul>
</div>
<div class="section" id="to-0-9-1">
<h3>0.9.0 to 0.9.1<a class="headerlink" href="#to-0-9-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Fixed issue with the determination of the overall test outcome due to the
incorrect use of the inbuilt sorted() function. The issue meant the test
outcome list was not correctly sorted based on precedent, leading to the
incorrect determination of the overall test outcome.</p></li>
<li><p>Fixed issue in the pysys.basetest on handling FileNotFoundExceptions in
the assert* methods. The exception was not being caught, leading to
subsequent asserts in the test class not being performed.</p></li>
</ul>
</div>
<div class="section" id="to-0-9-0">
<h3>0.8.1 to 0.9.0<a class="headerlink" href="#to-0-9-0" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The PySys framework has been updated to be compliant with conversion to
Python 3.x with the 2to3.py conversion script. Installation on Python 3.x
is now supported via the source distribution bundle, where the 2to3.py
script is run automatically at install time. See details below for
installing the source distribution. A binary distribution installer for
windows will be included in a later release.</p></li>
<li><p>There are now separate 32 and 64 bit binary distribution installers for
windows.</p></li>
<li><p>On failure of the assertLineCount method, the log output now contains the
returned number and requested condition (tracker #3045931)</p></li>
<li><p>Each assert method now takes an “assertMessage” parameter to be written
to the log output on execution (tracker #3045924). See test
PySys_internal_053 in the example testcases for example usage.</p></li>
<li><p>Added the JUnitXMLResultsWriter to log test results in Apache Ant JUnit
XML format (one output file per test per cycle). This is useful for
integration into Continuous Integration build systems, e.g. TeamCity. The
TextResultsWriter and XMLResultsWriter now support the outputDir property
to specify the location to write the output files. See the pysys-examples
pysysproject.xml file for more details.</p></li>
<li><p>Added the ability to run suites of pyunit tests wrapped up as a single
PySys test. This capability is exposed through the PyUnitTest class
contained in the pysys.unit.pyunit module. See the pysys-examples pyunit
tests for example usage.</p></li>
<li><p>Fix to the unix process helper to correctly set the working directory of
child processes in the fork and exec.</p></li>
<li><p>When running tests in parallel, a value of zero given for the
-n|–threads option to the run task of the pysys.py launcher, will set
the number of threads to the number of available CPUs.</p></li>
</ul>
</div>
<div class="section" id="to-0-8-1">
<h3>0.7.6 to 0.8.1<a class="headerlink" href="#to-0-8-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Updated the pysys.process.plat-win32.helper.ProcessWrapper module to
eliminate the use of threads to collect the stdout and stderr from the
process via pipes. The module now directly uses win32file.CreateFile to
create file objects to pass to the call to win32process.CreateProcess.</p></li>
<li><p>Added the &lt;formatters/&gt; element to the pysysproject file. This allows
setting the format of the test output to stdout and the runlog in
accordance to the format specifiers in the python logging and time
modules. For examples of the use of this element, see the pysysproject
file included in the PySys examples.</p></li>
<li><p>Logging of exceptions and failed asserts has been changed from info to
warn level (tracker #2784251).</p></li>
<li><p>Added extra debug logging in pysys.utils.filegrep, and pysys.basetest
for when performing asserts against a line count in an input file
(tracker #2824758).</p></li>
<li><p>The testcase output summary is now printed on termination of the test
run via a keyboard interrupt (tracker #2816212).</p></li>
<li><p>The PySys project file now allows assignment of the project root
location to a variable which can then be used for later expansion within
the file. This allows the definition of project variables to include the
full path where this is required, e.g. XSL stylesheets which must use
the full path to the file rather than a relative path etc. Note that
modules within PySys can reference the project root location directly
using PROJECT.root (tracker #2795316).</p></li>
<li><p>The pysys.baserunner class now passes the -X arguments into the test
summary writer setup action to allow logging of the user supplied extra
arguments(tracker #2814499). The pysys-log.xsl stylesheet used by the
XMLResultsWriter
has been updated to display this information in the test summary display.</p></li>
<li><p>Fixed an issue where when the pysysproject file was missing, defaults
for the runner module and the test output summary writer were not being
set.</p></li>
</ul>
</div>
<div class="section" id="to-0-7-6">
<h3>0.7.5 to 0.7.6<a class="headerlink" href="#to-0-7-6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Fixed a defect in the unix process helper module to correct a file
handle leak in the write end of the stdin pipe.</p></li>
</ul>
</div>
<div class="section" id="to-0-7-5">
<h3>0.6.1 to 0.7.5<a class="headerlink" href="#to-0-7-5" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Added the ability to run tests concurrently through the -n | –threads
option to the pysys launcher run target. Tests to be run are placed on a
request queue and processed by the designated number of worker threads.
The results of each test are then placed on a result queue, collated and
displayed in the order in which they would run serially. Depending on
the nature of the application under test, the recommended number of
threads to designate when using this option is no more than two times
the number of CPUs. Note also that care needs to be made when running
tests in parallel, so as to ensure no shared resources are accessed
in a non-atomic way, e.g using direct references to os.environ() in one
test when another test modifies the environment directly etc.</p></li>
<li><p>The constructor to the pysys.baserunner.BaseRunner class was changed to
include the threads parameter, i.e.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">purge</span><span class="p">,</span> <span class="n">cycle</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">threads</span><span class="p">,</span> <span class="n">outsubdir</span><span class="p">,</span> <span class="n">descriptors</span><span class="p">,</span> <span class="n">xargs</span><span class="p">)</span>
</pre></div>
</div>
<p>This parameter is required for the runner to create the required
threadpool before running a set of tests in parallel. Any custom runner
classes extending the base runner will need to be updated to incorporate
this change.</p>
</li>
<li><p>Removed module specific loggers from pysys in order to support running
tests in parallel. There is now a single logger used within the
framework, and which can be referenced directly from the pysys.constants
module. Attached to this logger are two handler types; one for logging
to stdout, and one for logging to the run
log file saved in the output subdirectory of each test. The stdout
handler is set to only log to stdout from the main thread, whilst the
run log file handlers are set to log to the output subdirectory of a
test only on the creating thread.</p></li>
<li><p>Added exception handling to the pysys.process.user module when trying to
stop all processes on destruction. When a background process takes
longer to stop than the default timeout period, the thrown
pysys.exceptions.ProcessTimeout exception was uncaught causing abnormal
exit from the test run.</p></li>
</ul>
</div>
<div class="section" id="to-0-6-1">
<h3>0.6.0 to 0.6.1<a class="headerlink" href="#to-0-6-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The clean target has been updated to accept the -a | –all command line
option to allow deleting all derived files produced when running a set
of testcases, i.e. both the testcase output subdirectory and any
compiled test class modules.</p></li>
<li><p>The waitForSignal method of the ProcessUser class, subclassed by both
the BaseTestand BaseRunner classes, has been updated to return a list of
match objects on invocation. By using tagged regular expressions in the
expr parameter of the method call, this allows retrieval of portions of
the matched data e.g. to extract expressions in the file to use later in
the validation routines.</p></li>
<li><p>All references to pysys.constants.TRUE and pysys.constants.FALSE have
been replaced by the native Python True and False literals. The values
of the constants have been set to True and False respectively so as to
maintain backwards compatibility.</p></li>
</ul>
</div>
<div class="section" id="to-0-6-0">
<h3>0.5.2 to 0.6.0<a class="headerlink" href="#to-0-6-0" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The PySys test and PySys project files have been renamed by default from
.pysystest to pysystest.xm, and .pysysproject to pysysproject.xml
respectively. Backwards compatibility is maintained for the previous
file naming convention, though this will be deprecated in a later
release; it is strongly advised that the new naming convention is
adopted. New tests made using the PySys launcher will by default use the
new naming convention. This change was made due to issues on Windows
systems displaying and recognising hidden files, and files without
specified extensions e.g. within the Eclipse framework, for display in
internet browsers etc.</p></li>
<li><p>The clean mode of operation has been added to the pysys.py launcher. This
allows removal of testcase output subdirectories, e.g. before importing
into a source code control system. The -o option allows specifying the
output subdirectory name to be deleted, which defaults to the platform
identifier if not specified.</p></li>
<li><p>The test output summary writer interface has been changed so that the
test output is written and updated during the test execution; previously
a call to the writer was only made on completion of the test run. This
allows monitoring the test output summary during the test execution to
monitor the run time status of the tests.</p></li>
<li><p>Added the XMLFileResultsWriter class to the pysys.writer module. This
performs logging of the test output summary in an XML format, suitable
for display via XLST in a web browser. A simple XSL stylesheet is
included with the PySys distribution to provide better display in
internet browsers.</p></li>
<li><p>Added the ability to specify custom test output summary writers in the
PySys project file via the &lt;writer&gt; tag. For an example see the
.pysysproject file in the pysys-examples distribution. Should no
&lt;writer&gt; be specified in the project file, the default
XMLFileResultsWriter will be used. Multiple writers may be specified in
the PySys project file.</p></li>
<li><p>Added exception logging on parsing errors in the PySys project file, e.g.
when the file in badly formed due to invalid XML tokens etc.</p></li>
<li><p>Added variable argument passing to the process.monitor.ProcessMonitor
class constructor so that operating specific arguments can be passed
into the class on instantiation. The wrapper method
pysys.basetest.BaseTest.startProcessMonitor has also been updated to
allow pass through of the variable arguments.</p></li>
<li><p>The win32 process.monitor module has been changed so that on windows
systems the percentage CPU usage is not normalised by default by the
number of available processors, e.g. on a 4 core processor if 2 cores
were fully utilized the CPU usage was previously output as 50% - the
change means that the reported usage will now be 200% (a value of 100%
indicates that one core is fully utilitised). This makes the output
consistent with that reported on unix systems. Should the
previous behavior be required the numProcessors argument can be passed
to the pysys.basetest.BaseTest.startProcessMonitor method in order to
normalise the CPU usage statistics by the number of processors. On
windows systems the number of processors can be obtained from the
NUM_PROCESSORS environment variable.</p></li>
<li><p>Added comments to the PySys Project file distributed with the example
testcases, to detail the possible configuration options.</p></li>
</ul>
</div>
<div class="section" id="to-0-5-2">
<h3>0.5.1 to 0.5.2<a class="headerlink" href="#to-0-5-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The lastgrep method has been added to pysys.utils.filegrep, and the
assertLastGrep method has been added to the BaseTest class. This allows
test validation to be performed based on regular expression matching on
the last line of an input file to the assertLastGrep method.</p></li>
<li><p>The win32 process monitor has been modified to calculate the percentage
CPU usage statistics as a sum over all available processors. A CPU usage
of 100% represents the process fully utilising all available processors.</p></li>
<li><p>The win32 process monitor now also logs the handle count of a process.</p></li>
</ul>
</div>
<div class="section" id="to-0-5-1">
<h3>0.5.0 to 0.5.1<a class="headerlink" href="#to-0-5-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Fixed a bug in pysys.process.user.ProcessUser destructor to explicitly
set the process list to null to allow process handles to be cleaned up
on destruction. This bug only seemed to be exhibited when the process
handle of a process returned in the startProcess() method was set as a
data attribute to an instance of the class. This handle was then both a
data attribute of the class, and was contained in a list data attribute
of the class. Under these conditions the handles were not being released
correctly.</p></li>
<li><p>The print mode of the pysys.py launcher now supports printing out the
test user defined modes, and the printing out of tests that can be run
in a given mode.</p></li>
</ul>
</div>
<div class="section" id="to-0-5-0">
<h3>0.4.0 to 0.5.0<a class="headerlink" href="#to-0-5-0" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>The OSFAMILY constant has been added to pysys.constants, and takes the
value ‘windows’ on all win32 operating systems, and ‘unix’ on sunos and
linux operating systems. The value of the OSFAMILY can be used within
the .pysysproject file using the osfamily attribute to the &lt;property&gt;
element. This allows capturing the value to be used in expansion of
other properties defined within the project file; see below for an
example usage. Should no value be set in a properties file, a default
value of “osfamily” is assumed.</p></li>
<li><p>The .pysysproject file now allows explicitly setting the environment
value to be used in expansions via the environment attribute to the
&lt;property&gt; element; see
below for an example usage. Should no value be set in a properties file,
a default value of “env” is assumed (this allows for backwards compatibility).</p></li>
<li><p>The .pysysproject file now takes the file attribute to the &lt;property&gt;
element. This allows properties to be read from file, where the
properties are specified in the name=value syntax, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">pysysproject</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">property</span> <span class="n">environment</span><span class="o">=</span><span class="s2">&quot;env&quot;</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="nb">property</span> <span class="n">osfamily</span><span class="o">=</span><span class="s2">&quot;osfamily&quot;</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="nb">property</span> <span class="n">file</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{osfamily}</span><span class="s2">.properties&quot;</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lib&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{library}</span><span class="s2">_$</span><span class="si">{osfamily}</span><span class="s2">_$</span><span class="si">{version}</span><span class="s2">_$</span><span class="si">{env.USER}</span><span class="s2">.so&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">pysysproject</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>where the property file contains the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>version=1.0
library=jstore${version}.jar
</pre></div>
</div>
<p>For more details, see testcase PySys_internal_002 in the
pysys-examples/internal area which demonstrates this.</p>
</li>
<li><p>Fixed the issue of removing zero size files from the output subdirectory
on win32 platforms; was due to the stderr and stdout file handles not
being properly closed down. Updated the BaseRunner to attempt to remove
the zero sized files 3 times to try to avoid race conditions of stopped
background processes holding on to the file handles too long before dying.</p></li>
<li><p>The win32 process helper now ensures the environment in which the
process runs is converted to unicode to avoid issues encountered with
running under certain locales.</p></li>
</ul>
</div>
<div class="section" id="to-0-4-0">
<h3>0.3.5 to 0.4.0<a class="headerlink" href="#to-0-4-0" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The pysys.process.ProcessUser class has been added to define an
interface to subclasses which use the underlying process helper classes.
Both the BaseTest and BaseRunner classes now extend this so as to
provide a common interface for process manipulation. A common paradigm
for creating extension modules to PySys is to create a helper class
which provides the methods for starting an interacting with the
application under test (AUT). These helper classes have a call back to
an instance of the ProcessUser so that it can make use of the high level
process methods. As both the BaseTest and BaseRunner classes are
instances of the ProcessUser, the extension module helper classes can be
used in extensions to both of these to allow the AUT to be started both
within a testcase, and within the runner.</p></li>
<li><p>The method signature to the pysys.utils.filereplace replace method has
been changed to set the default value for the marker to the empty string</p></li>
<li><p>Bugs fixes for cleaning up leakage of threads from the process helpers,
and file handle leakage from the base runner classes.</p></li>
</ul>
</div>
<div class="section" id="to-0-3-5">
<h3>0.3.4 to 0.3.5<a class="headerlink" href="#to-0-3-5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Fixed a bug a testcase was not being marked as BLOCKED when unable to
start a process using the process helper module.</p></li>
<li><p>Failure on the assertOrderedGrep now prints out the line the failure
occurred on.</p></li>
</ul>
</div>
<div class="section" id="to-0-3-4">
<h3>0.3.3 to 0.3.4<a class="headerlink" href="#to-0-3-4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Fixed a bug where timedout processes started in the foreground were not
being stopped automatically at the end of the testcase.</p></li>
</ul>
</div>
<div class="section" id="to-0-3-3">
<h3>0.3.2 to 0.3.3<a class="headerlink" href="#to-0-3-3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The default name of the PySys test descriptor file has been changed from
“descriptor.xml”, to “.pysystest”. This change is to maintain a consistent
naming convention across configuration files within the framework, e.g.
the project file “.pysysproject” denotes the project root and project
specific information, whilst a test file “.pysystest” denotes a testcase
within the project, and contains meta data for the test. Support for the
previous name is maintained, though it should be noted that testcases
created with the ‘pysys.py make’ command will have the new naming
convention used.</p></li>
<li><p>The windows installer has been updated to add shortcuts to the
uninstaller, and to create a separate directory for the inclusion of
project extensions.</p></li>
<li><p>The getInstanceCount method has been added to the
pysys.basetest.BaseTest class to reference count the number of named
processes started during a test run. The startProcess method of the
class adds a reference count to an internal dictionary
structure keyed on the displayName passed into the method to achieve
this.</p></li>
<li><p>The writeProcess method has been added to the pysys.basetest.BaseTest
class to provide a wrapper around the write method of the underlying
process helper class. This wrapper perform a check on the running status
of the process prior to the write, and performs additional logging to
the run.log to audit the write.</p></li>
<li><p>Fixed a bug in the replace method of the filereplace module, where the
method signature was missing the marker parameter</p></li>
<li><p>Added support to the pysys project file to allow adding path locations
to the Python path. See the .pysysproject file in pysys-examples for
more detail.</p></li>
</ul>
</div>
<div class="section" id="to-0-3-2">
<h3>0.3.1 to 0.3.2<a class="headerlink" href="#to-0-3-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Release was superseded immediately by the 0.3.3 release. See release
notes for new features for 0.3.3 for more information.</p></li>
</ul>
</div>
<div class="section" id="to-0-3-1">
<h3>0.3.0 to 0.3.1<a class="headerlink" href="#to-0-3-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The process helper modules have been updated to allow the writing to the
stdin of a process via the write() method on the process handle.</p></li>
<li><p>Several bug fixes have been applied to the unix process helper module.</p></li>
<li><p>The pysys-examples/internal directory has been added to the examples
module. This will contain internal testcases for self testing the pysys
framework. These have been included in the distribution as examples of
the use of the framework.</p></li>
<li><p>The pysys project file has been added into the framework to allow the
setting of project specific constants within the application. The
project file should be written to the base location of the project, with
the filename .pysysproject. The location of this file denotes the root
location of the project. For an example of the file see
pysys-examples/.pysysproject. Any name value properties
within the file will be set as data attributes of the pysys.Project
class, which is referenced in the pysys.constants module using the
variable PROJECT.</p></li>
</ul>
</div>
<div class="section" id="to-0-3-0">
<h3>0.2.2 to 0.3.0<a class="headerlink" href="#to-0-3-0" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Updates to the epydoc output for documenting the classes and modules of
pysys</p></li>
<li><p>Addition of the pysys.py module for printing, running and making new
testcase directory structures. This allows a single distributed script
to be used to perform all functionality available from the console.</p></li>
<li><p>Remove of the run method from the console launch helper.</p></li>
</ul>
</div>
<div class="section" id="to-0-2-2">
<h3>0.2.1 to 0.2.2<a class="headerlink" href="#to-0-2-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The suites element in the test descriptor has been renamed to groups.
This is to allow testcases in a single directory to be classified as a
single testsuite, and subsets thereof to be regarded as a group</p></li>
<li><p>Minor bug fixes to the manual tester and process module</p></li>
</ul>
</div>
<div class="section" id="to-0-2-1">
<h3>0.2.0 to 0.2.1<a class="headerlink" href="#to-0-2-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The Manual Tester has been updated to support the &lt;expectedresult&gt;
element in the input xml file. This allows display of the expected
result for a manual step to be presented in the user interface. The
ability to optionally record a defect in the log output is also now
included.</p></li>
<li><p>The createDescriptors method has been removed from the
pysys.launcher.console package and moved into pysys.launcher. This
allows the utility method to be used for other custom launchers.</p></li>
</ul>
</div>
<div class="section" id="to-0-2-0">
<h3>0.1.7 to 0.2.0<a class="headerlink" href="#to-0-2-0" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>This release includes updates to the Python doc strings for automated
generation of epydoc using the Epydoc package
(<a class="reference external" href="http://epydoc.sourceforge.net">http://epydoc.sourceforge.net</a>). The installer now distributes the
generated epydoc in the site-packages/pysys-doc directory. For
windows installs a link to the epydoc and release notes is now added as
a link in the start menu items</p></li>
<li><p>Added the setup() method to the BaseTest class to allow custom setup
actions to be performed prior to execution of a particular test case</p></li>
<li><p>Fixed a bug where if the –type option was not supplied to
ConsoleMakeTestHelper as a command line option, the resulting descriptor
had type=”None”</p></li>
</ul>
</div>
<div class="section" id="to-0-1-7">
<h3>0.1.6 to 0.1.7<a class="headerlink" href="#to-0-1-7" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The Manual Tester UI has been updated so that it can be resized, and is
easier to navigate through the tests.</p></li>
<li><p>The BaseRunner start method now takes an optional list of result writer
class instances to perform test audit logging at the end of a test
cycle. This allows custom result writers to be passed to the runner to,
for example, write the results to a database, proprietary system etc</p></li>
</ul>
</div>
<div class="section" id="to-0-1-6">
<h3>0.1.5 to 0.1.6<a class="headerlink" href="#to-0-1-6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Added the ability to differentiate between automated and manual
testcases using the test attribute to the pysystest element in the
testcase descriptor. If the attribute is not present the test will be
assumed to be an automated test. The runTest and printTest launch
helpers allow you to differentiate between automated and manual
tests using the –type command line argument. For more information see
the examples in pysys-examples</p></li>
</ul>
</div>
<div class="section" id="to-0-1-5">
<h3>0.1.4 to 0.1.5<a class="headerlink" href="#to-0-1-5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Added support for the requirements traceability. This includes printing
requirements covered by a set of testcases, and running testcases which
cover a particular requirement id</p></li>
</ul>
</div>
<div class="section" id="to-0-1-4">
<h3>0.1.3 to 0.1.4<a class="headerlink" href="#to-0-1-4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Added the ConsoleMakeTestHelper class to pysys.launcher.console. This
facilitates the creation of new testcase structures from the command
line. Updated pysys-examples/fibonacci to demonstrate the use of the
utility class</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="license.html" class="btn btn-neutral float-left" title="License" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2006-2021 M.B. Grieve; documentation last updated on 2021-08-22

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>